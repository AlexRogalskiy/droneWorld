{"version":3,"sources":["textures/Rock_08_UV_H_CM_1.jpg","textures/Rock_08_UV_H_CM_1_normal.jpg","textures/GrassGreenTexture0003.jpg","textures/GrassGreenTexture0003_normal.jpg","particles/three.js","textures/Water_1_M_Normal.jpg","textures/Water_2_M_Normal.jpg","terrain/terrain.worker.js","materials/meshphysical_vert.glsl","materials/meshphysical_frag.glsl","materials/terrain_tile_vert.glsl","materials/terrain_tile_frag.glsl","materials/terrain_voxel_vert.glsl","materials/terrain_voxel_frag.glsl","voxel/voxel.worker.js","ocean/water_frag.glsl","ocean/water_vert.glsl","ocean/underwater_frag.glsl","ocean/underwater_vert.glsl","textures/lensflare/lensflare3.png","textures/Explosion_002_Tile_8x8_256x256.png","textures/smokeparticle.png","textures/spark.png","textures/bullet.png","sound/impact1.ogg","sound/impact2.ogg","sound/impact3.ogg","sound/impact4.ogg","sound/gatling.ogg","sound/missile.ogg","sound/explosion1.ogg","sound/explosion2.ogg","events/index.js","modules/Sky.js","lights.js","materials/terrainPhysical.js","materials/terrainTile.js","terrain/index.js","loops/tileBuilder.js","materials/terrainVoxel.js","voxel/constants.js","voxel/index.js","loops/voxelsLoop.js","loops/terrainLoop.js","postprocessing/lensflares.js","postprocessing/MotionBlur.js","postprocessing/Clouds.js","utils/index.js","hud/index.js","hud/crosshair.js","particles/index.js","drones/loader.js","drones/init.js","drones/index.js","modules/FlyControls.js","controls/autopilot.js","controls/index.js","utils/isMobile.js","sound/index.js","ocean/index.js","index.js","sky/index.js","modules/WindowResize.js"],"names":["module","exports","__webpack_require__","p","r","__webpack_exports__","three__WEBPACK_IMPORTED_MODULE_0__","d","Worker","PubSub","Sky","shader","SkyShader","material","ShaderMaterial","fragmentShader","vertexShader","uniforms","UniformsUtils","clone","side","BackSide","Mesh","call","this","SphereBufferGeometry","prototype","Object","create","luminance","value","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","Vector3","dirLight","DirectionalLight","window","hemishpereLight","HemisphereLight","position","set","up","needsUpdate","ambientLight","AmbientLight","updateDirLightPosition","copy","normalize","multiplyScalar","add","drone","textureLoader","TextureLoader","setCrossOrigin","rockTexture","load","require","rockTextureNormal","grassTexture","grassTextureNormal","wrapS","wrapT","RepeatWrapping","offset","repeat","lon","zoom","materialBasic","options","objectSpread","roughness","metalness","UniformsLib","common","lights","envmap","normalmap","fog","defines","STANDARD","USE_MAP","USE_NORMALMAP","extensions","derivatives","wireframe","map","normalMap","isShaderMaterial","isMeshStandardMaterial","uvTransform","Matrix3","MaterialBasic","chamonix","x","Math","pow","y","lat","log","tan","PI","cos","lat2tile","setTilePosition","geometry","key","zxyijs","split","parseInt","z","size","offsetAtZ","opacity","clearCoat","clearCoatRoughness","specularMap","aomap","lightmap","emissivemap","bumpmap","displacementmap","roughnessmap","metalnessmap","gradientmap","points","PHYSICAL","USE_ENVMAP","ENVMAP_TYPE_CUBE","ENVMAP_BLENDING_MULTIPLY","TONE_MAPPING","toneMappingExposure","toneMappingWhitePoint","lightMapIntensity","aoMapIntensity","emissiveIntensity","envMapIntensity","refractionRatio","bumpscale","normalScale","Vector2","reflectivity","isMeshPhysicalMaterial","Material","buildTileFromWorker","event","BufferGeometry","positions","Float32Array","data","normals","index","IndexArrayClass","2","Uint16Array","4","Uint32Array","bpe","indices","uv","length","n","sqrt","_","floor","addAttribute","BufferAttribute","setIndex","computeBoundingSphere","computeBoundingBox","terrainMaterial","PBR","plane","name","castShadow","receiveShadow","scene","renderer","shadowMap","workerPool","workerPoolSize","navigator","hardwareConcurrency","i","worker","onmessage","push","currentWorker","postMessage","args","lastCameraPosition","currentKeysArray","tiles","pngs","deleteTile","tile","remove","dispose","camVec","tileBuilder","timestamp","cameraPosition","camera","getWorldDirection","targetPosition","max","abs","updatePosition","distanceTo","distance","zoomDelta","min","currentTileSize","x0","round","y0","segments0","segments1","cutOffDistance","distanceVector","cameraXY","objectXY","visibleKeysArray","visibleKeysString","k","toString","currentKeysString","potentialUnderKeys","slice","potentialUnderTiles","children","filter","child","includes","tileToCamera","subVectors","sort","a","b","userData","terrainKeysUnder","terrainTileUnder","newKeys","indexOf","existingKeys","forEach","newKey","console","segments","j","apply","toConsumableArray","distanceToCamera","visible","setTimeout","markedForDeletion","clean","MirroredRepeatWrapping","voxelOffset","emptyKeys","Set","buildVoxelsFromWorker","hasGeometry","pos1","normals1","index1","THREE","mesh","box","keyString","currentKeys","voxelBuilder","i0","j0","visibleKeys","Frustum","setFromMatrix","Matrix4","multiplyMatrices","projectionMatrix","matrixWorldInverse","has","sub","voxelBlock","ceil","voxelNumber","terrainLoops","activeTerrainIndex","keyboardJS","bind","e","textureFlare3","lensFlare","Lensflare","addElement","LensflareElement","motionBlurShader","tDepth","type","tColor","velocityFactor","delta","clipToWorldMatrix","previousWorldToClipMatrix","cameraMove","pilotDrone","horizonStyle","focalStyle","screenXYclamped","vec3","screenPosition","centered","arguments","undefined","vector","widthHalf","innerWidth","heightHalf","innerHeight","project","screenXY","clamp","Crosshair","react_default","createElement","props","viewBox","width","height","cx","cy","PureComponent","screenCenter","subscribe","msg","rendererSize","hudData","targets","targetsInSight","targetsInFront","gunTarget","HUD","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","state","time","gunHeat","lockLevel","pilot","publish","gunClock","running","getDelta","stop","_this2","times","target","lockClock","newState","setState","lock","_this3","Array","from","targetsData","assign","id","style","altitude","toFixed","speed","className","crosshair","fill","stroke","strokeWidth","strokeDasharray","transform","concat","strokeLinecap","gunHud","hudPosition","direction","fillOpacity","strokeOpacity","hud","element","life","arrow","innerHTML","Component","targetDistance2D","targetDistance3D","targetVector2D","targetVector3D","targetDirection","targetLoop","hudElement","mounted","borderColor","borderBottomColor","hudPositionCentered","color","angle","destroyed","start","delete","ZONE","velocity","ready","targetToDestroy","forceUpdate","localX","localY","rollAngle","pitch","rollAngleDegree","hudLoop","applyQuaternion","quaternion","angleTo","sign","dot","boxShadow","selectNearestGunTarget","update","distances","ReactDOM","render","hud_HUD","document","getElementById","fireGroupOptions","texture","frames","loop","depthTest","depthWrite","blending","AdditiveBlending","scale","maxParticleCount","pointsGroupOptions","NormalBlending","debrisGroupOptions","bulletGroupOptions","shockwaveOptions","particleCount","SPE","distributions","DISC","radius","spread","maxAge","duration","activeMultiplier","rotation","axis","static","Color","debrisOptions","SPHERE","acceleration","distribution","BOX","wiggle","drag","fireOptions","mistOptions","flashOptions","smokeOptions","smokeLightOptions","bulletOptions","sparkOptions","flashGroup","Group","fireGroup","debrisGroup","shockGroup","mistGroup","smokeGroup","smokeLightGroup","bulletGroup","sparkGroup","addPool","groups","group","renderOrder","frustumCulled","triggerSingleEmitter","follow","velocityFunction","emitter","getFromPool","initialPositions","params","velocities","collisions","bulletLine","targetVec3","chunkReducer","chunkSize","ar","it","ix","attributes","typedArray","array","attributeOffset","activationEnd","reduce","paramsArray","param","construct","pos","Line3","closestPointToPoint","triggerSmallExplosion","alive","disable","releaseIntoPool","enable","triggerExplosion","smoking","missile","smokeEmitter","triggerLightSmoke","tmpVec1","targetVector","gunEmitter","droneMesh","loader","GLTFLoader","loadDroneAssets","gltf","droneFactory","initDroneFactory","targetPositionFinal","Clock","NaN","lastPosition","terrainTiles","raycaster","Raycaster","downVector","offsetVector","lastTimestamp","loops","lookAt","intersectObjects","groundNormal","face","normal","spawnDrone","circle","phase","droneLoop","sin","deadDrone","random","FlyControls","object","domElement","nipple","pointer","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","on","nipplemove","updateMovementVector","pointerElement","zone","movements","dims","getContainerDimensions","left","top","pointerVector","move","dx","dy","mousemove","pageX","pageY","scope","fn","contextmenu","preventDefault","mockEvent","radian","tmpQuaternion","Quaternion","moveState","down","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","rotationVector","keydown","altKey","keyCode","movementSpeedMultiplier","updateRotationVector","keyup","container","halfWidth","halfHeight","deltaVelocity","deltaPosition","rotMult","multiply","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","removeEventListener","_keydown","_keyup","addEventListener","AutoPilot","ship","controls","active","uturnX","setAcceleration","isMobile","check","userAgent","vendor","opera","test","substr","mobileAndTabletcheck","display","touchPaneLeft","getElementsByClassName","nippleLook","nipplejs","mode","el","buttonX","pressX","fireBullet","button","autoPilot","toggle","constructor","autoRotate","bullet","MeshPhongMaterial","selectNearestTargetInSight","fire","callback","vec","newDir","tmpVec","terrainNormal","reflect","worldToLocal","audioLoader","AudioLoader","impacts","url","weapons","explosions","audioMapper","sound","buffer","setupSound","listener","AudioListener","PositionalAudio","setBuffer","setRefDistance","play","playExplosion","gatlingSound","Audio","setLoop","missileSound","WaterShader","surface","tReflectionMap","tRefractionMap","tNormalMap0","tNormalMap1","textureMatrix","config","Vector4","waterVertexShader","waterFragmentShader","UnderwaterShader","waterLevel","tDiffuse","tReflectionDepth","worldToClipMatrix","underwaterVertexShader","underwaterFragmentShader","src_renderer","src_scene","src_camera","src_drone","src_sunPosition","src_gui","src_options","queryStringOptions","queryString","parse","location","search","shadows","postprocessing","Scene","PerspectiveCamera","updateMatrixWorld","updateProjectionMatrix","WebGLRenderer","antialias","alpha","logarithmicDepthBuffer","gammaInput","gammaOutput","enabled","bias","PCFSoftShadowMap","autoUpdate","physicallyCorrectLights","toneMapping","Uncharted2ToneMapping","setSize","body","appendChild","gui","dat","GUI","autoPlace","closed","rendererFolder","addFolder","rendererController","low","href","pathname","stringify","lowShadow","lowShadowDoF","high","background","FogExp2","MeshBasicMaterial","sky","setScalar","skyGeo","SphereGeometry","faces","temp","c","skyDome","effectController","inclination","azimuth","sun","guiChanged","theta","phi","folder","onChange","initSky","shadow","mapSize","bottom","far","initLights","waterParameters","waterGeometry","PlaneBufferGeometry","water","Water","textureWidth","textureHeight","flowDirection","normalMap0","normalMap1","clipBias","flowSpeed","waterTarget","WebGLRenderTarget","depthMaterial","MeshDepthMaterial","depthBuffer","depthTexture","DepthTexture","__folders","isWater","underwaterReflector","Reflector","getRenderTarget","ref","setupDrones","particleGroups","shakeCamera","tick","glitch","motionPass","renderToScreen","LOD","underwaterPass","wigglePass","onBeforeRender","item","removeLoop","unshift","setPixelRatio","stats","Stats","dom","composer","EffectComposer","renderPass","RenderPass","addPass","ShaderPass","upass","previousMatrixWorldInverse","previousProjectionMatrix","previousCameraPosition","tmpMatrix","GlitchPass","mainLoop","requestAnimationFrame","getInverse","overrideMaterial","setRenderTarget","dimension","aspect","WindowResize"],"mappings":"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","file":"static/js/main.a1b02339.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/Rock_08_UV_H_CM_1.da494a88.jpg\";","module.exports = __webpack_public_path__ + \"static/media/Rock_08_UV_H_CM_1_normal.6085c2f7.jpg\";","module.exports = __webpack_public_path__ + \"static/media/GrassGreenTexture0003.78621f63.jpg\";","module.exports = __webpack_public_path__ + \"static/media/GrassGreenTexture0003_normal.002f20c3.jpg\";","// THREE.js dependecies from SPE\nexport {\n  BufferAttribute,\n  REVISION,\n  ShaderChunk,\n  Vector2,\n  Vector3,\n  Vector4,\n  Color,\n  Texture,\n  Math,\n  AdditiveBlending,\n  ShaderMaterial,\n  BufferGeometry,\n  Points\n} from 'three'\n","module.exports = __webpack_public_path__ + \"static/media/Water_1_M_Normal.a33d50da.jpg\";","module.exports = __webpack_public_path__ + \"static/media/Water_2_M_Normal.639428cf.jpg\";","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"static/js/terrain.worker.f5d6880c.js\");\n};","module.exports = \"#define PHYSICAL\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\tvarying vec3 vNormal2;\\n\\n#endif\\n\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n#include <envmap_pars_vertex>\\n\\nvoid main() {\\n\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\n#endif\\n\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n\\tvViewPosition = - mvPosition.xyz;\\n\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n\\t#include <envmap_vertex>\\n\\n\\tvNormal2 = normal;\\n}\\n\"","module.exports = \"#define PHYSICAL\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\n// ####### custom uniforms #########\\nuniform sampler2D rockTexture;\\nuniform sampler2D rockTextureNormal;\\n// #################################\\n\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\n\\nvarying vec3 vViewPosition;\\nvarying vec3 vWorldPosition;\\nvarying vec3 vNormal2;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars_begin>\\n#include <envmap_physical_pars_fragment>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\n\\t// accumulation\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\n\\t// modulation\\n\\t#include <aomap_fragment>\\n\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t// #include <specularmap_fragment>\\n\\t// #include <envmap_fragment>\\n\\t// return vec4(envColor.rgb, 1.0);\\n\\treturn vec4(outgoingLight, diffuseColor.a);\\n}\\n\\nvoid main() {\\n\\n\\t#include <clipping_planes_fragment>\\n\\n\\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\\n\\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\\n\\tvec3 normal = normalize( vNormal2 );\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\tfloat flatness = dot(normal, vec3(0.0, 0.0, 1.0));\\n\\tvec4 colorTerrain = mix(\\n\\t\\trockColor,\\n\\t\\t// rockColor,\\n\\t\\tgrassColor,\\n\\t\\tsmoothstep(0.6, 0.7, flatness)\\n\\t);\\n\\tgl_FragColor = colorTerrain;\\n\\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\\n\\tvec3 outgoingLight = gl_FragColor.rgb;\\n\\t#include <specularmap_fragment>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\\n\\n\\n\\t// gl_FragColor = vec4(material.specularColor, 1.0);\\n\\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\\n\\t// gl_FragColor = vec4(directLight.direction, 1.0);\\n\\t// // gl_FragColor = texture2D(map, vUv);\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\\n\\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\\n\\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\\n\\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\\n\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\n\\t//  FOG\\n\\t// #include <fog_fragment>\\n\\treflectVec = refract( cameraToVertex, worldNormal, 1.0 );\\n\\tvec4 fogColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\n\\tfogFactor = mix(fogFactor, fogFactor / 10.0, smoothstep(100.0, 300.0, vWorldPosition.z));\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor.rgb, fogFactor );\\n\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\nvarying vec3 vNormal2;\\nvarying float flatness;\\nvarying vec3 vWorldPosition;\\n\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\nvoid main() {\\n\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\n#endif\\n\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n\\tvViewPosition = - mvPosition.xyz;\\n\\n\\t// #include <worldpos_vertex>\\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n\\n\\tvNormal2 = normalize(normal);\\n\\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\\n  vWorldPosition = position;\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\n// ####### custom uniforms #########\\nuniform sampler2D rockTexture;\\nuniform sampler2D rockTextureNormal;\\n// #################################\\n\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\n\\nvarying vec3 vViewPosition;\\nvarying vec3 vWorldPosition;\\nvarying vec3 vNormal2;\\nvarying float flatness;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars_begin>\\n#include <envmap_physical_pars_fragment>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n\\n// #include <normalmap_pars_fragment>\\n#ifdef USE_NORMALMAP\\n\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\n\\t// Per-Pixel Tangent Space Normal Mapping\\n\\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm) {\\n\\n\\t\\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\\n\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\n\\t}\\n\\n#endif\\n\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\n\\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\\n\\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\\n\\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\\n\\n\\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\\n\\n\\t#include <logdepthbuf_fragment>\\n\\n\\t// #include <map_fragment>\\n\\tvec4 texelColorXY = texture2D( map, vUvXY );\\n\\tvec4 texelColorXZ = texture2D( map, vUvXZ );\\n\\tvec4 texelColorYZ = texture2D( map, vUvYZ );\\n\\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\\n\\tvec4 texelColor = (\\n\\t\\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\\n\\t\\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\\n\\t\\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\\n\\t);\\n\\t// texelColor = texelColorXY;\\n\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n\\t// return diffuseColor;\\n\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\n\\t#include <emissivemap_fragment>\\n\\n\\t// accumulation\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\n\\t// modulation\\n\\t#include <aomap_fragment>\\n\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t// #include <specularmap_fragment>\\n\\t// #include <envmap_fragment>\\n\\t// return vec4(envColor.rgb, 1.0);\\n\\treturn vec4(outgoingLight, diffuseColor.a);\\n}\\n\\nvoid main() {\\n\\n\\t#include <clipping_planes_fragment>\\n\\n\\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\\n\\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\\n\\tvec4 colorTerrain = mix(\\n\\t\\trockColor,\\n\\t\\tgrassColor,\\n\\t\\tsmoothstep(0.6, 0.7, flatness)\\n\\t);\\n\\tgl_FragColor = colorTerrain;\\n\\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\\n\\tvec3 outgoingLight = gl_FragColor.rgb;\\n\\t#include <specularmap_fragment>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\\n\\n\\n\\t// gl_FragColor = vec4(material.specularColor, 1.0);\\n\\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\\n\\t// gl_FragColor = vec4(directLight.direction, 1.0);\\n\\t// // gl_FragColor = texture2D(map, vUv);\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\\n\\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\\n\\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\\n\\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\\n\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\n\\t#include <fog_fragment>\\n\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\nvarying vec3 vNormal2;\\nvarying float flatness;\\nvarying vec3 vWorldPosition;\\nvarying vec2 vNoise;\\n\\n\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\n\\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\\n\\nfloat noise(vec3 p){\\n    vec3 a = floor(p);\\n    vec3 d = p - a;\\n    d = d * d * (3.0 - 2.0 * d);\\n\\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\\n    vec4 k1 = perm(b.xyxy);\\n    vec4 k2 = perm(k1.xyxy + b.zzww);\\n\\n    vec4 c = k2 + a.zzzz;\\n    vec4 k3 = perm(c);\\n    vec4 k4 = perm(c + 1.0);\\n\\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\\n\\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\\n\\n    return o4.y * d.y + o4.x * (1.0 - d.y);\\n}\\n\\n\\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\\nvec4 fade(vec4 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\\n\\nfloat cnoise(vec4 P){\\n  vec4 Pi0 = floor(P); // Integer part for indexing\\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\\n  Pi0 = mod(Pi0, 289.0);\\n  Pi1 = mod(Pi1, 289.0);\\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\\n  vec4 iz0 = vec4(Pi0.zzzz);\\n  vec4 iz1 = vec4(Pi1.zzzz);\\n  vec4 iw0 = vec4(Pi0.wwww);\\n  vec4 iw1 = vec4(Pi1.wwww);\\n\\n  vec4 ixy = permute(permute(ix) + iy);\\n  vec4 ixy0 = permute(ixy + iz0);\\n  vec4 ixy1 = permute(ixy + iz1);\\n  vec4 ixy00 = permute(ixy0 + iw0);\\n  vec4 ixy01 = permute(ixy0 + iw1);\\n  vec4 ixy10 = permute(ixy1 + iw0);\\n  vec4 ixy11 = permute(ixy1 + iw1);\\n\\n  vec4 gx00 = ixy00 / 7.0;\\n  vec4 gy00 = floor(gx00) / 7.0;\\n  vec4 gz00 = floor(gy00) / 6.0;\\n  gx00 = fract(gx00) - 0.5;\\n  gy00 = fract(gy00) - 0.5;\\n  gz00 = fract(gz00) - 0.5;\\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\\n  vec4 sw00 = step(gw00, vec4(0.0));\\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\\n\\n  vec4 gx01 = ixy01 / 7.0;\\n  vec4 gy01 = floor(gx01) / 7.0;\\n  vec4 gz01 = floor(gy01) / 6.0;\\n  gx01 = fract(gx01) - 0.5;\\n  gy01 = fract(gy01) - 0.5;\\n  gz01 = fract(gz01) - 0.5;\\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\\n  vec4 sw01 = step(gw01, vec4(0.0));\\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\\n\\n  vec4 gx10 = ixy10 / 7.0;\\n  vec4 gy10 = floor(gx10) / 7.0;\\n  vec4 gz10 = floor(gy10) / 6.0;\\n  gx10 = fract(gx10) - 0.5;\\n  gy10 = fract(gy10) - 0.5;\\n  gz10 = fract(gz10) - 0.5;\\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\\n  vec4 sw10 = step(gw10, vec4(0.0));\\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\\n\\n  vec4 gx11 = ixy11 / 7.0;\\n  vec4 gy11 = floor(gx11) / 7.0;\\n  vec4 gz11 = floor(gy11) / 6.0;\\n  gx11 = fract(gx11) - 0.5;\\n  gy11 = fract(gy11) - 0.5;\\n  gz11 = fract(gz11) - 0.5;\\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\\n  vec4 sw11 = step(gw11, vec4(0.0));\\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\\n\\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\\n\\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\\n  g0000 *= norm00.x;\\n  g0100 *= norm00.y;\\n  g1000 *= norm00.z;\\n  g1100 *= norm00.w;\\n\\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\\n  g0001 *= norm01.x;\\n  g0101 *= norm01.y;\\n  g1001 *= norm01.z;\\n  g1101 *= norm01.w;\\n\\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\\n  g0010 *= norm10.x;\\n  g0110 *= norm10.y;\\n  g1010 *= norm10.z;\\n  g1110 *= norm10.w;\\n\\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\\n  g0011 *= norm11.x;\\n  g0111 *= norm11.y;\\n  g1011 *= norm11.z;\\n  g1111 *= norm11.w;\\n\\n  float n0000 = dot(g0000, Pf0);\\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\\n  float n1111 = dot(g1111, Pf1);\\n\\n  vec4 fade_xyzw = fade(Pf0);\\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\\n  return 2.2 * n_xyzw;\\n}\\n\\n\\nvoid main() {\\n\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\n#endif\\n\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n\\tvViewPosition = - mvPosition.xyz;\\n\\n\\t// transformed = floor(transformed);\\n\\n\\t// #include <worldpos_vertex>\\n\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n\\n\\tvNormal2 = normalize(normal);\\n\\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\\n\\tvWorldPosition = position;\\n\\t// uvnoise = vec2(\\n\\t// \\t// (sin((position.x + position.y + position.z) + / 30.0)) * 0.3333332,\\n\\n\\t// \\t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332,\\n\\t// \\t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332\\n\\n\\t// \\t// mod((position.x + position.y + position.z), 10.0) / 10.0,\\n\\t// \\t// mod((position.x + position.y + position.z), 10.0) / 10.0\\n\\n\\t// \\t// mod(mod(position.x, 1.0) + position.z, 1.0),\\n\\t// \\t// mod(mod(position.y, 1.0) + position.z, 1.0)\\n\\n\\t// \\t// mod(position.x + 0.5 * cnoise(vec4(position, 1.0)), 10.0) / 10.0,\\n\\t// \\t// mod(position.y + 0.5 * cnoise(vec4(position.zyx, 1.0)), 10.0) / 10.0\\n\\n  vNoise = vec2(\\n    noise(position / 50.0),\\n    noise(position.zyx / 50.0)\\n  );\\n\\n\\t// \\t// cos(position / 5.0) * 0.5 + 0.5,\\n\\t// \\t// cos(position.zyx / 5.0) * 0.5 + 0.5\\n\\n\\t// \\t// noise(position.xyz) * mod(position.z, 10.0) / 10.0,\\n\\t// \\t// noise(position.zyx) * mod(position.z, 10.0) / 10.0\\n\\t// );\\n\\t// vUv = uvnoise;\\n\\n\\t// vec2 vUvXY = vec2(mod(position.x, 100.0) / 100.0, mod(position.y, 100.0) / 100.0 );\\n\\t// vec2 vUvXZ = vec2(mod(position.x, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\\n\\t// vec2 vUvYZ = vec2(mod(position.y, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\\n\\n\\t// vec3 mixer = clamp(abs(normal), 0.0000001, 1.0);\\n\\t// vec2 zero2 = vec2(0.0, 0.0);\\n\\t// vUv = (\\n\\t// \\tmix(zero2, vUvXY, pow(mixer.z, 2.5)) +\\n\\t// \\tmix(zero2, vUvXZ, pow(mixer.y, 2.5)) +\\n\\t// \\tmix(zero2, vUvYZ, pow(mixer.x, 2.5))\\n\\t// );\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\n// ####### custom uniforms #########\\nuniform sampler2D rockTexture;\\nuniform sampler2D rockTextureNormal;\\n// #################################\\n\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\n\\nvarying vec3 vViewPosition;\\nvarying vec3 vWorldPosition;\\nvarying vec2 vNoise;\\nvarying vec3 vNormal2;\\nvarying float flatness;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars_begin>\\n#include <envmap_physical_pars_fragment>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n\\n// #include <normalmap_pars_fragment>\\n#ifdef USE_NORMALMAP\\n\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\n\\t// Per-Pixel Tangent Space Normal Mapping\\n\\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 vUv1, vec2 vUv2, vec2 vUv3) {\\n\\n\\t\\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\\n\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\n\\t\\tvec3 mapN1 = texture2D( normalMap, vUv1 ).xyz;\\n\\t\\tvec3 mapN2 = texture2D( normalMap, vUv2 ).xyz;\\n\\t\\tvec3 mapN3 = texture2D( normalMap, vUv3 ).xyz;\\n\\t\\tvec3 black = vec3(0.0, 0.0, 0.0);\\n\\t\\tvec3 mapN = (\\n\\t\\t\\tmix(black, mapN1, pow(N.z, 2.5)) +\\n\\t\\t\\tmix(black, mapN2, pow(N.y, 2.5)) +\\n\\t\\t\\tmix(black, mapN3, pow(N.x, 2.5))\\n\\t\\t);\\n\\t\\t// return mapN;\\n\\t\\tmapN = mapN * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\n\\t}\\n\\n#endif\\n\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\\n\\n\\t// return vec4(vUv, 0.0, 1.0);\\n\\t// return vec4(clamp(vNormal2.z, 0.0, 1.0), 0.0, 0.0, 1.0);\\n\\t// return vec4(cos(vWorldPosition.xyz / 5.0) * 0.5 + 0.5, 1.0);\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\n\\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\\n\\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\\n\\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\\n\\n\\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\\n\\n\\t#include <logdepthbuf_fragment>\\n\\n\\t// #include <map_fragment>\\n\\tvec4 texelColorXY = texture2D( map, vUvXY );\\n\\tvec4 texelColorXZ = texture2D( map, vUvXZ );\\n\\tvec4 texelColorYZ = texture2D( map, vUvYZ );\\n\\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\\n\\tvec4 texelColor = (\\n\\t\\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\\n\\t\\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\\n\\t\\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\\n\\t);\\n\\t// texelColor = texelColorXY;\\n\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n\\t// return diffuseColor;\\n\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t// #include <normal_fragment_maps>\\n\\t// normal = perturbNormal2Arb( -vViewPosition, normal , vUvXY, vUvXZ, vUvYZ);\\n\\t// return vec4(normal, 1.0);\\n\\t// #include <emissivemap_fragment>\\n\\n\\t// accumulation\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\n\\t// modulation\\n\\t// #include <aomap_fragment>\\n\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t// #include <specularmap_fragment>\\n\\t// #include <envmap_fragment>\\n\\t// return vec4(envColor.rgb, 1.0);\\n\\treturn vec4(outgoingLight, diffuseColor.a);\\n}\\n\\nvoid main() {\\n\\n\\t#include <clipping_planes_fragment>\\n\\n\\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\\n\\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\\n\\tvec4 colorTerrain = mix(\\n\\t\\trockColor,\\n\\t\\tgrassColor,\\n\\t\\tsmoothstep(0.15, 0.3, flatness * vNoise.x + flatness * vNoise.y)\\n\\t\\t// smoothstep(vNoise.x, vNoise.y, flatness)\\n\\t);\\n\\tgl_FragColor = colorTerrain;\\n\\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\\n\\tvec3 outgoingLight = gl_FragColor.rgb;\\n\\t#include <specularmap_fragment>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\\n\\n\\n\\t// gl_FragColor = vec4(material.specularColor, 1.0);\\n\\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\\n\\t// gl_FragColor = vec4(directLight.direction, 1.0);\\n\\t// // gl_FragColor = texture2D(map, vUv);\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\\n\\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\\n\\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\\n\\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\\n\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\n\\t#include <fog_fragment>\\n\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n\\n\\t// gl_FragColor = vec4(flatness, flatness, flatness, 1.0);\\n\\n}\\n\"","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"static/js/voxel.worker.46a0c964.js\");\n};","module.exports = \"#include <common>\\n#include <fog_pars_fragment>\\n\\nuniform sampler2D tReflectionMap;\\nuniform sampler2D tRefractionMap;\\nuniform sampler2D tNormalMap0;\\nuniform sampler2D tNormalMap1;\\nuniform sampler2D tDepth;\\n\\n#ifdef USE_FLOWMAP\\nuniform sampler2D tFlowMap;\\n#else\\nuniform vec2 flowDirection;\\n#endif\\n\\nuniform vec3 color;\\nuniform float reflectivity;\\nuniform float surface;\\nuniform vec4 config;\\nuniform mat4 clipToWorldMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvec3 surfaceColor = vec3(0.0078, 0.5176, 0.7);\\nvec3 shoreColor = vec3(0.0078, 0.5176, 0.7);\\nvec3 depthColor = vec3(0.0039, 0.00196, 0.145);\\n// Description : Water color based on water depth and color extinction\\n//\\n// based on Rendering Water as a Post-process Effect by Wojciech Toman\\n//\\n\\n// waterTransparency - x = , y = water visibility along eye vector,\\n// waterDepthValues - x = water depth in world space, y = view/accumulated water depth in world space\\nvec3 DepthRefraction(float waterDepth, float viewWaterDepth, vec3 refractionColor)\\n{\\n  float waterClarity = 0.75;\\n  float visibility = 200.;\\n  float shoreRange = 50.;\\n  float horizontalExtinction = 200.;\\n\\n  float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\\n  float accDepthExp = saturate(accDepth / (2.5 * visibility));\\n  accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\\n\\n  surfaceColor = mix(shoreColor, surfaceColor, saturate(waterDepth / shoreRange));\\n  vec3 waterColor = mix(surfaceColor, depthColor, saturate(waterDepth / horizontalExtinction));\\n\\n  refractionColor = mix(refractionColor, surfaceColor * waterColor, saturate(accDepth / visibility));\\n  refractionColor = mix(refractionColor, depthColor, accDepthExp);\\n  refractionColor = mix(refractionColor, depthColor * waterColor, saturate(waterDepth / horizontalExtinction));\\n  return refractionColor;\\n}\\n\\nvoid main() {\\n\\n  float flowMapOffset0 = config.x;\\n  float flowMapOffset1 = config.y;\\n  float halfCycle = config.z;\\n  float scale = config.w;\\n\\n  vec3 toEye = normalize( vToEye );\\n  vec3 surfacePosition = cameraPosition - vToEye;\\n\\n  // determine flow direction\\n  vec2 flow;\\n  #ifdef USE_FLOWMAP\\n  flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\\n  #else\\n  flow = flowDirection;\\n  #endif\\n  flow.x *= - 1.0;\\n\\n  // sample normal maps (distort uvs with flowdata)\\n  vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\\n  vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\\n\\n  // linear interpolate to get the final normal color\\n  float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\\n\\n  // calculate normal vector\\n  //  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, normalColor.b ));\\n\\n  // calculate the fresnel term to blend reflection and refraction maps\\n  float theta = max( dot( toEye, normal ), 0.0 );\\n  float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\\n\\n  // calculate final uv coords\\n  vec3 coord = vCoord.xyz / vCoord.w;\\n  vec2 uv = coord.xy + coord.z * normal.xy * 0.1;\\n\\n  vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\\n  vec4 refractColor = texture2D( tRefractionMap, uv );\\n\\n  // water depth\\n\\n  float zOverW = texture2D(tDepth, coord.xy).x;\\n  // clipPosition is the viewport position at this pixel in the range -1 to 1.\\n  vec4 clipPosition = vec4(coord.xy * 2. - 1., zOverW * 2. - 1., 1.);\\n  vec4 worldPosition = clipToWorldMatrix * clipPosition;\\n  worldPosition /= worldPosition.w;\\n\\n  float waterDepth = surfacePosition.z - worldPosition.z;\\n  float viewWaterDepth = length(surfacePosition - worldPosition.xyz);\\n\\n  float depthDensity = 0.01;\\n  float depthFactor = whiteCompliment( exp2( - depthDensity * depthDensity * viewWaterDepth * viewWaterDepth * LOG2 ) );\\n  refractColor.rgb = mix( refractColor.rgb, depthColor, depthFactor );\\n  // refractColor.rgb = DepthRefraction(waterDepth, viewWaterDepth, refractColor.rgb);\\n\\n  // multiply water color with the mix of both textures\\n  gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\\n  // gl_FragColor = refractColor;\\n  // gl_FragColor = vec4(vec3(waterDepth/500.), 1.0);\\n\\n  // #include <tonemapping_fragment>\\n  // #include <encodings_fragment>\\n  // #include <fog_fragment>\\n\\n}\"","module.exports = \"#include <fog_pars_vertex>\\n\\nuniform mat4 textureMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvoid main() {\\n\\n  vUv = uv;\\n  vCoord = textureMatrix * vec4( position, 1.0 );\\n\\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n  vToEye = cameraPosition - worldPosition.xyz;\\n\\n  vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\\n  gl_Position = projectionMatrix * mvPosition;\\n\\n  #include <fog_vertex>\\n\\n}\"","module.exports = \"#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n\\nuniform sampler2D tDiffuse;\\nuniform sampler2D tDepth;\\nuniform sampler2D tReflectionMap;\\nuniform sampler2D tReflectionDepth;\\nuniform sampler2D tNormalMap0;\\nuniform sampler2D tNormalMap1;\\n\\n#ifdef USE_FLOWMAP\\nuniform sampler2D tFlowMap;\\n#else\\nuniform vec2 flowDirection;\\n#endif\\n\\nuniform vec3 color;\\nuniform float reflectivity;\\nuniform float time;\\nuniform float waterLevel;\\nuniform vec4 config;\\nuniform vec3 sunPosition;\\nuniform mat4 clipToWorldMatrix;\\nuniform mat4 worldToClipMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\n// vec3 depthColor = vec3(0.0039, 0.00196, 0.145);\\nvec3 depthColor = vec3(0.0117, 0.0117, 0.325);\\n\\n#define TAU 6.28318530718\\n#define MAX_ITER 5\\nvec3 caustic(vec2 uv) {\\n  vec2 p = mod(uv*TAU, TAU)-250.0;\\n\\n  vec2 i = vec2(p);\\n  float c = 1.0;\\n  float inten = .005;\\n\\n  for (int n = 0; n < MAX_ITER; n++) {\\n    float t = time * (1.0 - (3.5 / float(n+1)));\\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\\n  }\\n\\n  c /= float(MAX_ITER);\\n  c = 1.17-pow(c, 1.4);\\n  vec3 color = vec3(pow(abs(c), 8.0));\\n  // color = clamp(color + vec3(0.0, 0.35, 0.5), 0.0, 1.0);\\n  color = mix(color, vec3(1.0,1.0,1.0),0.5);\\n\\n  return color;\\n}\\n\\nfloat causticX(float x, float power, float gtime) {\\n  float p = mod(x*TAU, TAU)-250.0;\\n\\n  float i = p;;\\n  float c = 1.0;\\n  float inten = .005;\\n\\n  for (int n = 0; n < MAX_ITER/2; n++) {\\n    float t = gtime * (1.0 - (3.5 / float(n+1)));\\n    i = p + cos(t - i) + sin(t + i);\\n    c += 1.0/length(p / (sin(i+t)/inten));\\n  }\\n  c /= float(MAX_ITER);\\n  c = 1.17-pow(c, power);\\n\\n  return c;\\n}\\n\\nfloat GodRays(vec2 uv) {\\n  float light = 0.0;\\n  vec4 uvSun = worldToClipMatrix * vec4(sunPosition, 1.);\\n  uvSun /= uvSun.w;\\n  uvSun = uvSun / 2. + 0.5;\\n  vec2 uv2 = vec2(\\n    dot(normalize(uv - uvSun.xy), vec2(1., 0.)),\\n    length(uv - uvSun.xy)\\n  );\\n\\n  light += pow(causticX((uv2.x + 0.08 * uv2.y) / 1.7 + 0.5, 1.8, time * 0.65), 10.0) * 0.05;\\n  light += pow(causticX(sin(uv2.x), 0.3, time * 0.7), 9.0) * 0.4;\\n  light += pow(causticX(cos(uv2.x * 2.3), 0.3, time * 1.3), 4.0) * 0.1;\\n\\n  light *= smoothstep(0., .3, uv2.y) * smoothstep(0., .3, uv2.y);\\n  light = clamp(light, 0.0, 1.0);\\n\\n  return light;\\n}\\n\\n#define HASHSCALE1 .1031\\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\\nfloat hash11(float p)\\n{\\n  vec3 p3  = fract(vec3(p) * HASHSCALE1);\\n    p3 += dot(p3, p3.yzx + 19.19);\\n    return fract((p3.x + p3.y) * p3.z);\\n}\\nvec3 hash33(vec3 p3)\\n{\\n  p3 = fract(p3 * HASHSCALE3);\\n    p3 += dot(p3, p3.yxz+19.19);\\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\\n}\\n\\nconst int   STAR_VOXEL_STEPS = 8;\\nconst float STAR_VOXEL_STEP_SIZE = 3.;\\n\\nfloat distanceRayPoint(vec3 ro, vec3 rd, vec3 p, out float h) {\\n    h = dot(p - ro, rd);\\n    return length(p - ro - rd * h);\\n}\\nvec3 getDotColour(float t)\\n{\\n  return vec3(t*.57,t*.3,t*.05);\\n  return vec3(t*.9,t*.9,t*.9);\\n  return vec3(t*.3,t*.6,t*.5);\\n}\\n\\n// This code is the starfield stuff from iapafoto\\n// https://www.shadertoy.com/view/Xl2BRR\\nvec4 detritus(in vec3 ro, in vec3 rd, in float tmax) {\\n\\n  float d =  0.;\\n\\n  vec3 ros = ro + rd*d;\\n  ros /= STAR_VOXEL_STEP_SIZE;\\n  vec3 pos = floor(ros),\\n       mm, ri = 1./rd,\\n       rs = sign(rd),\\n       dis = (pos - ros + 0.5 + rs * 0.5) * ri;\\n\\n  float dint;\\n  vec3 offset, id;\\n  vec4 col = vec4(0);\\n  vec4 sum = vec4(0);\\n\\n  for(int i = 0; i < STAR_VOXEL_STEPS; i++) {\\n    id = hash33(pos);\\n    float size  = hash11(float(i))*.02 + .005;\\n    offset = clamp(id + .2 * cos(id + id.x * time), size, 1. - size);\\n    d = distanceRayPoint(ros, rd, pos + offset, dint);\\n\\n    if (dint > 0. && dint * STAR_VOXEL_STEP_SIZE < tmax) {\\n      col = vec4(getDotColour(id.x), .8) * smoothstep(size, 0.0, d);\\n      col.a *= smoothstep(float(STAR_VOXEL_STEPS), 0., dint);\\n      col.rgb *= col.a / dint;\\n      sum += (1. - sum.a) * col;\\n      if (sum.a>.99) break;\\n    }\\n\\n    mm = step(dis.xyz, dis.yxy) * step(dis.xyz, dis.zzx);\\n    dis += mm * rs * ri;\\n    pos += mm * rs;\\n  }\\n\\n  return sum * .75;\\n}\\n\\n\\nvoid main() {\\n\\n  float flowMapOffset0 = config.x;\\n  float flowMapOffset1 = config.y;\\n  float halfCycle = config.z;\\n  float scale = config.w;\\n\\n  float depth = texture2D(tDepth, vUv).x;\\n  float w;\\n  // float logDepthBufFC = 2.0 / log2( 1000000. + 1.0 );\\n  // float w = pow(2.0, (2. * depth / logDepthBufFC)) - 1.0;\\n  // depth = viewZToPerspectiveDepth(-w, 1., 1000000.);\\n\\n  vec4 world = clipToWorldMatrix * vec4(vUv * 2. - 1., depth * 2. - 1., 1.0);\\n  world /= world.w;\\n  float worldDistance = length(world.xyz - cameraPosition);\\n\\n  vec3 dir = normalize(world.xyz - cameraPosition);\\n  vec3 hitPoint = linePlaneIntersect(cameraPosition, dir, vec3(0., 0., waterLevel), vec3(0., 0., -1.));\\n  float hitDirection = dot(hitPoint - cameraPosition, dir);\\n  float hitDistance = hitDirection > 0. ? length(hitPoint - cameraPosition) : 1e7;\\n\\n  float dist = min(hitDistance, worldDistance);\\n  float fogDensity = 0.007;\\n  float fogFactor;\\n  vec3 nearestPoint = dist == hitDistance ? hitPoint : world.xyz;\\n  float waterDepth = waterLevel - nearestPoint.z;\\n\\n  // sample normal maps (distort uvs with flowdata)\\n  vec2 nUV = fract(hitPoint.xy / 15.);\\n  vec2 flow = vec2(1., 1.);\\n  vec4 normalColor0 = texture2D( tNormalMap0, nUV + flow * time / 10.);\\n  vec4 normalColor1 = texture2D( tNormalMap1, nUV + flow * time / 10.);\\n\\n  // linear interpolate to get the final normal color\\n  float flowLerp = sin(time) / 2. + 0.5;\\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\\n\\n  // calculate normal vector\\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, -normalColor.b ));\\n  vec3 waterNormal = normalize(normal);\\n  vec4 coord = worldToClipMatrix * vec4(hitPoint.xy + waterNormal.xy * waterNormal.z * 3., hitPoint.z, 1.0);\\n  coord /= coord.w;\\n  coord = coord / 2.0 + 0.5;\\n  // coord.xy = vUv;\\n\\n  if (worldDistance < hitDistance) {\\n    gl_FragColor = texture2D(tDiffuse, vUv);\\n    gl_FragColor.rgb *= caustic(nearestPoint.xy / 10.);\\n  } else {\\n\\n    // calculate the fresnel term to blend reflection and refraction maps\\n    float theta = max( dot( -dir, waterNormal ), 0.0 );\\n    float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\\n    reflectance = (1. - length(refract(dir, waterNormal, 1.33))) * reflectance;\\n    reflectance = clamp(reflectance, 0.15, 0.85);\\n\\n    vec4 reflectColor = texture2D( tReflectionMap, vec2(1. - coord.x, coord.y) );\\n    vec4 reflectDepth = texture2D( tReflectionDepth, vec2(1.0 - coord.x, coord.y) );\\n    vec4 refractColor = texture2D( tDiffuse, coord.xy );\\n\\n    // w = pow(2.0, (2. * reflectDepth.x / logDepthBufFC)) - 1.0;\\n    // w = -perspectiveDepthToViewZ(reflectDepth.x, 1., 1000000.);\\n    // reflectDepth.x = viewZToPerspectiveDepth(-w, 1., 1000000.);\\n    w = 500. * reflectDepth.x + dist;\\n\\n    fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * w * w * LOG2 ) );\\n    reflectColor.rgb = mix(reflectColor.rgb, depthColor, fogFactor);\\n\\n    // multiply water color with the mix of both textures\\n    gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\\n    // gl_FragColor = vec4(vec3(reflectance), 1.0);\\n    // gl_FragColor = reflectColor;\\n    // gl_FragColor = reflectDepth;\\n    // gl_FragColor = vec4(vec3(w/500.), 1.0);\\n    // gl_FragColor = vec4(vec3(w/100.), 1.0);\\n\\n}\\n\\n// float fogDepth = dist + waterDepth * min(1., waterDepth / 100.);\\nfloat fogDepth = dist + clamp(waterLevel - cameraPosition.z, 0., 100.);\\nfogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\ngl_FragColor.rgb = mix(gl_FragColor.rgb, depthColor, fogFactor);\\n\\ngl_FragColor.rgb += GodRays(vUv) * (1. - smoothstep(0., 100., waterLevel - cameraPosition.z));\\n\\nvec4 star = detritus(cameraPosition, dir,  min(40., dist / STAR_VOXEL_STEP_SIZE));\\ngl_FragColor.rgb = gl_FragColor.rgb * (1.0 - star.a)+star.rgb;\\n\\n\\n// gl_FragColor = texture2D(tReflectionMap, vec2(1.0 - vUv.x, vUv.y));\\n// gl_FragColor = vec4(dir, 1.);\\n// gl_FragColor = vec4( vec3(dist /1000.), 1.0 );\\n// gl_FragColor = vec4( vec3(hitDistance/100.), 1.0 );\\n// gl_FragColor = vec4( vec3(dist/100.), 1.0 );\\n\\n}\"","module.exports = \" #include <fog_pars_vertex>\\n\\nuniform mat4 textureMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvoid main() {\\n\\nvUv = uv;\\nvCoord = textureMatrix * vec4( position, 1.0 );\\n\\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\nvToEye = cameraPosition - worldPosition.xyz;\\n\\nvec4 mvPosition = viewMatrix * worldPosition; // used in fog_vertex\\ngl_Position = projectionMatrix * mvPosition;\\n\\n#include <fog_vertex>\\n\\n}\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Qzk3MDg1MDY1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Qzk3MDg1MDc1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOTcwODUwNDUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOTcwODUwNTUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Po4pkJAAAA9KSURBVHja7F0JdqMw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\"","module.exports = __webpack_public_path__ + \"static/media/Explosion_002_Tile_8x8_256x256.d28fc70f.png\";","module.exports = __webpack_public_path__ + \"static/media/smokeparticle.4939a8d2.png\";","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gIBEhghhPTbNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABF0lEQVQ4y62TsU7DQBBE39opHKS4AuUrkjKlC/qUlPxcSij5A5cuyVdYSZVIGCGZoRlLF8sBJDjpdNZ6Zm92bzaYWJKW/hzOFiAi2jE2JshroAJWwNzhDtgDdUS8XiSQFBEh37oBHnzeAYVx78ABaIBnoBnUzJJkG+ARuAdKIE8UFsACuE2SvgySQ9Ja0k7SUVIv6fPK7o3ZuVRmblRlBWVy67g/cqw0tpLUZv6xcs35teYmsdzYFUBmBXPXNkWcSlSYs8z448psks5PpV9wZGwHtIOCvd+5T0BTRIw5mENmQ9Q2ySkBarSH2MnY+sLakraSnvzOHyM/9I4djdkOvNSJTWLbH638f8P0zTgvgBuH3oDz1Dh/AWVJt7banagAAAAAAElFTkSuQmCC\"","module.exports = __webpack_public_path__ + \"static/media/impact1.db06d2c4.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact2.7d720129.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact3.7a5b4e82.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact4.43348926.ogg\";","module.exports = __webpack_public_path__ + \"static/media/gatling.b8ff47f4.ogg\";","module.exports = __webpack_public_path__ + \"static/media/missile.f0faf674.ogg\";","module.exports = __webpack_public_path__ + \"static/media/explosion1.2f1ab236.ogg\";","module.exports = __webpack_public_path__ + \"static/media/explosion2.752472e3.ogg\";","import PubSub from 'pubsub-js'\n\n// PubSub.subscribe('x', (msg, data) => console.log(msg, data))\n\nexport default PubSub\n","/**\n * @author zz85 / https://github.com/zz85\n *\n * Based on \"A Practical Analytic Model for Daylight\"\n * aka The Preetham Model, the de facto standard analytic skydome model\n * http://www.cs.utah.edu/~shirley/papers/sunsky/sunsky.pdf\n *\n * First implemented by Simon Wallner\n * http://www.simonwallner.at/projects/atmospheric-scattering\n *\n * Improved by Martin Upitis\n * http://blenderartists.org/forum/showthread.php?245954-preethams-sky-impementation-HDR\n *\n * Three.js integration by zz85 http://twitter.com/blurspline\n*/\nimport {\n  ShaderMaterial,\n  SphereBufferGeometry,\n  Mesh,\n  Vector3,\n  UniformsUtils,\n  BackSide\n} from 'three'\n\nconst Sky = function () {\n  var shader = Sky.SkyShader\n\n  var material = new ShaderMaterial({\n    fragmentShader: shader.fragmentShader,\n    vertexShader: shader.vertexShader,\n    uniforms: UniformsUtils.clone(shader.uniforms),\n    side: BackSide\n  })\n\n  Mesh.call(this, new SphereBufferGeometry(1, 32, 15), material)\n}\n\nSky.prototype = Object.create(Mesh.prototype)\n\nSky.SkyShader = {\n\n  uniforms: {\n    luminance: { value: 1 },\n    turbidity: { value: 2 },\n    rayleigh: { value: 1 },\n    mieCoefficient: { value: 0.005 },\n    mieDirectionalG: { value: 0.8 },\n    sunPosition: { value: new Vector3() }\n  },\n\n  vertexShader: `\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.z / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n        // extinction (absorbtion + out scattering)\n        // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n        // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }\n    `,\n\n  fragmentShader: `\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float luminance;\n        uniform float mieDirectionalG;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at\n                                    // 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        // Filmic ToneMapping http://filmicgames.com/archives/75\n        const float A = 0.15;\n        const float B = 0.50;\n        const float C = 0.10;\n        const float D = 0.20;\n        const float E = 0.02;\n        const float F = 0.30;\n\n        const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\n        vec3 Uncharted2Tonemap( vec3 x ) {\n        return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n        }\n\n\n        void main() {\n        // optical length\n        // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n        // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n        // in scattering\n        float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n        // nightsky\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n        // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n        vec3 color = curr * whiteScale;\n\n        vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n        }`\n\n}\n\nexport {Sky}\n","import {\n  DirectionalLight,\n  HemisphereLight,\n  AmbientLight\n} from 'three'\nimport {drone} from './index'\n\nconst dirLight = new DirectionalLight(0xffffff, 4)\nwindow.dirLight = dirLight\nconst hemishpereLight = new HemisphereLight(0xffffbb, 0x080820, 0.1)\nhemishpereLight.position.set(0, 0, 1)\nhemishpereLight.up.set(0, 0, 1)\nhemishpereLight.needsUpdate = true\nconst ambientLight = new AmbientLight(0x404040, 0.1) // soft white light\n\nconst updateDirLightPosition = () => {\n  dirLight.position.copy(dirLight.sunPosition)\n  dirLight.position.normalize()\n  dirLight.position.multiplyScalar(1600.0)\n  dirLight.position.add(drone.position)\n}\n\nconst initLights = (scene, sunPosition) => {\n  dirLight.sunPosition = sunPosition\n  dirLight.updatePosition = updateDirLightPosition\n  dirLight.updatePosition()\n  dirLight.up.set(0, 0, 1)\n  dirLight.name = 'sunlight'\n\n  dirLight.castShadow = true\n  dirLight.shadow.mapSize.width = dirLight.shadow.mapSize.height = 1024\n  const d = 1024\n  dirLight.shadow.camera.left = -d\n  dirLight.shadow.camera.right = d\n  dirLight.shadow.camera.top = d\n  dirLight.shadow.camera.bottom = -d\n\n  dirLight.shadow.camera.far = 3200\n  dirLight.shadow.bias = -0.0001\n  dirLight.needsUpdate = true\n\n  scene.add(dirLight)\n  scene.add(hemishpereLight)\n  scene.add(ambientLight)\n}\n\nexport {initLights, dirLight, hemishpereLight, ambientLight}\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  RepeatWrapping,\n  UniformsLib,\n  Vector2,\n  Matrix3\n} from 'three'\nimport vertexShader from './meshphysical_vert.glsl'\nimport fragmentShader from './meshphysical_frag.glsl'\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n\nconst rockTexture = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1.jpg'))\nconst rockTextureNormal = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1_normal.jpg'))\n// const rockTexture = textureLoader.load(require('../textures/rock_brown_1600.jpg'))\nconst grassTexture = textureLoader.load(require('../textures/GrassGreenTexture0003.jpg'))\nconst grassTextureNormal = textureLoader.load(require('../textures/GrassGreenTexture0003_normal.jpg'))\n// const grassTexture = textureLoader.load(require('../textures/rainforest512.jpg'))\n// const grassTexture2 = textureLoader.load(require('../textures/Grass_01_UV_H_CM_1.jpg'))\n// const icyTexture = textureLoader.load(require('../textures/snow_scuffed_ground_1.jpg'))\n// const snowTexture = textureLoader.load(require('../textures/Snow_01_UV_H_CM_1.jpg'))\n// const envmapTexture = textureLoader.load(require('../textures/envmap.jpg'))\nrockTexture.wrapS = rockTexture.wrapT = RepeatWrapping\nrockTexture.offset.set(0, 0)\nrockTexture.repeat.set(20, 20)\nrockTextureNormal.wrapS = rockTextureNormal.wrapT = RepeatWrapping\ngrassTexture.wrapS = grassTexture.wrapT = RepeatWrapping\ngrassTextureNormal.wrapS = grassTextureNormal.wrapT = RepeatWrapping\n// grassTexture2.wrapS = grassTexture2.wrapT = RepeatWrapping\n// icyTexture.wrapS = icyTexture.wrapT = RepeatWrapping\n// snowTexture.wrapS = snowTexture.wrapT = RepeatWrapping\n\nconst Material = (options, uniforms) => {\n  const material = new ShaderMaterial({\n    uniforms: {\n      opacity: {value: 1.0},\n      clearCoat: {value: 0.0},\n      clearCoatRoughness: {value: 0.0},\n      roughness: {value: 0.0},\n      metalness: {value: 0.0},\n      ...UniformsLib.common,\n      ...UniformsLib.lights,\n      ...UniformsLib.specularMap,\n      ...UniformsLib.envmap,\n      ...UniformsLib.aomap,\n      ...UniformsLib.lightmap,\n      ...UniformsLib.emissivemap,\n      ...UniformsLib.bumpmap,\n      ...UniformsLib.normalmap,\n      ...UniformsLib.displacementmap,\n      ...UniformsLib.roughnessmap,\n      ...UniformsLib.metalnessmap,\n      ...UniformsLib.gradientmap,\n      ...UniformsLib.fog,\n      ...UniformsLib.points,\n      // spectral: {value: spectralTexture},\n      rockTexture: {value: rockTexture},\n      rockTextureNormal: {value: rockTextureNormal},\n      // grassTexture: {value: grassTexture},\n      // grassTextureNormal: {value: grassTextureNormal},\n      // icyTexture: {value: icyTexture},\n      // snowTexture: {value: snowTexture},\n      // sunPosition: {value: sunPosition},\n      ...uniforms\n    },\n    defines: {\n      PHYSICAL: '',\n      USE_MAP: '',\n      USE_NORMALMAP: '',\n      USE_ENVMAP: '',\n      ENVMAP_TYPE_CUBE: '',\n      ENVMAP_BLENDING_MULTIPLY: '',\n      TONE_MAPPING: ''\n    },\n    vertexShader,\n    fragmentShader,\n    extensions: {\n      derivatives: true\n    },\n    wireframe: false,\n    lights: true,\n    fog: true\n    // transparent: true,\n    // ...options,\n  })\n  material.uniforms.map.value = grassTexture\n  material.uniforms.normalMap.value = grassTextureNormal\n  // material.uniforms.envMap.value = envmapTexture\n  material.uniforms.toneMappingExposure = {value: 3}\n  material.uniforms.toneMappingWhitePoint = {value: 5}\n  // material.uniforms.normalScale = {value: 5}\n  material.opacity = 1.0\n  material.roughness = 1\n  material.metalness = 0\n  material.lightMapIntensity = 1.0\n  material.aoMapIntensity = 1.0\n  material.emissiveIntensity = 1.0\n  material.envMapIntensity = 1\n  material.refractionRatio = 0.98\n  material.bumpscale = 1.0\n  material.normalScale = new Vector2(5, 5)\n  material.uniforms.reflectivity.value = 0.5\n  material.clearCoatRoughness = 0.0\n\n  // needed for WebGLProgram to unroll loops\n  // cf. https://github.com/mrdoob/three.js/pull/12323\n  material.isShaderMaterial = false\n  material.isMeshStandardMaterial = true\n  material.isMeshPhysicalMaterial = true\n  // repeat the texture 20 times\n  material.uniforms.uvTransform.value = new Matrix3().multiplyScalar(20)\n\n  material.needsUpdate = true\n  return material\n}\n\nexport {Material}\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  RepeatWrapping,\n  UniformsLib,\n  Matrix3\n} from 'three'\nimport vertexShader from './terrain_tile_vert.glsl'\nimport fragmentShader from './terrain_tile_frag.glsl'\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n\nconst rockTexture = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1.jpg'))\nconst rockTextureNormal = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1_normal.jpg'))\n// const rockTexture = textureLoader.load(require('../textures/rock_brown_1600.jpg'))\nconst grassTexture = textureLoader.load(require('../textures/GrassGreenTexture0003.jpg'))\nconst grassTextureNormal = textureLoader.load(require('../textures/GrassGreenTexture0003_normal.jpg'))\n// const grassTexture = textureLoader.load(require('../textures/rainforest512.jpg'))\n// const grassTexture2 = textureLoader.load(require('../textures/Grass_01_UV_H_CM_1.jpg'))\n// const icyTexture = textureLoader.load(require('../textures/snow_scuffed_ground_1.jpg'))\n// const snowTexture = textureLoader.load(require('../textures/Snow_01_UV_H_CM_1.jpg'))\n// const envmapTexture = textureLoader.load(require('../textures/envmap.jpg'))\nrockTexture.wrapS = rockTexture.wrapT = RepeatWrapping\nrockTexture.offset.set(0, 0)\nrockTexture.repeat.set(20, 20)\nrockTextureNormal.wrapS = rockTextureNormal.wrapT = RepeatWrapping\ngrassTexture.wrapS = grassTexture.wrapT = RepeatWrapping\ngrassTextureNormal.wrapS = grassTextureNormal.wrapT = RepeatWrapping\n// grassTexture.offset.set(0, 0);\n// grassTexture.repeat.set( 20, 20 );\n// grassTexture2.wrapS = grassTexture2.wrapT = RepeatWrapping\n// icyTexture.wrapS = icyTexture.wrapT = RepeatWrapping\n// snowTexture.wrapS = snowTexture.wrapT = RepeatWrapping\n\nconst MaterialBasic = (options, uniforms) => {\n  const material = new ShaderMaterial({\n    uniforms: {\n      // opacity: {value: 1.0},\n      // clearCoat: {value: 0.0},\n      // clearCoatRoughness: {value: 0.0},\n      roughness: {value: 0.7},\n      metalness: {value: 0.0},\n      ...UniformsLib.common,\n      ...UniformsLib.lights,\n      // ...UniformsLib.specularMap,\n      ...UniformsLib.envmap,\n      // ...UniformsLib.aomap,\n      // ...UniformsLib.lightmap,\n      // ...UniformsLib.emissivemap,\n      // ...UniformsLib.bumpmap,\n      ...UniformsLib.normalmap,\n      // ...UniformsLib.displacementmap,\n      // ...UniformsLib.roughnessmap,\n      // ...UniformsLib.metalnessmap,\n      // ...UniformsLib.gradientmap,\n      ...UniformsLib.fog,\n      // ...UniformsLib.points,\n      // spectral: {value: spectralTexture},\n      rockTexture: {value: rockTexture},\n      rockTextureNormal: {value: rockTextureNormal},\n      // grassTexture: {value: grassTexture},\n      // grassTextureNormal: {value: grassTextureNormal},\n      // icyTexture: {value: icyTexture},\n      // snowTexture: {value: snowTexture},\n      // sunPosition: {value: sunPosition},\n      ...uniforms\n    },\n    defines: {\n      STANDARD: '',\n      USE_MAP: '',\n      // USE_ENVMAP: '',\n      USE_NORMALMAP: ''\n      // TONE_MAPPING: ''\n      // FLAT_SHADED: '',\n    },\n    vertexShader,\n    fragmentShader,\n    extensions: {\n      derivatives: true\n    },\n    wireframe: false,\n    lights: true,\n    fog: true\n    // transparent: true,\n    // ...options,\n  })\n  material.uniforms.map.value = grassTexture\n  material.uniforms.normalMap.value = grassTextureNormal\n  // material.uniforms.envMap.value = envmapTexture\n  // material.uniforms.toneMappingExposure = {value: 3}\n  // material.uniforms.toneMappingWhitePoint = {value: 5}\n  // material.uniforms.normalScale = {value: 5}\n  // material.opacity = 1.0\n  material.roughness = 0.7\n  material.metalness = 0\n  // material.lightMapIntensity = 1.0\n  // material.aoMapIntensity = 1.0\n  // material.emissiveIntensity = 1.0\n  // material.envMapIntensity = 1\n  // material.refractionRatio = 0.98\n  // material.bumpscale = 1.0\n  // material.normalScale = new Vector2(5, 5)\n  // material.uniforms.reflectivity.value = 0.5\n  // material.clearCoatRoughness = 0.0\n\n  // needed for WebGLProgram to unroll loops\n  // cf. https://github.com/mrdoob/three.js/pull/12323\n  material.isShaderMaterial = false\n  material.isMeshStandardMaterial = true\n  // material.isMeshPhysicalMaterial = true\n  // repeat the texture 20 times\n  material.uniforms.uvTransform.value = new Matrix3().multiplyScalar(20)\n\n  material.needsUpdate = true\n  return material\n}\n\nexport {MaterialBasic}\n","import {\n  Mesh,\n  BufferAttribute,\n  BufferGeometry\n} from 'three'\nimport {renderer, scene, options} from '../index'\n// import SimplifyModifier from '../modules/meshSimplify'\nimport Worker from './terrain.worker.js'\nimport {Material} from '../materials/terrainPhysical'\nimport {MaterialBasic} from '../materials/terrainTile'\n\n// const textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n// const spectralTexture = textureLoader.load(\n//   'https://raw.githubusercontent.com/d3/d3-scale-chromatic/master/img/Spectral.png'\n// )\n\nconst materialBasic = MaterialBasic()\n\n// cf. http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#ECMAScript_.28JavaScript.2FActionScript.2C_etc..29\nconst long2tile = (lon, zoom) => {\n  return (lon + 180) / 360 * Math.pow(2, zoom)\n}\nconst lat2tile = (lat, zoom) => {\n  return (\n    (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom)\n  )\n}\nconst offset = {y: 45.8671, x: 7.3087}\nconst chamonix = {x: long2tile(offset.x, 10), y: lat2tile(offset.y, 10)}\nconst offsetAtZ = (z) => {\n  return {\n    x: chamonix.x / Math.pow(2, 10 - z),\n    y: chamonix.y / Math.pow(2, 10 - z)\n  }\n}\nwindow.chamonix = chamonix\nconst setTilePosition = (geometry, key) => {\n  const zxyijs = key.split(',').map(x => parseInt(x, 10))\n  const z = zxyijs[0]\n  const x = zxyijs[1]\n  const y = zxyijs[2]\n  const size = zxyijs[5]\n  const offset = offsetAtZ(z)\n  geometry.position.set(\n    x * size - (offset.x % 1 - 0.5) * size - (1 - chamonix.x % 1) * 800,\n    -y * size + (offset.y % 1 - 0.5) * size + (1 - chamonix.y % 1) * 800,\n    0\n  )\n}\n\n// PBR\nconst material = Material({}, {})\n\nconst buildTileFromWorker = event => {\n  const geometry = new BufferGeometry()\n  const positions = new Float32Array(event.data.positions)\n  const normals = new Float32Array(event.data.normals)\n  const IndexArrayClass = {\n    2: Uint16Array,\n    4: Uint32Array\n  }[event.data.bpe.indices]\n  const index = new IndexArrayClass(event.data.indices)\n  // const dem = new Uint8Array(event.data.dem)\n  let uv = new Float32Array(positions.length / 3 * 2)\n  const n = Math.sqrt(positions.length / 3)\n  uv = uv.map((_, index) => index % 2 ? Math.floor((index / 2) / n) / n : (index / 2) % n / n)\n  geometry.addAttribute('position', new BufferAttribute(positions, 3))\n  geometry.addAttribute('normal', new BufferAttribute(normals, 3))\n  geometry.addAttribute('uv', new BufferAttribute(uv, 2))\n  geometry.setIndex(new BufferAttribute(index, 1))\n  geometry.computeBoundingSphere()\n  geometry.computeBoundingBox()\n\n  const terrainMaterial = options.PBR ? material : materialBasic\n  const plane = new Mesh(geometry, terrainMaterial)\n\n  plane.key = event.data.key\n  plane.name = 'terrainTile'\n  plane.castShadow = true\n  plane.receiveShadow = true\n  setTilePosition(plane, event.data.key)\n  scene.add(plane)\n  renderer.shadowMap.needsUpdate = true\n}\n\nlet workerPool = []\nconst workerPoolSize = navigator.hardwareConcurrency - 1 || 3\nfor (let i = 0; i < workerPoolSize; i++) {\n  const worker = new Worker()\n  worker.onmessage = buildTileFromWorker\n  workerPool.push(worker)\n}\nlet currentWorker = 0\nworkerPool.postMessage = args => {\n  const worker = workerPool[currentWorker]\n  worker.postMessage(args)\n  currentWorker = currentWorker === workerPoolSize - 1 ? 0 : currentWorker + 1\n}\n\nconst buildPlane = (z, x, y, segments, j, size) => {\n  workerPool.postMessage([z, x, y, segments, j, size])\n}\n\nexport {\n  buildPlane,\n  material\n}\n","import {\n  Vector3\n} from 'three'\nimport {camera, scene, drone} from '../index'\nimport {dirLight} from '../lights'\nimport {buildPlane} from '../terrain'\n\nconst tileSize = 800\nconst maxTilesInMemory = 128\nlet lastCameraPosition = new Vector3(0, 0, 0)\nlet tiles = {}\nlet pngs = {}\nlet currentKeysArray = []\nwindow.tiles = tiles\nwindow.pngs = pngs\n\nconst deleteTile = (tile) => {\n  scene.remove(tile)\n  tile.geometry.dispose()\n  tile.geometry = null\n  tile.material.dispose()\n  tile.material = null\n}\n\nlet camVec = new Vector3()\nconst tileBuilder = (timestamp) => {\n  const cameraPosition = camera.position\n  camVec = camera.getWorldDirection(camVec)\n  let targetPosition = cameraPosition.clone()\n\n  targetPosition = targetPosition.add(camVec.multiplyScalar(400 * Math.max(1, Math.abs(cameraPosition.z) / 400)))\n  drone.position.set(targetPosition.x, targetPosition.y, 200)\n  dirLight.updatePosition()\n\n  if (cameraPosition.distanceTo(lastCameraPosition) > 10) {\n    lastCameraPosition = cameraPosition.clone()\n\n    const z0 = 10\n    const zoomDelta = Math.min(7, Math.floor(Math.sqrt(Math.abs(cameraPosition.z)) / 28))\n    // const zoomDelta = 0\n    const zoom = z0 - zoomDelta\n    const currentTileSize = tileSize * Math.pow(2, zoomDelta)\n\n    const x0 = Math.round(targetPosition.x / currentTileSize)\n    const y0 = -Math.round(targetPosition.y / currentTileSize)\n\n    const segments0 = cameraPosition.z > 2000 ? 127 : 255\n    const segments1 = cameraPosition.z > 2000 ? 31 : 63\n    // const segments0 = 32\n    // const segments1 = 15\n    const segments2 = 15\n\n    const cutOffDistance = currentTileSize * 3\n    let distanceVector = new Vector3()\n    let cameraXY = new Vector3()\n    let objectXY = new Vector3()\n    let distance\n\n    let visibleKeysArray = [\n        [zoom, x0, y0, segments0, 0, currentTileSize],\n        [zoom, x0, y0 + 1, segments0, 0, currentTileSize],\n        [zoom, x0 + 1, y0, segments0, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 1, segments0, 0, currentTileSize],\n\n        [zoom, x0 - 1, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 - 0, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 1, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0 + 2, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 - 0, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0, y0 + 2, segments1, 0, currentTileSize],\n        [zoom, x0 + 1, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0 - 2, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 - 1, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 - 0, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 1, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 3, segments2, 0, currentTileSize],\n\n        [zoom, x0 + 3, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 - 1, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 - 0, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 1, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 3, segments2, 0, currentTileSize],\n\n        [zoom, x0 - 1, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0 + 1, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0 + 2, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 3, segments2, 0, currentTileSize]\n\n    ]\n\n    // let camera = terrainTarget.native\n    // // camera.updateMatrix(); // make sure camera's local matrix is updated\n    // // camera.updateMatrixWorld(); // make sure camera's world matrix is updated\n    // // camera.matrixWorldInverse.getInverse( camera.matrixWorld );\n    // var frustum = new THREE.Frustum();\n    // frustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse));\n    // console.log( frustum );\n\n    const visibleKeysString = visibleKeysArray.map(k => k.toString())\n    const currentKeysString = currentKeysArray.map(k => k.toString())\n\n    // compute tile under the camera\n    const potentialUnderKeys = visibleKeysString.slice(0, 4)\n    const potentialUnderTiles = scene.children.filter(child => potentialUnderKeys.includes(child.key))\n    const tileToCamera = (tile) => {\n      return distanceVector.subVectors(tile.position, camera.position).length()\n    }\n    potentialUnderTiles.sort((a, b) =>\n       tileToCamera(a) - tileToCamera(b)\n    )\n    camera.userData.terrainKeysUnder = potentialUnderKeys\n    camera.userData.terrainTileUnder = potentialUnderTiles[0]\n\n    const newKeys = visibleKeysString.filter(x => currentKeysString.indexOf(x) < 0)\n    const existingKeys = scene.children.filter(child => child.key).map(tile => tile.key)\n\n    // build new keys\n    newKeys.forEach(newKey => {\n      if (existingKeys.includes(newKey)) {\n        console.log(newKey, ' already exists!')\n        return\n      }\n      const zxyijs = newKey.split(',').map(x => parseInt(x, 10))\n      buildPlane(...zxyijs)\n    })\n\n    // switch tiles visibility with regard to their distance to the camera\n    scene.children.filter(child => child.key)\n      .forEach(tile => {\n        distance = distanceVector.subVectors(\n          objectXY.set(tile.position.x, tile.position.y, 0),\n          cameraXY.set(camera.position.x, camera.position.y, 0)\n        ).length()\n        tile.userData.distanceToCamera = distance\n        if (distance < cutOffDistance && visibleKeysString.includes(tile.key)) {\n          tile.visible = true\n        } else {\n          window.setTimeout(() => { tile.visible = false }, 750)\n        }\n      })\n\n    // delete some distant tiles\n    scene.children.filter(child => child.key)\n      .sort((a, b) => a.userData.distanceToCamera - b.userData.distanceToCamera)\n      .slice(maxTilesInMemory)\n      .forEach(tile => {\n        if (!tile.markedForDeletion) {\n          window.setTimeout(() => deleteTile(tile), 750)\n          tile.markedForDeletion = true\n        }\n      })\n\n    currentKeysArray = visibleKeysArray.slice(0)\n  }\n}\n\ntileBuilder.clean = () => {\n  scene.children\n    .filter(child => child.name === 'terrainTile')\n    .forEach(tile => deleteTile(tile))\n  currentKeysArray = []\n  lastCameraPosition = new Vector3(0, 0, 0)\n}\n\nexport {tileBuilder}\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  MirroredRepeatWrapping,\n  UniformsLib,\n  Matrix3,\n  Vector2\n} from 'three'\nimport vertexShader from './terrain_voxel_vert.glsl'\nimport fragmentShader from './terrain_voxel_frag.glsl'\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n\nconst rockTexture = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1.jpg'))\nconst rockTextureNormal = textureLoader.load(require('../textures/Rock_08_UV_H_CM_1_normal.jpg'))\n// const rockTexture = textureLoader.load(require('../textures/rock_brown_1600.jpg'))\nconst grassTexture = textureLoader.load(require('../textures/GrassGreenTexture0003.jpg'))\nconst grassTextureNormal = textureLoader.load(require('../textures/GrassGreenTexture0003_normal.jpg'))\n// const grassTexture = textureLoader.load(require('../textures/rainforest512.jpg'))\n// const grassTexture2 = textureLoader.load(require('../textures/Grass_01_UV_H_CM_1.jpg'))\n// const icyTexture = textureLoader.load(require('../textures/snow_scuffed_ground_1.jpg'))\n// const snowTexture = textureLoader.load(require('../textures/Snow_01_UV_H_CM_1.jpg'))\n// const envmapTexture = textureLoader.load(require('../textures/envmap.jpg'))\nrockTexture.wrapS = rockTexture.wrapT = MirroredRepeatWrapping\nrockTexture.offset.set(0, 0)\nrockTexture.repeat.set(20, 20)\nrockTextureNormal.wrapS = rockTextureNormal.wrapT = MirroredRepeatWrapping\ngrassTexture.wrapS = grassTexture.wrapT = MirroredRepeatWrapping\ngrassTextureNormal.wrapS = grassTextureNormal.wrapT = MirroredRepeatWrapping\n// grassTexture.offset.set(0, 0);\n// grassTexture.repeat.set( 20, 20 );\n// grassTexture2.wrapS = grassTexture2.wrapT = RepeatWrapping\n// icyTexture.wrapS = icyTexture.wrapT = RepeatWrapping\n// snowTexture.wrapS = snowTexture.wrapT = RepeatWrapping\n\nconst MaterialBasic = (options, uniforms) => {\n  const material = new ShaderMaterial({\n    uniforms: {\n      // opacity: {value: 1.0},\n      // clearCoat: {value: 0.0},\n      // clearCoatRoughness: {value: 0.0},\n      roughness: {value: 0.7},\n      metalness: {value: 0.0},\n      ...UniformsLib.common,\n      ...UniformsLib.lights,\n      // ...UniformsLib.specularMap,\n      ...UniformsLib.envmap,\n      // ...UniformsLib.aomap,\n      // ...UniformsLib.lightmap,\n      // ...UniformsLib.emissivemap,\n      // ...UniformsLib.bumpmap,\n      ...UniformsLib.normalmap,\n      // ...UniformsLib.displacementmap,\n      // ...UniformsLib.roughnessmap,\n      // ...UniformsLib.metalnessmap,\n      // ...UniformsLib.gradientmap,\n      ...UniformsLib.fog,\n      // ...UniformsLib.points,\n      // spectral: {value: spectralTexture},\n      rockTexture: {value: rockTexture},\n      rockTextureNormal: {value: rockTextureNormal},\n      // grassTexture: {value: grassTexture},\n      // grassTextureNormal: {value: grassTextureNormal},\n      // icyTexture: {value: icyTexture},\n      // snowTexture: {value: snowTexture},\n      // sunPosition: {value: sunPosition},\n      ...uniforms\n    },\n    defines: {\n      STANDARD: '',\n      USE_MAP: '',\n      // USE_ENVMAP: '',\n      USE_NORMALMAP: ''\n      // TONE_MAPPING: ''\n      // FLAT_SHADED: '',\n    },\n    vertexShader,\n    fragmentShader,\n    extensions: {\n      derivatives: true\n    },\n    wireframe: false,\n    lights: true,\n    fog: true\n    // transparent: true,\n    // ...options,\n  })\n  material.uniforms.map.value = grassTexture\n  material.uniforms.normalMap.value = grassTextureNormal\n  // material.uniforms.envMap.value = envmapTexture\n  // material.uniforms.toneMappingExposure = {value: 3}\n  // material.uniforms.toneMappingWhitePoint = {value: 5}\n  // material.uniforms.normalScale = {value: 5}\n  // material.opacity = 1.0\n  material.roughness = 0.7\n  material.metalness = 0\n  // material.lightMapIntensity = 1.0\n  // material.aoMapIntensity = 1.0\n  // material.emissiveIntensity = 1.0\n  // material.envMapIntensity = 1\n  // material.refractionRatio = 0.98\n  // material.bumpscale = 1.0\n  material.normalScale = new Vector2(1, 1)\n  // material.uniforms.reflectivity.value = 0.5\n  // material.clearCoatRoughness = 0.0\n\n  // needed for WebGLProgram to unroll loops\n  // cf. https://github.com/mrdoob/three.js/pull/12323\n  material.isShaderMaterial = false\n  material.isMeshStandardMaterial = true\n  // material.isMeshPhysicalMaterial = true\n  // repeat the texture 20 times\n  material.uniforms.uvTransform.value = new Matrix3().multiplyScalar(20)\n\n  material.needsUpdate = true\n  return material\n}\n\nexport {MaterialBasic}\n","const voxelSize = 500\nconst voxelLayers = 2\nconst voxelNumber = 3\nconst voxelOffset = {\n  x: 0, y: 0, z: -175\n  }\n\nexport {\n  voxelSize,\n  voxelLayers,\n  voxelNumber,\n  voxelOffset\n}\n","import * as THREE from 'three'\nimport PubSub from '../events'\nimport {scene} from '../index'\nimport {MaterialBasic} from '../materials/terrainVoxel'\nimport {voxelSize, voxelLayers, voxelOffset} from './constants'\n\nimport Worker from './voxel.worker.js'\n\nconst materialBasic = MaterialBasic()\nconst emptyKeys = new Set()\nwindow.emptyKeys = emptyKeys\n\nconst buildVoxelsFromWorker = (event) => {\n  const key = [event.data.i, event.data.j, event.data.k]\n  if (!event.data.hasGeometry) {\n    emptyKeys.add(key.toString())\n    return\n  }\n\n  const positions = new Float32Array(event.data.pos1)\n  const normals = new Float32Array(event.data.normals1)\n  const indices = new Uint16Array(event.data.index1)\n\n  const geometry = new THREE.BufferGeometry()\n  geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3))\n  geometry.addAttribute('normal', new THREE.BufferAttribute(normals, 3))\n  geometry.setIndex(new THREE.BufferAttribute(indices, 1))\n  const mesh = new THREE.Mesh(geometry, materialBasic)\n  // const mesh = new THREE.Mesh(geometry, new THREE.MeshNormalMaterial({wireframe: true}))\n\n  mesh.position.set(\n    voxelSize * event.data.i + voxelOffset.x,\n    voxelSize * event.data.j + voxelOffset.y,\n    voxelSize * event.data.k + voxelOffset.z\n  )\n  mesh.userData.key = key\n  let box = new THREE.BoxHelper(mesh, 0xffff00)\n  mesh.name = 'terrainVoxel'\n  box.name = 'terrainVoxelHelper'\n  scene.add(box)\n  scene.add(mesh)\n}\n\nlet workerPool = []\nconst workerPoolSize = navigator.hardwareConcurrency - 1 || 3\nfor (let i = 0; i < workerPoolSize; i++) {\n  const worker = new Worker()\n  worker.onmessage = buildVoxelsFromWorker\n  workerPool.push(worker)\n}\nlet currentWorker = 0\nworkerPool.postMessage = args => {\n  const worker = workerPool[currentWorker]\n  worker.postMessage(args)\n  currentWorker = currentWorker === workerPoolSize - 1 ? 0 : currentWorker + 1\n}\n\nconst buildVoxels = (i, j, k) => {\n  workerPool.postMessage([i, j, k, voxelLayers])\n}\n\nexport {buildVoxels, emptyKeys, voxelSize}\n","import {\n  Vector3,\n  Matrix4,\n  Frustum,\n  Box3\n} from 'three'\nimport {camera, scene, drone} from '../index'\nimport {buildVoxels, emptyKeys} from '../voxel'\nimport {voxelSize, voxelLayers, voxelNumber} from '../voxel/constants'\n\nlet lastCameraPosition = new Vector3(0, 0, 0)\nlet currentKeys = []\nwindow.currentKeys = currentKeys\nlet keyString\n\nconst voxelBuilder = (timestamp) => {\n  const cameraPosition = camera.position\n\n  if (cameraPosition.distanceTo(lastCameraPosition) > 10) {\n    lastCameraPosition = cameraPosition.clone()\n    let i0 = Math.floor(cameraPosition.x / voxelSize + 0.5)\n    let j0 = Math.floor(cameraPosition.y / voxelSize + 0.5)\n    console.log('camera centered on tile ', i0, j0)\n    let visibleKeys = []\n    let size = voxelNumber\n    var frustum = new Frustum()\n    frustum.setFromMatrix(new Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse))\n    for (let i = 0; i < size; i++) {\n      for (let j = 0; j < size; j++) {\n        for (let k = 0; k < voxelLayers; k++) {\n          // let min = new Vector3(i - 2 + i0, j - 2 + j0, k).multiplyScalar(100)\n          // let box = new Box3(min, min.clone().add(new Vector3(100, 100, 100)))\n          // console.log(box)\n          // if (frustum.intersectsBox(box)) {\n          visibleKeys.push([i - Math.floor((size - 1) / 2) + i0, j - Math.floor((size - 1) / 2) + j0, k])\n          // }\n        }\n      }\n    }\n\n    visibleKeys.forEach(key => {\n      keyString = key.toString()\n      if (!emptyKeys.has(keyString) && !currentKeys.includes(keyString)) {\n        currentKeys.push(keyString)\n        console.log('build', key)\n        buildVoxels(...key)\n      }\n    })\n\n    let sub = new Vector3()\n    let cameraXY = new Vector3()\n    let objectXY = new Vector3()\n    let distance\n    scene.children.filter(child => child.userData.key).forEach(voxelBlock => {\n      distance = sub.subVectors(\n        cameraXY.set(camera.position.x, camera.position.y, 0),\n        objectXY.set(voxelBlock.position.x, voxelBlock.position.y, 0)\n      ).length()\n      let cutOffDistance = voxelSize * Math.ceil(voxelNumber / 2) * 1.1\n      voxelBlock.visible = distance < cutOffDistance\n    })\n  }\n}\n\nconst deleteTile = (tile) => {\n  scene.remove(tile)\n  tile.geometry.dispose()\n  tile.geometry = null\n  tile.material.dispose()\n  tile.material = null\n}\n\nvoxelBuilder.clean = () => {\n  scene.children\n    .filter(child => ['terrainVoxel', 'terrainVoxelHelper'].includes(child.name))\n    .forEach(tile => deleteTile(tile))\n  currentKeys = []\n  lastCameraPosition = new Vector3(0, 0, 0)\n}\n\nexport {voxelBuilder}\n","import {tileBuilder} from './tileBuilder'\nimport {voxelBuilder} from './voxelsLoop'\nimport PubSub from '../events'\nimport keyboardJS from 'keyboardjs'\n\nconst terrainLoops = [\n    tileBuilder,\n    voxelBuilder\n]\n\nlet activeTerrainIndex = 0\n\nconst terrainLoop = (timestamp) => terrainLoops[activeTerrainIndex](timestamp)\n\nkeyboardJS.bind('t', e => {\n    console.log('switch terrain')\n    terrainLoops[activeTerrainIndex].clean()\n    activeTerrainIndex = activeTerrainIndex === terrainLoops.length - 1 ? 0 : activeTerrainIndex + 1\n    console.log('switch terrain done')\n})\n\nexport {terrainLoop}\n","import {\n  TextureLoader\n} from 'three'\nimport {\n    Lensflare,\n    LensflareElement\n} from '../modules'\n\nconst textureLoader = new TextureLoader()\nconst textureFlare3 = textureLoader.load(require('../textures/lensflare/lensflare3.png'))\n\nconst lensFlare = new Lensflare()\n\nlensFlare.addElement(new LensflareElement(textureFlare3, 60, 0.6))\nlensFlare.addElement(new LensflareElement(textureFlare3, 70, 0.7))\nlensFlare.addElement(new LensflareElement(textureFlare3, 120, 0.9))\nlensFlare.addElement(new LensflareElement(textureFlare3, 70, 1.0))\n\nexport default lensFlare\n","import {\n\tVector3,\n\tMatrix4\n} from 'three'\n\nconst motionBlurVertexShader = `\n\tvarying vec2 vUv;\n\n\tvoid main() {\n\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\tvUv = uv;\n\n\t}`\n\nconst motionBlurFragmentShader = `\n\tvarying vec2 vUv;\n\n\tuniform sampler2D tDepth;\n\tuniform sampler2D tColor;\n\n\tuniform mat4 clipToWorldMatrix;\n\tuniform mat4 previousWorldToClipMatrix;\n\n\tuniform vec3 cameraMove;\n\n\tuniform float velocityFactor;\n\tuniform float delta;\n\n\tvoid main() {\n\n\t\tfloat zOverW = texture2D(tDepth, vUv).x;\n\n\t\t// clipPosition is the viewport position at this pixel in the range -1 to 1.\n\t\tvec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n\t\tvec4 worldPosition = clipToWorldMatrix * clipPosition;\n\t\tworldPosition /= worldPosition.w;\n\n\t\tvec4 previousClipPosition = worldPosition;\n\n\t\t// Reduce motion blur due to camera translation especially at the screen center.\n\t\tpreviousClipPosition.xyz -= cameraMove * (\n\t\t\t1. - smoothstep(.3, 1., clamp(length(clipPosition.xy), 0., 1.))\n\t\t);\n\n\t\tpreviousClipPosition = previousWorldToClipMatrix * previousClipPosition;\n\t\tpreviousClipPosition /= previousClipPosition.w;\n\n\t\tvec2 velocity = velocityFactor * (clipPosition - previousClipPosition).xy / delta * 16.67;\n\n\t\tvec4 finalColor = vec4(0.);\n\t\tvec2 offset = vec2(0.);\n\t\tfloat weight = 0.;\n\t\tconst int samples = 20;\n\t\tfor(int i = 0; i < samples; i++) {\n    \t\t\toffset = velocity * (float(i) / (float(samples) - 1.) - .5);\n    \t\t\tvec4 c = texture2D(tColor, vUv + offset);\n\t\t\tfinalColor += c;\n\t\t}\n\t\tfinalColor /= float(samples);\n\t\tgl_FragColor = vec4(finalColor.rgb, 1.);\n\n\t\t// debug: view velocity values\n\t\t// gl_FragColor = vec4(abs(velocity), 0., 1.);\n\n\t\t// debug: view depth buffer\n\t\t// gl_FragColor = vec4(vec3(zOverW), 1.);\n\t}`\n\nexport const motionBlurShader = {\n\n  uniforms: {\n    tDepth: { type: 't', value: null },\n    tColor: { type: 't', value: null },\n\n    velocityFactor: { type: 'f', value: 1 },\n    delta: { type: 'f', value: 16.67 },\n\n    clipToWorldMatrix: { type: 'm4', value: new Matrix4() },\n    previousWorldToClipMatrix: { type: 'm4', value: new Matrix4() },\n\n    cameraMove: { type: 'v3', value: new Vector3() }\n  },\n\n  vertexShader: motionBlurVertexShader,\n  fragmentShader: motionBlurFragmentShader\n}\n","import {\n  Matrix4,\n  Vector3\n} from 'three'\n\nconst CloudsShader = {\n  uniforms: {\n    tDepth: { type: 't', value: null },\n    tColor: { type: 't', value: null },\n\n    cameraNear: { type: 'f', value: 1 },\n    cameraFar: { type: 'f', value: 1e6 },\n\n    clipToWorldMatrix: { type: 'm4', value: new Matrix4() },\n    cameraPosition: { type: 'v3', value: new Vector3() },\n    sun: { type: 'v3', value: new Vector3() }\n\n  },\n\n  vertexShader: `\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  `,\n  fragmentShader: `\n  varying vec2 vUv;\n\n  uniform sampler2D tDepth;\n  uniform sampler2D tColor;\n\n  uniform mat4 clipToWorldMatrix;\n  uniform vec3 sun;\n\n  uniform float cameraNear;\n  uniform float cameraFar;\n\n  mat3 m = mat3( 0.00,  0.80,  0.60,\n              -0.80,  0.36, -0.48,\n              -0.60, -0.48,  0.64 );\nfloat hash( float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\nfloat noise( in vec3 x )\n{\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n\n    f = f*f*(3.0-2.0*f);\n\n    float n = p.x + p.y*57.0 + 113.0*p.z;\n\n    float res = mix(mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n                        mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y),\n                    mix(mix( hash(n+113.0), hash(n+114.0),f.x),\n                        mix( hash(n+170.0), hash(n+171.0),f.x),f.y),f.z);\n    return res;\n}\n\nfloat fbm( vec3 p )\n{\n    float f;\n    f  = 0.5000*noise( p ); p = m*p*2.02;\n    f += 0.2500*noise( p ); p = m*p*2.03;\n    f += 0.1250*noise( p );\n    return f;\n}\n\nfloat map(vec3 p){\n    return p.z + ((fbm(p*0.03)-0.1) + sin(p.x*0.014 + sin(p.y*.001)*7.)*0.4+0.15 + sin(p.y*0.008)*0.1) / 0.007;\n    return p.z + ((fbm(p*0.03)-0.1) + sin(p.x*0.024 + sin(p.y*.001)*7.)*0.22+0.15 + sin(p.y*0.008)*0.05) / 0.007;\n}\n\nfloat getres (in vec3 ro, in vec3 rd, in float z) {\n  return map(ro + rd * z);\n}\n\nfloat dikomarch(in vec3 ro, in vec3 rd, in vec3 world)\n{\n    float precis = .3;\n    float d = 0.;\n    float z0 = 1.;\n    float z1 = length(world - ro);\n    for (int i = 0; i < 8; i++) {\n      float res0 = getres(ro, rd, z0);\n      float res1 = getres(ro, rd, z1);\n      float mid = (z0+z1)/2.;\n      float resmid = getres(ro, rd, mid);\n      z0 = sign(res0) == sign(resmid) ? mid : z0;\n      z1 = sign(res1) == sign(resmid) ? mid : z1;\n      d = z0;\n      if (z0==z1) break;\n    }\n    float h= .0;\n    for( int i=0; i<8; i++ )\n    {\n      if( abs(h)<precis) break;\n      d += h;\n      vec3 pos = ro+rd*d;\n      h = map(pos);\n    }\n    return d;\n}\n\nvec4 march(in vec3 ro, in vec3 rd, in vec3 bgc, in vec3 world)\n{\n  float d = 0., t = 0.;\n  vec4 rz = vec4( 0.0 );\n  float l = length(ro - world);\n  float td=.0, w;\n\n  for( int i=0; i<250; i++ )\n  {\n    if(rz.a > 0.99 || t>l) break;\n\n    vec3 pos = ro + t*rd;\n    d = map(pos);\n    if (d<0.) {\n      float den = clamp(-d/200., 0., 1.);\n\n      vec4 col = vec4(mix( vec3(.8,.75,.85), vec3(.0), den ), den);\n\n      col.a *= .9;\n      col.rgb *= col.a;\n      rz = rz + col*(1.0 - rz.a);\n    }\n\n    t += max(1., abs(d) * .49);\n  }\n\n  return clamp(rz, 0., 1.);\n}\n\n\n  #include <packing>\n\n  float readDepth(sampler2D depthSampler, vec2 coord) {\n    return texture2D(depthSampler, coord).x;\n    float fragCoordZ = texture2D(depthSampler, coord).x;\n    float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n    return viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\n  }\n\n  void main() {\n\n    float zOverW = readDepth(tDepth, vUv);\n\n    // clipPosition is the viewport position at this pixel in the range -1 to 1.\n    vec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n    vec4 worldPosition = clipToWorldMatrix * clipPosition;\n    worldPosition /= worldPosition.w;\n\n    vec3 color = texture2D(tColor, vUv).rgb;\n    vec3 dir = normalize(worldPosition.xyz - cameraPosition);\n\n    // float rz = dikomarch(cameraPosition, dir, worldPosition.xyz);\n    // float rz = march(cameraPosition, dir, worldPosition.xyz);\n    // color = vec3(rz/700.);\n    // if (rz < 7000.)\n    // {\n      vec4 res = march(cameraPosition, dir, color, worldPosition.xyz);\n      color = color*(1.0-res.w) + res.xyz;\n    // }\n    // color = dir;\n\n    // color.w = 1.;\n    // debug: view depth buffer\n    // gl_FragColor = texture2D(tColor, vUv);\n    // gl_FragColor = vec4(clipPosition.xyz, 1.);\n    // gl_FragColor = vec4(normalize(cameraPosition), 1.);\n    // gl_FragColor = vec4(vec3(map(worldPosition.xyz)), 1.);\n    // gl_FragColor = vec4(vec3(zOverW), 1.);\n    // gl_FragColor = vec4((worldPosition.xyz - cameraPosition)/100., 1.);\n    // gl_FragColor = vec4(vec3(fbm(cameraPosition + dir)), 1.);\n    \n    // gl_FragColor = vec4(vec3(rz)/700., 1.);\n    // gl_FragColor = vec4(vec3(length(worldPosition.xyz - cameraPosition))/1500., 1.);\n    // gl_FragColor = res;\n    // gl_FragColor = vec4(col, 1.);\n    gl_FragColor = vec4(color, 1.);\n    // gl_FragColor = mix(texture2D(tColor, vUv), vec4(color, 1.), clamp(rz/zOverW, 0., 1.));\n    \n    // gl_FragColor = texture2D(tColor, vUv) + color;\n    // gl_FragColor = mix(texture2D(tColor, vUv), vec4(.9), 1. - color.x);\n  }\n  `\n}\n\nexport default CloudsShader\n","import {camera} from '../index'\n\nfunction screenXY (vec3, centered=false) {\n  const vector = vec3.clone()\n\n  const widthHalf = (window.innerWidth / 2)\n  const heightHalf = (window.innerHeight / 2)\n\n  vector.project(camera)\n\n  vector.x = (vector.x * widthHalf)\n  vector.y = -(vector.y * heightHalf)\n\n  if (!centered) {\n    vector.x += widthHalf\n    vector.y += heightHalf\n  }\n\n  return vector\n}\n\nconst screenXYclamped = (vec3) => {\n  const screenPosition = screenXY(vec3)\n  return {\n    x: Math.min(Math.max(10, screenPosition.x), window.innerWidth - 10),\n    y: Math.min(Math.max(10, screenPosition.y), window.innerHeight - 10),\n    z: screenPosition.z\n  }\n}\n\nconst clamp = (min, value, max) => Math.min(Math.max(min, value), max)\n\nexport {screenXY, screenXYclamped, clamp}\n","import {Vector2, Vector3} from 'three'\nimport React, {Component} from 'react'\nimport ReactDOM from 'react-dom'\nimport clone from 'clone'\nimport {screenXYclamped} from '../utils'\nimport PubSub from '../events'\nimport {scene, camera} from '../index'\nimport Crosshair from './crosshair'\n\nlet pilotDrone\nlet screenCenter = new Vector2(window.innerWidth / 2, window.innerHeight / 2)\nPubSub.subscribe('x.screen.resized', (msg, rendererSize) => {\n  screenCenter = new Vector2(rendererSize.width / 2, rendererSize.height / 2)\n})\nlet horizonStyle\nlet focalStyle\nconst hudData = {\n  targets: new Set(),\n  targetsInSight: new Set(),\n  targetsInFront: new Set(),\n  gunTarget: null\n}\n\nclass HUD extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {time: 0, gunHeat: 0, lockLevel: 0, pilot: null}\n  }\n\n  componentDidMount () {\n    PubSub.publish('x.hud.mounted')\n  }\n\n  gunHeat () {\n    if (!pilotDrone || !pilotDrone.gunClock.running) {\n      return Math.max(0, this.state.gunHeat - 0.01)\n    }\n    const delta = pilotDrone.gunClock.getDelta()\n    const gunHeat = this.state.gunHeat + delta / 1.5\n    if (gunHeat >= 1) {\n      PubSub.publish('x.drones.gun.stop', pilotDrone)\n      PubSub.publish('x.camera.shake.stop')\n      pilotDrone.gunClock.stop()\n    }\n    return Math.min(gunHeat, 1)\n  }\n\n  lockLevel () {\n    if (hudData.targetsInSight.size === 0) {\n      return Math.max(0, this.state.lockLevel - 0.02)\n    }\n    const times = []\n    hudData.targetsInSight.forEach(target => {\n      const delta = target.lockClock.getDelta()\n      times.push(this.state.lockLevel + delta / 2)\n    })\n    return Math.min(Math.max(...times), 1)\n  }\n\n  update (timestamp, newState) {\n    const gunHeat = this.gunHeat()\n    const lockLevel = this.lockLevel()\n    this.setState({\n      ...newState,\n      time: timestamp,\n      gunHeat,\n      lockLevel,\n      lock: lockLevel === 1,\n      pilot: pilotDrone ? pilotDrone.userData : null\n    })\n  }\n\n  render () {\n    const targets = Array.from(hudData.targets)\n    const targetsData = targets.map(target => Object.assign(\n      clone(target.userData),\n      {id: target.id}\n    ))\n    return (\n      <div>\n        <div id='limiter' />\n        <div id='pointer' />\n        <div id='focal' style={this.state.focalStyle} />\n        <div id='horizon' style={this.state.horizonStyle} />\n        { this.state.pilot ? (\n          <div id='messages'>\n            <div>{this.state.pilot.altitude.toFixed(0)} m</div>\n            <div>{this.state.pilot.speed.toFixed(0)} m/s</div>\n          </div>\n          ) : null\n        }\n        <svg className='vector'>\n          <Crosshair size='30' x={screenCenter.x} y={screenCenter.y}\n            fill='transparent'\n            stroke='#0f0'\n            strokeWidth='17'\n            opacity='0.8'\n          />\n          <circle\n            cx={screenCenter.x} cy={screenCenter.y} r={160}\n            stroke='#666' opacity={0.8} strokeWidth='10' fill='transparent'\n            strokeDasharray='140 1000' transform={`rotate(155 ${screenCenter.x} ${screenCenter.y})`}\n            strokeLinecap='round'\n          />\n          {\n            this.state.lockLevel\n            ? (<circle\n              cx={screenCenter.x} cy={screenCenter.y} r={160}\n              stroke='#0f0' opacity={0.8} strokeWidth='10' fill='transparent'\n              strokeDasharray={`${this.state.lockLevel * 140} 1000`}\n              transform={`rotate(155 ${screenCenter.x} ${screenCenter.y})`}\n              strokeLinecap='round'\n            />) : null\n          }\n          <circle\n            cx={screenCenter.x} cy={screenCenter.y} r={160}\n            stroke='#666' opacity={0.8} strokeWidth='10' fill='transparent'\n            strokeDasharray='140 1000'\n            strokeLinecap='round' transform={`rotate(205 ${screenCenter.x} ${screenCenter.y}) translate(${screenCenter.x * 2}, 0) scale(-1, 1)`}\n          />\n          {\n            this.state.gunHeat\n            ? (<circle\n              cx={screenCenter.x} cy={screenCenter.y} r={160}\n              stroke='orange' opacity={0.8} strokeWidth='10' fill='transparent'\n              strokeDasharray={`${this.state.gunHeat * 140} 1000`}\n              strokeLinecap='round' transform={`rotate(205 ${screenCenter.x} ${screenCenter.y}) translate(${screenCenter.x * 2}, 0) scale(-1, 1)`}\n              />)\n            : null\n          }\n          {targets.map(target => (\n            target.gunHud\n            ? (<g key={target.id}>\n              <path\n                d={`M ${target.hudPosition.x} ${target.hudPosition.y}\n                    l ${target.direction.x} ${target.direction.y}`}\n                strokeWidth='1'\n                stroke={target === this.state.gunTarget ? '#0f0' : 'orange'}\n                fill='transparent' />\n              {target === this.state.gunTarget ? (\n                <Crosshair size='30'\n                  x={target.hudPosition.x + target.direction.x}\n                  y={target.hudPosition.y + target.direction.y}\n                  fill='#0f0'\n                  fillOpacity='0.6'\n                  stroke='#0f0'\n                  strokeWidth='17'\n                  strokeOpacity='1'\n                />\n              ) : null}\n            </g>)\n            : null\n          ))}\n        </svg>\n        <div id='targets'>\n          {targetsData.map(target => (\n            <div className='target' key={target.id} id={'target-' + target.id} style={target.hud.element.style}>\n              <div className='life' style={{width: target.life / 100 * 20}} />\n              <div className='arrow' style={target.hud.arrow.style} />\n              <div className='distance'>{target.hud.distance.innerHTML}</div>\n              <div className='name'>drone-{target.id}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n  }\n}\n\nconst registerTarget = (msg, target) => {\n  hudData.targets.add(target)\n  target.userData.hud = {\n    element: {style: {}},\n    arrow: {style: {}},\n    distance: {style: {}}\n  }\n  let hudPosition\n  let targetDistance2D\n  let targetDistance3D\n  let targetVector2D\n  let targetVector3D\n  let targetDirection\n  const ZONE = 400\n  const FOCAL_SIZE = 150\n  const GUN_RANGE = 500\n  const targetLoop = (timestamp, delta) => {\n    if (!hudElement.mounted) return\n    hudPosition = screenXYclamped(target.position)\n    if (hudPosition.z > 1) {\n      hudPosition.x = window.innerWidth - hudPosition.x\n      hudPosition.y = window.innerHeight - 10\n      target.userData.hud.element.style.borderColor = 'red'\n      target.userData.hud.arrow.style.borderBottomColor = 'red'\n    } else {\n      target.userData.hud.element.style.borderColor = 'orange'\n      target.userData.hud.arrow.style.borderBottomColor = 'orange'\n    }\n    target.hudPosition = hudPosition\n    targetVector2D = new Vector2(hudPosition.x, hudPosition.y).sub(screenCenter)\n    target.userData.hudPositionCentered = targetVector2D\n    if (targetVector2D.length() > ZONE) {\n      targetVector2D.normalize().multiplyScalar(ZONE)\n    }\n    target.userData.hud.arrow.style.opacity = 0.8 * (1 - (ZONE - targetVector2D.length()) / 50)\n    targetVector3D = camera.position.clone().sub(target.position)\n    targetDistance3D = targetVector3D.length()\n    target.userData.distance = targetDistance3D\n    target.userData.hud.distance.innerHTML = targetDistance3D.toFixed(0)\n    target.userData.hud.distance.style.color = targetDistance3D < GUN_RANGE ? '#0f0' : 'orange'\n    target.userData.hud.element.style.transform = `\n      translateX(${targetVector2D.x + screenCenter.x}px)\n      translateY(${targetVector2D.y + screenCenter.y}px)\n      scale(${1.1 - Math.min(0.2, targetDistance3D / 2000)})\n    `\n    target.userData.hud.arrow.style.transform = `\n      translateY(2px)\n      rotate(${targetVector2D.angle() / Math.PI * 180 + 90}deg)\n    `\n    targetDistance2D = targetVector2D.length()\n    if (!target.destroyed && target.userData.hud.element.style.borderColor === 'orange' && targetDistance2D < FOCAL_SIZE) {\n      target.userData.hud.arrow.style.borderBottomColor = '#0f0'\n      hudData.targetsInSight.add(target)\n      if (!target.lockClock.running) target.lockClock.start()\n    } else {\n      hudData.targetsInSight.delete(target)\n      target.lockClock.stop()\n    }\n    if (!target.destroyed && targetDistance2D < ZONE - 10) {\n      hudData.targetsInFront.add(target)\n    } else {\n      hudData.targetsInFront.delete(target)\n    }\n    if (hudPosition.z <= 1 && targetDistance2D < ZONE * 0.8) {\n      targetDirection = screenXYclamped(\n        target.position.clone().add(target.velocity.clone().multiplyScalar(\n          Math.min(1,\n            (targetDistance3D + targetVector3D.clone().add(target.velocity).length()) / 2 / GUN_RANGE\n          )\n        ))\n      )\n      target.gunHud = true\n      target.direction = {\n        x: targetDirection.x - (targetVector2D.x + screenCenter.x),\n        y: targetDirection.y - (targetVector2D.y + screenCenter.y)\n      }\n    } else {\n      target.gunHud = false\n    }\n    target.ready = true\n  }\n  targetLoop.id = target.id\n  const destroyTarget = (msg, targetToDestroy) => {\n    if (targetToDestroy.id !== target.id) return\n    scene.remove(targetToDestroy)\n    PubSub.publish('x.loops.remove', targetLoop)\n    hudData.targets.delete(targetToDestroy)\n    hudData.targetsInSight.delete(target)\n    hudElement.forceUpdate()\n  }\n  PubSub.subscribe('x.drones.destroy', destroyTarget)\n  PubSub.publish('x.loops.push', targetLoop)\n}\nPubSub.subscribe('x.hud.register.target', registerTarget)\n\nconst camVec = new Vector3()\nlet localX\nlet localY\nlet rollAngle\nlet pitch\nlet rollAngleDegree\nconst hudLoop = (timestamp) => {\n  localX = new Vector3(1, 0, 0).applyQuaternion(camera.quaternion)\n  localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n  rollAngle = (\n    Math.PI / 2 - camera.up.angleTo(localX) * Math.sign(camera.up.dot(localY))\n  )\n  camera.rollAngle = rollAngle\n  pitch = camera.up.dot(camera.getWorldDirection(camVec))\n  rollAngleDegree = rollAngle / Math.PI * 180\n  horizonStyle = {\n    transform: `translateX(-50%) translateY(${pitch * window.innerHeight / 2}px) rotate(${rollAngleDegree}deg)`\n  }\n  if (hudElement.state.lock) {\n    focalStyle = {boxShadow: '0 0 75px #0f0'}\n  } else {\n    focalStyle = {boxShadow: ''}\n  }\n  hudData.gunTarget = selectNearestGunTarget()\n  hudElement.update(timestamp, {horizonStyle, focalStyle, gunTarget: hudData.gunTarget})\n}\n\nPubSub.subscribe('x.hud.mounted', () => {\n  PubSub.publish('x.loops.push', hudLoop)\n  hudElement.mounted = true\n})\n\nPubSub.subscribe('x.drones.pilotDrone.loaded', (msg, data) => {\n  pilotDrone = data.pilotDrone\n})\n\nPubSub.subscribe('x.drones.missile.start', (msg, pilotDrone) => {\n  hudElement.setState(state => ({...state, lockLevel: 0, lock: false}))\n})\n\nconst selectNearestTargetInSight = () => {\n  if (hudData.targetsInSight.size === 0 || !hudElement.state.lock) return null\n  const distances = []\n  hudData.targetsInSight.forEach(target =>\n    distances.push([camera.position.distanceTo(target.position), target])\n  )\n  distances.sort((a, b) => a[0] > b[0])\n  return distances[0][1]\n}\n\nconst selectNearestGunTarget = () => {\n  if (hudData.targetsInSight.size === 0) return null\n  const distances = []\n  hudData.targetsInSight.forEach(target =>\n    distances.push([\n      new Vector2(target.hudPosition.x, target.hudPosition.y)\n        .sub(screenCenter)\n        .add(new Vector2(target.direction.x, target.direction.y)).length(),\n      target])\n  )\n  distances.sort((a, b) => a[0] > b[0])\n  return distances[0][1]\n}\n\nconst hudElement = ReactDOM.render(\n  <HUD />,\n  document.getElementById('hud')\n)\n\nexport {\n  selectNearestTargetInSight,\n  selectNearestGunTarget,\n  hudElement,\n  hudData\n}\n","import React, {PureComponent} from 'react'\n\nclass Crosshair extends PureComponent {\n  render () {\n    return (\n      <svg\n        x={this.props.x - this.props.size / 2}\n        y={this.props.y - this.props.size / 2}\n        viewBox='-10 -10 415 415' width={this.props.size} height={this.props.size}>\n        <g {...this.props}>\n          <circle cx='202.224' cy='202.228' r='26.686' />\n          <path d='M83.807,49.322L50.87,4.891c-9.519-9.527-30.71-3.78-40.236,5.747S-4.64,41.347,4.887,50.874\n            l44.431,32.937c9.519,9.519,24.963,9.527,34.49,0C93.334,74.284,93.326,58.84,83.807,49.322z' />\n          <path d='M393.823,10.638c-9.527-9.527-30.71-15.274-40.236-5.747l-32.937,44.431\n            c-9.527,9.527-9.527,24.963,0,34.49c9.527,9.527,24.963,9.519,34.49,0l44.431-32.937\n            C409.096,41.347,403.349,20.164,393.823,10.638z' />\n          <path d='M355.139,320.645c-9.527-9.527-24.963-9.527-34.49,0c-9.527,9.527-9.527,24.963,0,34.49\n            l32.937,44.431c9.527,9.519,30.71,3.78,40.236-5.747s15.274-30.71,5.747-40.236L355.139,320.645z' />\n          <path d='M49.318,320.645L4.887,353.582c-9.527,9.527-3.78,30.71,5.747,40.236s30.71,15.274,40.236,5.747\n            l32.937-44.431c9.527-9.519,9.527-24.963,0-34.49C74.28,311.127,58.844,311.127,49.318,320.645z' />\n        </g>\n      </svg>\n    )\n  }\n}\n\nexport default Crosshair\n","import SPE from 'shader-particle-engine/build/SPE'\nimport {\n  TextureLoader,\n  Vector2,\n  AdditiveBlending,\n  NormalBlending,\n  Vector3,\n  Color,\n  Line3\n} from 'three'\nimport PubSub from '../events'\n// import {scene} from '../index'\nimport {hudData, selectNearestGunTarget} from '../hud'\nimport {camera} from '../index'\n\n// GROUPS\nconst textureLoader = new TextureLoader()\nconst fireGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/Explosion_002_Tile_8x8_256x256.png')),\n    frames: new Vector2(8, 8),\n    // value: textureLoader.load(require('../textures/sprite-explosion2.png')),\n    // frames: new Vector2(5, 5),\n    loop: 1\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: AdditiveBlending,\n  scale: 600,\n  maxParticleCount: 25000\n}\nconst pointsGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/smokeparticle.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\nconst debrisGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/spark.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\nconst bulletGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/bullet.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\n\n// EMITTERS\nconst shockwaveOptions = {\n  particleCount: 200,\n  type: SPE.distributions.DISC,\n  position: {\n    radius: 5,\n    spread: new Vector3(5)\n  },\n  maxAge: {\n    value: 2,\n    spread: 0\n  },\n  duration: 1,\n  activeMultiplier: 2000,\n\n  velocity: {\n    value: new Vector3(40)\n  },\n  rotation: {\n    axis: new Vector3(0, 0, 1),\n    angle: Math.PI * 0.5,\n    static: true\n  },\n  size: { value: 2 },\n  color: {\n    value: [\n      new Color(0.4, 0.2, 0.1),\n      new Color(0.2, 0.2, 0.2)\n    ]\n  },\n  opacity: { value: [0.5, 0.2, 0] }\n}\nconst debrisOptions = {\n  particleCount: 100,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 2\n  },\n  duration: 1,\n  activeMultiplier: 40,\n  velocity: {\n    value: new Vector3(100)\n  },\n  acceleration: {\n    value: new Vector3(0, 0, -20),\n    distribution: SPE.distributions.BOX\n  },\n  wiggle: 3,\n  size: {\n    value: 2,\n    spread: 5\n  },\n  angle: {\n    spread: Math.PI * 2\n  },\n  drag: {\n    value: 1\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0),\n      new Color(1, 0, 0),\n      new Color(0.4, 0.2, 0.1)\n    ]\n  },\n  opacity: { value: [1, 1, 0] }\n}\nconst fireOptions = {\n  particleCount: 20,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 5\n  },\n  maxAge: { value: 2 },\n  duration: 1,\n  activeMultiplier: 20,\n  velocity: {\n    value: new Vector3(10)\n  },\n  size: { value: [20, 100] },\n  color: {\n    value: [\n      new Color(0.5, 0.1, 0.05),\n      new Color(0.2, 0.2, 0.2)\n    ]\n  },\n  opacity: { value: [0.5, 0.35, 0.1, 0] }\n}\nconst mistOptions = {\n  particleCount: 100,\n  position: {\n    spread: new Vector3(15, 15, 15),\n    distribution: SPE.distributions.SPHERE\n  },\n  maxAge: { value: 2 },\n  duration: 1,\n  activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(8, 3, 10),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: 40 },\n  color: {\n    value: new Color(0.2, 0.2, 0.2)\n  },\n  opacity: { value: [0, 0, 0.4, 0] }\n}\nconst flashOptions = {\n  duration: 1,\n  particleCount: 50,\n  position: { spread: new Vector3(5, 5, 5) },\n  velocity: {\n    spread: new Vector3(30),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [40, 20, 20, 20] },\n  maxAge: { value: 2 },\n  activeMultiplier: 2000,\n  // opacity: { value: [0.5, 0.25, 0, 0] }\n  opacity: { value: [1, 1, 0, 0] }\n  // opacity: { value: 1 }\n}\n\nconst smokeOptions = {\n  particleCount: 1000,\n  position: {\n    spread: new Vector3(1, 1, 1)\n  },\n  maxAge: { value: 10 },\n  // activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(4, 2, 5),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [20, 60] },\n  color: {\n    value: new Color(0.9, 0.9, 0.9)\n  },\n  opacity: { value: [0.4, 0.4, 0.4, 0] }\n}\n\nconst smokeLightOptions = {\n  particleCount: 1000,\n  position: {\n    spread: new Vector3(1, 1, 1)\n  },\n  maxAge: { value: 5 },\n  // activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(4, 2, 5),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [5, 10] },\n  color: {\n    value: new Color(1, 1, 1)\n  },\n  opacity: { value: [0.4, 0.4, 0.4, 0] }\n}\n\nconst bulletOptions = {\n  particleCount: 35,\n  type: SPE.distributions.BOX,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 1\n  },\n  duration: null,\n  activeMultiplier: 1,\n  velocity: {\n    value: new Vector3(100),\n    spread: new Vector3(20, 20, 20)\n  },\n  acceleration: {\n    value: 0\n  },\n  size: {\n    value: 1\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0)\n    ]\n  },\n  opacity: { value: 1 }\n}\n\nconst sparkOptions = {\n  particleCount: 10,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 0.3\n  },\n  duration: 0.3,\n  activeMultiplier: 1000,\n  velocity: {\n    value: new Vector3(100)\n  },\n  acceleration: {\n    value: 0\n  },\n  wiggle: 30,\n  size: {\n    value: [3, 1, 0.5]\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0)\n    ]\n  },\n  opacity: { value: 1 }\n}\n\nconst flashGroup = new SPE.Group(fireGroupOptions)\nconst fireGroup = new SPE.Group(fireGroupOptions)\n\nconst debrisGroup = new SPE.Group(debrisGroupOptions)\nconst shockGroup = new SPE.Group(pointsGroupOptions)\nconst mistGroup = new SPE.Group(pointsGroupOptions)\nconst smokeGroup = new SPE.Group(pointsGroupOptions)\nconst smokeLightGroup = new SPE.Group(pointsGroupOptions)\n\nconst bulletGroup = new SPE.Group(bulletGroupOptions)\nconst sparkGroup = new SPE.Group(debrisGroupOptions)\n\nconst poolSize = 25\nconst createNew = false\n\nflashGroup.addPool(poolSize, flashOptions, createNew)\nfireGroup.addPool(poolSize, fireOptions, createNew)\n\ndebrisGroup.addPool(poolSize, debrisOptions, createNew)\nshockGroup.addPool(poolSize, shockwaveOptions, createNew)\nmistGroup.addPool(poolSize, mistOptions, createNew)\nsmokeGroup.addPool(poolSize, smokeOptions, createNew)\nsmokeLightGroup.addPool(poolSize, smokeLightOptions, createNew)\n\nbulletGroup.addPool(poolSize, bulletOptions, createNew)\nsparkGroup.addPool(poolSize, sparkOptions, createNew)\n\nconst groups = [\n  flashGroup,\n  fireGroup,\n  debrisGroup,\n  shockGroup,\n  mistGroup,\n  smokeGroup,\n  smokeLightGroup,\n  bulletGroup,\n  sparkGroup\n]\n// avoid artifacts with the ocean\ngroups.forEach(group => { group.mesh.renderOrder = 2 })\nsmokeGroup.mesh.renderOrder = 1\n// cf. https://github.com/squarefeet/ShaderParticleEngine/issues/126\ngroups.forEach(group => { group.mesh.frustumCulled = false })\n\nwindow.smokeGroup = smokeGroup\n\nlet camVec = new Vector3()\n\nconst triggerSingleEmitter = (group, target, follow = false, velocityFunction, offset = false) => {\n  const emitter = group.getFromPool()\n\n  if (emitter === null) {\n    console.log('SPE.Group pool ran out.')\n    return\n  }\n\n  if (offset) {\n    emitter.position.value = target.position.clone().add(\n      camera.getWorldDirection(camVec).multiplyScalar(5)\n    )\n  } else {\n    emitter.position.value = target.position.clone()\n  }\n  if (velocityFunction) {\n    emitter.velocity.value = velocityFunction()\n  }\n\n  let initialPositions\n  // paramsArray vec4( alive, age, maxAge, wiggle )\n  let params\n  let velocities\n  let positions\n  let collisions\n  let bulletLine\n  let closestDistance\n  const targetVec3 = new Vector3()\n  const chunkReducer = (chunkSize) =>\n    (ar, it, i) => {\n      const ix = Math.floor(i / chunkSize)\n      if (!ar[ix]) ar[ix] = []\n      ar[ix].push(it)\n      return ar\n    }\n  const loop = {\n    loop: (timestamp, delta) => {\n      if (offset) {\n        emitter.position.value = target.position.clone().add(\n          camera.getWorldDirection(camVec).multiplyScalar(5)\n        )\n      } else {\n        emitter.position.value = target.position.clone()\n      }\n      if (velocityFunction) {\n        emitter.velocity.value = velocityFunction()\n        initialPositions = emitter.attributes.position.typedArray.array.slice(\n          emitter.attributeOffset * 3,\n          (emitter.activationEnd) * 3\n        ).reduce(chunkReducer(3), [])\n        velocities = emitter.attributes.velocity.typedArray.array.slice(\n          emitter.attributeOffset * 3,\n          (emitter.activationEnd) * 3\n        ).reduce(chunkReducer(3), [])\n        params = emitter.paramsArray.slice(\n          emitter.attributeOffset * 4,\n          (emitter.activationEnd) * 4\n        ).reduce(chunkReducer(4), [])\n        positions = params.map((param, i) => {\n          return param[0]\n            ? new Vector3(...initialPositions[i]).add(\n                new Vector3(...velocities[i]).multiplyScalar(param[1])\n              )\n            : null\n        })\n        collisions = []\n        positions.forEach((pos, i) => {\n          if (pos === null) return\n          hudData.targetsInFront.forEach((target) => {\n            bulletLine = new Line3(\n              pos,\n              pos.clone().add(new Vector3(...velocities[i]).multiplyScalar(delta / 1000))\n            )\n            closestDistance = bulletLine.closestPointToPoint(target.position, true, targetVec3).sub(target.position).length()\n            if (closestDistance < 10) {\n              collisions.push([target, pos])\n            }\n          })\n        })\n        if (collisions.length) {\n          collisions.forEach(ar => {\n            PubSub.publish('x.sound.impact', ar[0])\n            triggerSmallExplosion({position: ar[1]})\n            ar[0].userData.life -= 5\n          })\n        }\n      }\n    },\n    alive: true,\n    id: target.id\n  }\n  if (follow && !target.destroyed) {\n    PubSub.publish('x.loops.push', loop)\n    PubSub.subscribe('x.drones.destroy', (msg, drone) => {\n      if (drone.id !== target.id) return\n      loop.alive = false\n      emitter.disable()\n      group.releaseIntoPool(emitter)\n    })\n  }\n\n  emitter.loop = loop\n  emitter.enable()\n\n  if (emitter.duration) {\n    setTimeout(() => {\n      emitter.disable()\n      if (follow) { loop.alive = false }\n      group.releaseIntoPool(emitter)\n    }, (emitter.duration + emitter.maxAge.value + emitter.maxAge.spread) * 1000)\n  }\n\n  return emitter\n}\n\nconst triggerExplosion = (target) => {\n  triggerSingleEmitter(flashGroup, target)\n  triggerSingleEmitter(fireGroup, target)\n  triggerSingleEmitter(debrisGroup, target)\n  triggerSingleEmitter(mistGroup, target)\n}\nPubSub.subscribe('x.drones.explode', (msg, drone) => triggerExplosion(drone))\n\nconst triggerSmoke = (target) => {\n  if (target.smoking) return\n  target.smoking = true\n  triggerSingleEmitter(smokeGroup, target, true)\n}\nPubSub.subscribe('x.drones.smoke.start', (msg, drone) => triggerSmoke(drone))\n\nconst triggerLightSmoke = (target) => {\n  if (target.smoking) return\n  target.smoking = true\n  const smokeEmitter = triggerSingleEmitter(smokeLightGroup, target, true)\n  PubSub.subscribe('x.drones.missile.stop', (msg, missile) => {\n    smokeEmitter.loop.alive = false\n    smokeEmitter.disable()\n    smokeLightGroup.releaseIntoPool(smokeEmitter)\n  })\n}\nPubSub.subscribe('x.drones.missile.start', (msg, missile) => triggerLightSmoke(missile))\n\nconst triggerSmallExplosion = (target) => {\n  triggerSingleEmitter(sparkGroup, target)\n}\n\nlet tmpVec1 = new Vector3()\nlet targetVector = new Vector3()\nPubSub.subscribe('x.drones.gun.start', (msg, drone) => {\n  const target = selectNearestGunTarget()\n  const velocityFunction = () => {\n    if (target !== null && target.gunHud) {\n      tmpVec1.copy(target.position).sub(drone.position)\n      tmpVec1.add(target.velocity.clone().multiplyScalar(tmpVec1.length() / 500))\n      tmpVec1.normalize().multiplyScalar(500)\n      targetVector.copy(tmpVec1)\n    } else {\n      targetVector = camera.getWorldDirection(camVec).multiplyScalar(500)\n      const localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n      targetVector = targetVector.add(localY.multiplyScalar(24))\n    }\n    return targetVector\n  }\n  drone.gunEmitter = triggerSingleEmitter(bulletGroup, drone, true, velocityFunction, true)\n})\n\nPubSub.subscribe('x.drones.gun.stop', (msg, drone) => {\n  if (drone.gunEmitter) {\n    drone.gunEmitter.loop.alive = false\n    drone.gunEmitter.disable()\n    bulletGroup.releaseIntoPool(drone.gunEmitter)\n  }\n})\n\nexport {groups as particleGroups, triggerExplosion}\n","import {GLTFLoader} from '../modules'\nimport PubSub from '../events'\n\nvar loader = new GLTFLoader()\n\nlet droneMesh\n\nconst loadDroneAssets = () => {\n  loader.load(\n    // resource URL\n    './assets/drone/scene.gltf',\n    // called when the resource is loaded\n    function (gltf) {\n      droneMesh = gltf.scene.children[0]\n      PubSub.publish('x.assets.drone.loaded', {mesh: droneMesh})\n    }\n  )\n}\n\nexport default loadDroneAssets\n","import {\n  Vector3,\n  Clock,\n  Raycaster\n} from 'three'\nimport {scene, camera, loops} from '../index'\nimport PubSub from '../events'\nimport {triggerExplosion} from '../particles'\n\nlet droneFactory = {\n  ready: false\n}\n\nconst initDroneFactory = (msg, data) => {\n  droneFactory = () => {\n    const drone = data.mesh.clone()\n    drone.up.set(0, 0, 1)\n    drone.rotation.x = 0\n    drone.scale.set(0.1, 0.1, 0.1)\n    return drone\n  }\n  droneFactory.ready = true\n  PubSub.publish('x.drones.factory.ready')\n}\nPubSub.subscribe('x.assets.drone.loaded', initDroneFactory)\n\nconst buildPilotDrone = () => {\n  const pilotDrone = droneFactory()\n  pilotDrone.gunClock = new Clock(false)\n  pilotDrone.userData.altitude = NaN\n  pilotDrone.userData.speed = 0\n  pilotDrone.userData.lastPosition = pilotDrone.position.clone()\n  scene.add(pilotDrone)\n  window.pilotDrone = pilotDrone\n  let localY\n  let targetPosition\n  let targetPositionFinal\n  let camVec = new Vector3()\n  const raycaster = new Raycaster()\n  const downVector = new Vector3(0, 0, -1)\n  const offsetVector = new Vector3(0, 0, 100)\n  let terrainTiles\n  let lastTimestamp = 0\n  const pilotDroneLoop = (timestamp, delta) => {\n    camVec = camera.getWorldDirection(camVec)\n    targetPosition = camera.position.clone()\n      .add(camVec.multiplyScalar(20))\n    localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n    targetPositionFinal = targetPosition.sub(localY.multiplyScalar(8))\n    pilotDrone.position.copy(targetPositionFinal)\n    pilotDrone.lookAt(targetPosition\n      .add(camVec)\n      .add({x: 0, y: 0, z: 60})\n    )\n\n    // velocity computation\n    pilotDrone.userData.velocity = pilotDrone.position.clone()\n      .sub(pilotDrone.userData.lastPosition)\n      .multiplyScalar(1000 / delta)\n    pilotDrone.userData.speed = pilotDrone.userData.velocity.length()\n    pilotDrone.userData.lastPosition.copy(pilotDrone.position)\n\n    // altitude computation\n    if (timestamp - lastTimestamp > 200) {\n      lastTimestamp = timestamp\n      raycaster.set(pilotDrone.position.clone().add(offsetVector), downVector)\n      terrainTiles = raycaster.intersectObjects(\n        camera.userData.terrainTileUnder ? [camera.userData.terrainTileUnder] : []\n      )\n      if (terrainTiles.length > 0) {\n        pilotDrone.userData.altitude = terrainTiles[0].distance - offsetVector.length()\n        pilotDrone.userData.groundNormal = terrainTiles[0].face.normal\n      }\n      if (pilotDrone.userData.altitude < 5) {\n        PubSub.publish('x.drones.explode.pilotDrone', pilotDrone)\n        PubSub.publish('x.drones.collision.terrain.pilotDrone', pilotDrone.userData.groundNormal)\n      }\n    }\n  }\n  loops.push(pilotDroneLoop)\n  PubSub.publish('x.drones.pilotDrone.loaded', {pilotDrone})\n}\nPubSub.subscribe('x.drones.factory.ready', buildPilotDrone)\n\nconst spawnDrone = (circle = true, phase = 0) => {\n  const drone = droneFactory()\n  drone.lockClock = new Clock(false)\n  drone.userData.life = 100\n  scene.add(drone)\n  drone.lastPosition = drone.position.clone()\n  let camVec = new Vector3()\n  const droneLoop = (timestamp, delta) => {\n    if (!drone) return\n    const radius = 300\n    if (circle) {\n      drone.position.set(\n        radius * Math.cos(timestamp / 1000 / 3 + phase),\n        radius * Math.sin(timestamp / 1000 / 3 + phase),\n        300 + 50 * Math.cos(timestamp / 1000 + phase)\n      )\n    } else {\n      drone.position.copy(camera.position.clone()\n        .add(camera.getWorldDirection(camVec).multiplyScalar(100)))\n    }\n    drone.velocity = drone.position.clone().sub(drone.lastPosition).multiplyScalar(1000 / delta)\n    drone.lastPosition = drone.position.clone()\n    if (!drone.destroyed && drone.userData.life <= 50) {\n      PubSub.publish('x.drones.smoke.start', drone)\n    }\n    if (!drone.destroyed && drone.userData.life <= 0) {\n      PubSub.publish('x.drones.destroy', drone)\n      drone.destroyed = true\n      triggerExplosion(drone)\n    }\n  }\n  PubSub.subscribe('x.drones.destroy', (msg, deadDrone) => {\n    if (deadDrone.id === drone.id) {\n      PubSub.publish('x.loops.remove', droneLoop)\n    }\n  })\n  PubSub.publish('x.hud.register.target', drone)\n  loops.push(droneLoop)\n}\n\nconst initTargets = () => {\n  spawnDrone(true)\n  spawnDrone(true, Math.PI / 8)\n  spawnDrone(true, Math.PI / 4)\n  spawnDrone(true, Math.PI / 2)\n  spawnDrone(true, Math.PI)\n}\nPubSub.subscribe('x.drones.factory.ready', initTargets)\nPubSub.subscribe('x.drones.destroy', () => spawnDrone(true, Math.random() * 2 * Math.PI))\n\nexport default initDroneFactory\n","import loadDroneAssets from './loader'\nimport './init'\n\nexport default loadDroneAssets\n","import {\n    Quaternion,\n    Vector2,\n    Vector3\n} from 'three'\n\n/**\n * @author James Baicoianu / http://www.baicoianu.com/\n */\n\nexport default function FlyControls (object, domElement, nipple, pointer) {\n  this.object = object\n\n  this.domElement = (domElement !== undefined) ? domElement : document\n  if (domElement) this.domElement.setAttribute('tabindex', -1)\n\n    // API\n\n  this.movementSpeed = 0.1\n  this.rollSpeed = 0.001\n\n  this.dragToLook = false\n  this.autoForward = false\n\n  this.nipple = nipple\n  if (this.nipple) {\n    this.nipple.on('move', (event, data) => this.nipplemove(event, data))\n    this.nipple.on('end', (event, data) => {\n      this.autoForward = false\n      this.updateMovementVector()\n    })\n  }\n\n  this.acceleration = 100\n  this.velocity = new Vector3(0, 0, 0)\n\n  this.pointer = pointer\n  if (this.pointer) {\n    const pointerElement = document.getElementById('pointer')\n    this.zone = 400\n    this.pointer.on('attain', movements => {\n      const dims = this.getContainerDimensions().size\n      pointerElement.style.left = dims[0] / 2 + 'px'\n      pointerElement.style.top = dims[1] / 2 + 'px'\n\n      // movements is a readable stream\n      let pointerVector = new Vector2(0, 0)\n      movements.on('data', move => {\n        pointerVector.add(new Vector2(move.dx, move.dy))\n        if (pointerVector.length() > this.zone) {\n          pointerVector.normalize().multiplyScalar(this.zone)\n        }\n        pointerElement.style.transform = `\n          translateX(${pointerVector.x - 16}px)\n          translateY(${pointerVector.y - 16}px)\n        `\n        this.mousemove({\n          pageX: (pointerVector.x) / 1.5,\n          pageY: (pointerVector.y) / 1.5\n        })\n      })\n\n      movements.on('close', function () {\n                // no more movements from this pointer-lock session.\n      })\n    })\n  }\n\n    // disable default target object behavior\n\n  this.nipplemove = function (event, data) {\n    const mockEvent = {\n      pageX: data.distance * Math.cos(data.angle.radian) * 1.5,\n      pageY: -data.distance * Math.sin(data.angle.radian) * 1.5\n    }\n    this.mousemove(mockEvent)\n    this.autoForward = true\n    this.updateMovementVector()\n  }\n\n    // internals\n\n  this.tmpQuaternion = new Quaternion()\n\n  this.moveState = {\n    up: 0,\n    down: 0,\n    left: 0,\n    right: 0,\n    forward: 0,\n    back: 0,\n    pitchUp: 0,\n    pitchDown: 0,\n    yawLeft: 0,\n    yawRight: 0,\n    rollLeft: 0,\n    rollRight: 0\n  }\n  this.moveVector = new Vector3(0, 0, 0)\n  this.rotationVector = new Vector3(0, 0, 0)\n\n  this.keydown = function (event) {\n    if (event.altKey) {\n      return\n    }\n\n        // event.preventDefault();\n\n    switch (event.keyCode) {\n      case 16: /* shift */ this.movementSpeedMultiplier = 0.1; break\n\n      case 87: /* W */ this.moveState.forward = 1; break\n      case 83: /* S */ this.moveState.back = 1; break\n\n      case 65: /* A */ this.moveState.yawLeft = 1; break\n      case 68: /* D */ this.moveState.yawRight = 1; break\n\n      case 82: /* R */ this.moveState.up = 1; break\n      case 70: /* F */ this.moveState.down = 1; break\n\n      case 38: /* up */ this.moveState.pitchUp = 1; break\n      case 40: /* down */ this.moveState.pitchDown = 1; break\n\n      case 37: /* left */ this.moveState.yawLeft = 1; break\n      case 39: /* right */ this.moveState.yawRight = 1; break\n\n      case 81: /* Q */ this.moveState.rollLeft = 1; break\n      case 69: /* E */ this.moveState.rollRight = 1; break\n\n      default: // do nothing\n    }\n\n    this.updateMovementVector()\n    this.updateRotationVector()\n  }\n\n  this.keyup = function (event) {\n    switch (event.keyCode) {\n      case 16: /* shift */ this.movementSpeedMultiplier = 1; break\n\n      case 87: /* W */ this.moveState.forward = 0; break\n      case 83: /* S */ this.moveState.back = 0; break\n\n      case 65: /* A */ this.moveState.yawLeft = 0; break\n      case 68: /* D */ this.moveState.yawRight = 0; break\n\n      case 82: /* R */ this.moveState.up = 0; break\n      case 70: /* F */ this.moveState.down = 0; break\n\n      case 38: /* up */ this.moveState.pitchUp = 0; break\n      case 40: /* down */ this.moveState.pitchDown = 0; break\n\n      case 37: /* left */ this.moveState.yawLeft = 0; break\n      case 39: /* right */ this.moveState.yawRight = 0; break\n\n      case 81: /* Q */ this.moveState.rollLeft = 0; break\n      case 69: /* E */ this.moveState.rollRight = 0; break\n\n      default: // do nothing\n    }\n\n    this.updateMovementVector()\n    this.updateRotationVector()\n  }\n\n  this.mousemove = function (event) {\n    var container = this.getContainerDimensions()\n    var halfWidth = container.size[ 0 ] / 2\n    var halfHeight = container.size[ 1 ] / 2\n\n    this.moveState.yawLeft = -event.pageX / halfWidth\n    this.moveState.rollLeft = this.moveState.yawLeft / 2 - this.object.rollAngle / 5\n    this.moveState.pitchDown = event.pageY / halfHeight\n  }\n\n  this.deltaVelocity = null\n  this.deltaPosition = null\n  this.update = (delta) => {\n    var rotMult = delta * this.rollSpeed\n\n    this.deltaVelocity = this.moveVector.clone().multiplyScalar(\n      delta / 1000 * this.acceleration\n    )\n    this.velocity.sub(\n      this.velocity.clone().multiplyScalar(\n        Math.max(\n          1,\n          this.deltaVelocity.length() ? 1 : 100 / (this.velocity.length() + 1)\n        ) * 0.01 * delta / 16.67\n      )\n    ).add(this.deltaVelocity)\n    this.deltaPosition = this.velocity.clone().multiplyScalar(delta / 1000)\n    this.object.position.add(this.deltaPosition.applyQuaternion(this.object.quaternion))\n\n    this.tmpQuaternion.set(this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1).normalize()\n    this.object.quaternion.multiply(this.tmpQuaternion)\n\n        // expose the rotation vector for convenience\n    this.object.rotation.setFromQuaternion(this.object.quaternion, this.object.rotation.order)\n\n    this.updateRotationVector()\n    this.updateMovementVector()\n  }\n\n  this.updateMovementVector = function () {\n    var forward = (this.moveState.forward || (this.autoForward && !this.moveState.back)) ? 1 : 0\n\n    this.moveVector.x = (-this.moveState.left + this.moveState.right)\n    this.moveVector.y = (-this.moveState.down + this.moveState.up)\n    this.moveVector.z = (-forward + this.moveState.back)\n\n        // console.log( 'move:', [ this.moveVector.x, this.moveVector.y, this.moveVector.z ] );\n  }\n\n  this.updateRotationVector = function () {\n    this.rotationVector.x = (-this.moveState.pitchDown + this.moveState.pitchUp)\n    this.rotationVector.y = (-this.moveState.yawRight + this.moveState.yawLeft)\n    this.rotationVector.z = (-this.moveState.rollRight + this.moveState.rollLeft)\n\n        // console.log( 'rotate:', [ this.rotationVector.x, this.rotationVector.y, this.rotationVector.z ] );\n  }\n\n  this.getContainerDimensions = function () {\n    if (this.domElement !== document) {\n      return {\n        size: [ this.domElement.offsetWidth, this.domElement.offsetHeight ],\n        offset: [ this.domElement.offsetLeft, this.domElement.offsetTop ]\n      }\n    } else {\n      return {\n        size: [ window.innerWidth, window.innerHeight ],\n        offset: [ 0, 0 ]\n      }\n    }\n  }\n\n  function bind (scope, fn) {\n    return function () {\n      fn.apply(scope, arguments)\n    }\n  }\n\n  function contextmenu (event) {\n    event.preventDefault()\n  }\n\n  this.dispose = function () {\n    this.domElement.removeEventListener('contextmenu', contextmenu, false)\n\n    window.removeEventListener('keydown', _keydown, false)\n    window.removeEventListener('keyup', _keyup, false)\n  }\n\n  var _keydown = bind(this, this.keydown)\n  var _keyup = bind(this, this.keyup)\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false)\n\n  window.addEventListener('keydown', _keydown, false)\n  window.addEventListener('keyup', _keyup, false)\n\n  this.updateMovementVector()\n  this.updateRotationVector()\n};\n","import {\n  hudElement,\n  hudData\n} from '../hud'\nimport {clamp} from '../utils'\n\nclass AutoPilot {\n  constructor(ship, controls, active) {\n    this.ship = ship\n    this.controls = controls\n    this.active = active\n    this.target = null\n    this.pointerElement = document.getElementById('pointer')\n  }\n\n  toggle() {\n    this.active = !this.active\n  }\n\n  update(delta) {\n    if (!this.active) return\n    this.state = {...hudElement.state, ...hudData}\n\n    if (this.target === null || this.target.destroyed) {\n      this.target = Array.from(this.state.targets)\n        .filter(target => target.ready && !target.destroyed)\n        .reduce(\n          (a, b) => a.userData.distance < b.userData.distance ? a : b\n        )\n    }\n\n    if (!this.target) return\n\n    const move = {x: 0, y: 0}\n    if (this.target.hudPosition.z > 1) {\n      let uturnX = Math.sign(this.target.userData.hudPositionCentered.x) * 100\n      move.x += uturnX\n      move.y += uturnX * Math.abs(Math.sin(this.ship.rollAngle))\n    } else {\n      move.x += clamp(-100, this.target.userData.hudPositionCentered.x, 100)\n      move.y += clamp(-100, this.target.userData.hudPositionCentered.y, 100)\n    }\n    this.controls.mousemove({\n      pageX: move.x,\n      pageY: move.y\n    })\n    this.pointerElement.style.transform = `\n      translateX(${move.x - 16}px)\n      translateY(${move.y - 16}px)\n    `\n\n    if (this.target.userData.distance > 150) {\n      this.controls.moveState.forward = 1\n    } else {\n      this.controls.moveState.forward = 0\n    }\n  }\n}\n\nexport default AutoPilot\n","import keyboardJS from 'keyboardjs'\nimport nipplejs from 'nipplejs'\nimport lock from 'pointer-lock'\nimport {mobileAndTabletcheck} from '../utils/isMobile'\nimport FlyControls from '../modules/FlyControls'\n// import {OrbitControls} from '../modules/OrbitControls'\nimport {triggerExplosion} from '../particles'\nimport PubSub from '../events'\nimport {scene, camera, renderer} from '../index'\nimport {\n  Mesh,\n  SphereBufferGeometry,\n  MeshPhongMaterial,\n  Vector3\n} from 'three'\nimport {selectNearestTargetInSight, hudElement} from '../hud'\nimport AutoPilot from './autopilot'\n\nlet controls = {\n  module: null,\n  setAcceleration (value) {\n    if (this.module && value !== this.module.acceleration) {\n      this.module.acceleration = value\n      console.log('acceleration set to ', value)\n    }\n  }\n}\nlet controlsElement\nlet isMobile = mobileAndTabletcheck()\nlet controlsInitialized = false\nconst initControls = (msg, data) => {\n  if (controlsInitialized) return\n  if (isMobile) {\n    document.getElementById('touchPane').style.display = 'block'\n    const touchPaneLeft = window.document.getElementsByClassName('touchPaneLeft')[0]\n    const nippleLook = nipplejs.create({\n      zone: touchPaneLeft,\n      mode: 'static',\n      position: {left: '30%', top: '90%'},\n      color: 'white'\n    })\n\n    // display touch buttons\n    Array.from(document.getElementsByClassName('touchButton')).forEach(el => {\n      el.style.display = 'block'\n    })\n    // hide verbose text\n    document.getElementById('verbosePane').style.display = 'none'\n    // get button X\n    const buttonX = document.getElementById('buttonX')\n    const pressX = (event) => {\n      event.target.style.opacity = 0.5\n      fireBullet({button: 2})\n      setTimeout(() => { event.target.style.opacity = 0.3 }, 250)\n    }\n    buttonX.addEventListener('click', pressX, false)\n    buttonX.addEventListener('touchstart', pressX, false)\n\n    controls.module = new FlyControls(camera, touchPaneLeft, nippleLook)\n    controlsElement = touchPaneLeft\n  } else {\n    const pointer = lock(renderer.domElement)\n    controls.module = new FlyControls(camera, renderer.domElement, undefined, pointer)\n    controlsElement = renderer.domElement\n  }\n\n  controls.module.update(0)\n\n  const autoPilot = new AutoPilot(camera, controls.module, false)\n  keyboardJS.bind('p', e => autoPilot.toggle())\n\n  PubSub.publish('x.loops.unshift', (timestamp, delta) => {\n    autoPilot.update(timestamp, delta)\n    controls.module.update(delta)\n  })\n\n  const pilotDrone = data.pilotDrone\n\n  // keyboardJS.bind('p', e => {\n  //   if (isMobile) { return }\n  //   const NewControlsClass = controls.module.constructor.name === 'OrbitControls' ? FlyControls : OrbitControls\n  //   console.log('controlsClass', NewControlsClass)\n  //   controls.module.dispose()\n  //   const newModule = new NewControlsClass(camera, controlsElement)\n  //   window.controls = newModule\n  //   controls.module = newModule\n  //   controls.module.update(0)\n\n  //   if (NewControlsClass === OrbitControls) {\n  //     let cam = pilotDrone.position.clone()\n  //     newModule.target.set(cam.x, cam.y, cam.z)\n  //   }\n  // })\n\n  keyboardJS.bind('c', e => {\n    console.log(camera.position)\n  })\n\n  keyboardJS.bind('r', e => {\n    if (controls.module.constructor.name === 'OrbitControls') {\n      controls.module.autoRotate = !controls.module.autoRotate\n    }\n  })\n\n  keyboardJS.bind('space', e => PubSub.publish('x.toggle.play'))\n\n  const bullet = new Mesh(\n    new SphereBufferGeometry(1, 5, 5),\n    new MeshPhongMaterial({color: 0x111111})\n  )\n  const fireBullet = e => {\n    if (!pilotDrone) return\n\n    if (e.button === 0) { // left click\n      PubSub.publish('x.drones.gun.start', pilotDrone)\n      PubSub.publish('x.camera.shake.start', 5)\n      pilotDrone.gunClock.start()\n    } else if (e.button === 2) { // right click\n      const target = selectNearestTargetInSight()\n      if (target === null || target.destroyed) return\n\n      const fire = bullet.clone()\n      fire.position.copy(pilotDrone.position)\n      scene.add(fire)\n      PubSub.publish('x.drones.missile.start', fire)\n\n      const BulletContructor = function () {\n        this.alive = true\n        this.object = fire\n        this.loop = (timestamp, delta) => {\n          if (!this.alive) return\n          const vec = target.position.clone().sub(fire.position)\n          if (vec.length() < 10) {\n            this.alive = false\n            triggerExplosion(target)\n            PubSub.publish('x.drones.missile.stop', fire)\n            PubSub.publish('x.drones.explosion', target)\n            target.userData.life -= 25\n            hudElement.forceUpdate()\n          }\n          const newDir = vec.normalize().multiplyScalar(10 * delta / 16.66)\n          fire.position.add(newDir)\n        }\n      }\n\n      const callback = new BulletContructor()\n      PubSub.publish('x.loops.push', callback)\n    }\n  }\n  renderer.domElement.addEventListener('mousedown', fireBullet, false)\n  renderer.domElement.addEventListener('mouseup', (e) => {\n    if (e.button === 0) {\n      PubSub.publish('x.drones.gun.stop', pilotDrone)\n      PubSub.publish('x.camera.shake.stop')\n      pilotDrone.gunClock.stop()\n    }\n  }, false)\n}\nPubSub.subscribe('x.drones.pilotDrone.loaded', initControls)\n\nlet tmpVec = new Vector3()\nPubSub.subscribe('x.drones.collision.terrain.pilotDrone', (msg, terrainNormal) => {\n  controls.setAcceleration(0)\n  tmpVec.copy(controls.module.velocity).applyQuaternion(camera.quaternion)\n  tmpVec.reflect(terrainNormal)\n  tmpVec.add(camera.position)\n  controls.module.velocity = camera.worldToLocal(tmpVec)\n  setTimeout(() => { controls.setAcceleration(60) }, 1000)\n})\n\nexport default controls\n","const mobilecheck = function () {\n  var check = false;\n  (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true })(navigator.userAgent || navigator.vendor || window.opera) // eslint-disable-line\n  return check\n}\n\nconst mobileAndTabletcheck = function () {\n  var check = false;\n  (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true })(navigator.userAgent || navigator.vendor || window.opera) // eslint-disable-line\n  return check\n}\n\nexport {mobilecheck, mobileAndTabletcheck}\n","import {\n  AudioListener,\n  Audio,\n  PositionalAudio,\n  AudioLoader\n} from 'three'\nimport {camera} from '../index'\nimport PubSub from '../events'\n\nconst audioLoader = new AudioLoader()\n\nconst impacts = [\n  {url: require('./impact1.ogg')},\n  {url: require('./impact2.ogg')},\n  {url: require('./impact3.ogg')},\n  {url: require('./impact4.ogg')}\n]\n\nconst weapons = [\n  {url: require('./gatling.ogg')},\n  {url: require('./missile.ogg')}\n]\n\nconst explosions = [\n  {url: require('./explosion1.ogg')},\n  {url: require('./explosion2.ogg')}\n]\n\nconst audioMapper = sound => {\n  audioLoader.load(sound.url, buffer => { sound.buffer = buffer })\n}\n\nconst setupSound = () => {\n  camera.listener = new AudioListener()\n  camera.add(camera.listener)\n\n  impacts.map(audioMapper)\n  weapons.map(audioMapper)\n  explosions.map(audioMapper)\n\n  PubSub.subscribe('x.sound.impact', (msg, drone) => {\n    const n = Math.floor(Math.random() * impacts.length)\n    if (!impacts[n].buffer) return\n    const sound = new PositionalAudio(camera.listener)\n    sound.setBuffer(impacts[n].buffer)\n    sound.setRefDistance(100)\n    drone.add(sound)\n    sound.play()\n    // drone.remove(sound) // necessary ?\n  })\n\n  const playExplosion = (msg, drone) => {\n    const n = Math.floor(Math.random() * explosions.length)\n    if (!explosions[n].buffer) return\n    const sound = new PositionalAudio(camera.listener)\n    sound.setBuffer(explosions[n].buffer)\n    sound.setRefDistance(500)\n    drone.add(sound)\n    sound.play()\n    // drone.remove(sound) // necessary ?\n  }\n  PubSub.subscribe('x.drones.destroy', playExplosion)\n  PubSub.subscribe('x.drones.explosion', playExplosion)\n\n  const gatlingSound = new Audio(camera.listener)\n  PubSub.subscribe('x.drones.gun.start', (msg, drone) => {\n    if (!weapons[0].buffer) return\n    gatlingSound.setBuffer(weapons[0].buffer)\n    gatlingSound.setLoop(true)\n    gatlingSound.play()\n  })\n  PubSub.subscribe('x.drones.gun.stop', (msg, drone) => {\n    gatlingSound.stop()\n  })\n\n  const missileSound = new Audio(camera.listener)\n  PubSub.subscribe('x.drones.missile.start', (msg, drone) => {\n    if (!weapons[1].buffer) return\n    missileSound.setBuffer(weapons[1].buffer)\n    missileSound.play()\n  })\n  PubSub.subscribe('x.drones.missile.stop', (msg, drone) => {\n    missileSound.stop()\n  })\n}\n\nexport default setupSound\n","import {\n  Vector4,\n  Matrix4,\n  Color\n} from 'three'\nimport waterFragmentShader from './water_frag.glsl'\nimport waterVertexShader from './water_vert.glsl'\nimport underwaterFragmentShader from './underwater_frag.glsl'\nimport underwaterVertexShader from './underwater_vert.glsl'\n\nconst WaterShader = {\n\n  uniforms: {\n\n    'color': {type: 'c', value: null},\n    'reflectivity': {type: 'f', value: 0},\n    'surface': {type: 'f', value: 0},\n    'tReflectionMap': {type: 't', value: null},\n    'tRefractionMap': {type: 't', value: null},\n    'tNormalMap0': {type: 't', value: null},\n    'tNormalMap1': {type: 't', value: null},\n    'tDepth': {type: 't', value: null},\n    'textureMatrix': {type: 'm4', value: null},\n    'clipToWorldMatrix': {type: 'm4', value: null},\n    'config': {type: 'v4', value: new Vector4()}\n  },\n  vertexShader: waterVertexShader,\n  fragmentShader: waterFragmentShader\n}\n\nconst UnderwaterShader = {\n  uniforms: {\n    color: {type: 'c', value: new Color(0xffffff)},\n    reflectivity: {type: 'f', value: 0.75},\n    waterLevel: {type: 'f', value: 0},\n    tDepth: { type: 't', value: null },\n    tDiffuse: { type: 't', value: null },\n    tReflectionMap: { type: 't', value: null },\n    tReflectionDepth: { type: 't', value: null },\n    tNormalMap0: { type: 't', value: null },\n    tNormalMap1: { type: 't', value: null },\n\n    clipToWorldMatrix: { type: 'm4', value: null },\n    worldToClipMatrix: { type: 'm4', value: new Matrix4() },\n    cameraPosition: {type: 'v3', value: null},\n    sunPosition: {type: 'v3', value: null},\n    time: {type: 'f', value: 0}\n  },\n  vertexShader: underwaterVertexShader,\n  fragmentShader: underwaterFragmentShader\n}\n\nconst WiggleShader = {\n  uniforms: {\n    tDiffuse: { type: 't', value: null },\n    time: {type: 'f', value: 0}\n  },\n  vertexShader: `\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  `,\n  fragmentShader: `\n    uniform float time;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n\n    float frequency = 10.;\n    float amplitude = 0.005;\n\n    void main() {\n      vec2 uv = vUv;\n      float X = vUv.x * frequency + time;\n      float Y = vUv.y * frequency + time;\n      uv.y += cos(X + Y) * amplitude * cos(Y);\n      uv.x += sin(X - Y) * amplitude * sin(Y);\n      gl_FragColor = texture2D(tDiffuse, uv);\n    }\n  `\n}\n\nexport {WaterShader, UnderwaterShader, WiggleShader}\n","import './index.css'\nimport {\n  Scene,\n  PerspectiveCamera,\n  CubeCamera,\n  Vector2,\n  Vector3,\n  Matrix4,\n  WebGLRenderer,\n  PCFSoftShadowMap,\n  Uncharted2ToneMapping,\n  Color,\n  FogExp2,\n  Mesh,\n  SphereBufferGeometry,\n  MeshBasicMaterial,\n  WebGLRenderTarget,\n  DepthTexture,\n  MeshDepthMaterial,\n\n  // Water imports\n  PlaneBufferGeometry,\n  TextureLoader,\n  RepeatWrapping,\n  LOD,\n  Plane,\n  GridHelper\n} from 'three'\nimport dat from 'dat.gui/build/dat.gui.js'\nimport Stats from 'stats.js'\nimport queryString from 'query-string'\nimport {WindowResize} from './modules/WindowResize'\n// import {ShadowMapViewer} from './modules/ShadowMapViewer'\nimport {initSky} from './sky'\nimport {initLights, dirLight} from './lights'\nimport {terrainLoop} from './loops/terrainLoop'\nimport {\n  lensFlare,\n  motionBlurShader\n} from './postprocessing'\nimport {particleGroups} from './particles'\nimport PubSub from './events'\nimport setupDrones from './drones'\nimport controls from './controls'\nimport setupSound from './sound'\n\nimport {\n  EffectComposer,\n  ShaderPass,\n  RenderPass,\n  SavePass,\n  CopyShader,\n  BlendShader,\n  GlitchPass,\n  Water,\n  Reflector\n} from './modules'\nimport {\n  WaterShader,\n  UnderwaterShader,\n  WiggleShader\n} from './ocean'\n\nconst queryStringOptions = queryString.parse(window.location.search)\nconst options = {\n  PBR: queryStringOptions.PBR === 'true',\n  shadows: queryStringOptions.shadows === 'true',\n  postprocessing: queryStringOptions.postprocessing === 'true'\n}\nif (options.PBR) {\n  // PBR material needs an envMap\n  options.postprocessing = true\n}\n\nconst scene = new Scene()\nlet camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1e6)\n\ncamera.up = new Vector3(0, 0, 1)\n// camera.position.set(-500, 0, 700)\n// camera.position.set(-70, -475, 275)\n// // camera.position.set(170, -500, 180)\n// camera.lookAt(0, 0, 0)\ncamera.position.set(-70, 175, 345)\ncamera.lookAt(0, -400, 0)\ncamera.rollAngle = 0\ncamera.userData = {terrainKeysUnder: []}\ncamera.updateMatrixWorld()\ncamera.updateProjectionMatrix()\n\nsetupSound()\n\nvar renderer = new WebGLRenderer({\n  antialias: true,\n  alpha: true,\n  logarithmicDepthBuffer: false\n})\n\nrenderer.gammaInput = true\nrenderer.gammaOutput = true\nrenderer.shadowMap.enabled = options.shadows\nrenderer.shadowMap.bias = 0.001\nrenderer.shadowMap.type = PCFSoftShadowMap\nrenderer.shadowMap.autoUpdate = true\nrenderer.physicallyCorrectLights = true\nrenderer.toneMapping = Uncharted2ToneMapping\n\nrenderer.setSize(window.innerWidth, window.innerHeight)\ndocument.body.appendChild(renderer.domElement)\n\nwindow.scene = scene\nwindow.renderer = renderer\nwindow.camera = camera\nwindow.controls = controls\n\nconst gui = new dat.GUI({ autoPlace: false })\ngui.closed = true\nwindow.document.getElementsByClassName('guiPane')[0].appendChild(gui.domElement)\nwindow.gui = gui\nPubSub.publish('x.gui.init', {gui})\n\nconst rendererFolder = gui.addFolder('Level of detail')\nconst RendererController = function () {\n  this.low = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: false,\n      postprocessing: false\n    })\n  }\n  this.lowShadow = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: true,\n      postprocessing: false\n    })\n  }\n  this.lowShadowDoF = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: true,\n      postprocessing: true\n    })\n  }\n  this.high = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: true,\n      shadows: true,\n      postprocessing: true\n    })\n  }\n}\nconst rendererController = new RendererController()\nconst lowController = rendererFolder.add(rendererController, 'low')\nlowController.name('low (default)')\n// rendererFolder.add(rendererController, 'lowShadow')\n// rendererFolder.add(rendererController, 'lowShadowDoF')\n// rendererFolder.add(rendererController, 'high')\nscene.background = new Color(0x91abb5);\nscene.fog = new FogExp2(0x91abb5, 0.0005)\n\nconst drone = new Mesh(\n  new SphereBufferGeometry(5, 5, 5),\n  new MeshBasicMaterial({\n    color: 0xffffff\n  })\n)\ndrone.visible = false\nscene.add(drone)\n\nconst sunPosition = new Vector3()\nwindow.sunPosition = sunPosition\ninitSky(scene, sunPosition, gui)\ninitLights(scene, sunPosition)\ndirLight.target = drone\nscene.add(lensFlare)\n\n// ##########################\nconst waterParameters = {\n  oceanSide: 20000,\n  size: 1.0,\n  distortionScale: 3.7,\n  alpha: 1.0\n}\nconst waterGeometry = new PlaneBufferGeometry(waterParameters.oceanSide * 5, waterParameters.oceanSide * 5, 10, 10)\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\nconst water = new Water(\n  waterGeometry,\n  {\n    textureWidth: 512,\n    textureHeight: 512,\n    color: 0xffffff,\n    flowDirection: new Vector2(1, 1),\n    scale: 20000 / 15.0,\n    normalMap0: textureLoader.load(require('./textures/Water_1_M_Normal.jpg')),\n    normalMap1: textureLoader.load(require('./textures/Water_2_M_Normal.jpg')),\n    clipBias: 0.00001,\n    reflectivity: 0.2,\n    shader: WaterShader,\n    flowSpeed: 0.1\n  }\n)\nwindow.water = water\nconst waterTarget = new WebGLRenderTarget(window.innerWidth, window.innerHeight)\nconst depthMaterial = new MeshDepthMaterial()\nwaterTarget.depthBuffer = true\nwaterTarget.depthTexture = new DepthTexture()\nwater.material.uniforms.tDepth.value = waterTarget.depthTexture\n\nwater.up.set(0, 0, 1)\n// water.rotation.z = -Math.PI / 2\nwater.position.z = 75\nwater.material.uniforms.surface.value = water.position.z\ngui.__folders['Sun, sky and ocean'].add(water.position, 'z', 0, 200, 1)\nwater.receiveShadow = true\nwater.userData.isWater = true\nwindow.water = water\nscene.add(water)\n\nconst underwaterReflector = new Reflector(waterGeometry, {\n  textureWidth: 512,\n  textureHeight: 512,\n  clipBias: 0.00001\n  // shader: WaterRefractionShader\n})\nunderwaterReflector.rotation.y = Math.PI\nunderwaterReflector.up.set(0, 0, -1)\nunderwaterReflector.position.copy(water.position)\nunderwaterReflector.getRenderTarget().depthBuffer = true\nunderwaterReflector.getRenderTarget().depthTexture = new DepthTexture()\nwindow.ref = underwaterReflector\nunderwaterReflector.updateMatrixWorld()\n// ##########################\n\nsetupDrones()\n\nparticleGroups.forEach(group => scene.add(group.mesh))\n// var helper = new CameraHelper( camera );\n// scene.add( helper );\n\n// const shadowMapViewer = new ShadowMapViewer(dirLight)\nlet shakeCamera = false\nlet shakeAmplitude = 1\nPubSub.subscribe('x.camera.shake.start', (msg, value = 1) => (shakeCamera = true))\nPubSub.subscribe('x.camera.shake.stop', () => (shakeCamera = false))\n\nlet loops = [\n  () => lensFlare.position.copy(sunPosition),\n  terrainLoop,\n  (timestamp, delta) => {\n    particleGroups.forEach(group => group.tick(delta / 1000))\n  },\n  () => {\n    if (shakeCamera) {\n      camera.position.add({\n        x: (Math.random() - 0.5) * shakeAmplitude,\n        y: (Math.random() - 0.5) * shakeAmplitude,\n        z: (Math.random() - 0.5) * shakeAmplitude\n      })\n      glitch.enabled = true\n      motionPass.renderToScreen = false\n    } else {\n      glitch.enabled = false\n      motionPass.renderToScreen = true\n    }\n  },\n  () => scene.children.forEach(child => {\n    if (child instanceof LOD) {\n      child.update(camera)\n    }\n  }),\n  (timestamp, delta) => {\n    if (camera.position.z < water.position.z) {\n      underwaterPass.enabled = true\n      wigglePass.enabled = true\n      water.visible = false\n      underwaterReflector.onBeforeRender(renderer, scene, camera)\n      underwaterPass.material.uniforms.time.value = timestamp / 1000\n      wigglePass.material.uniforms.time.value = timestamp / 1000\n      controls.setAcceleration(30)\n    } else {\n      underwaterPass.enabled = false\n      wigglePass.enabled = false\n      water.visible = true\n      controls.setAcceleration(100)\n    }\n  }\n]\nconst removeLoop = (loop) => {\n  loops = loops.filter(item => item !== loop)\n}\nPubSub.subscribe('x.loops.remove', (msg, loop) => removeLoop(loop))\nPubSub.subscribe('x.loops.push', (msg, loop) => loops.push(loop))\nPubSub.subscribe('x.loops.unshift', (msg, loop) => loops.unshift(loop))\n\nwindow.loops = loops\nPubSub.publish('x.loops.loaded')\nconst cleanLoops = () => {\n  loops.forEach(loop => {\n    if (loop.alive !== undefined && loop.alive === false && loop.object) {\n      scene.remove(loop.object)\n    }\n  })\n  loops = loops.filter(loop => loop.alive === undefined || loop.alive === true)\n}\n\n// Start the app\nrenderer.setPixelRatio(1.0)\n\nconst stats = new Stats()\ndocument.body.appendChild(stats.dom)\n\n// ###################################\n// EFFECTS\n// define a render target with a depthbuffer\nconst target = new WebGLRenderTarget(window.innerWidth, window.innerHeight)\nconst composer = new EffectComposer(renderer, target)\n\n// initial render pass\nconst renderPass = new RenderPass(scene, camera)\ncomposer.addPass(renderPass)\n\n// add an underwater shader pass\nconst underwaterPass = new ShaderPass(UnderwaterShader)\nunderwaterPass.enabled = false\nunderwaterPass.material.uniforms.waterLevel.value = water.position.z\nunderwaterPass.material.uniforms.tDepth.value = waterTarget.depthTexture\nunderwaterPass.material.uniforms.cameraPosition.value = camera.position\nunderwaterPass.material.uniforms.sunPosition.value = sunPosition\nunderwaterPass.material.uniforms.tReflectionMap.value = underwaterReflector.getRenderTarget().texture\nunderwaterPass.material.uniforms.tReflectionDepth.value = underwaterReflector.getRenderTarget().depthTexture\nlet tNormalMap0 = underwaterPass.material.uniforms.tNormalMap0\nlet tNormalMap1 = underwaterPass.material.uniforms.tNormalMap1\ntNormalMap0.value = textureLoader.load(require('./textures/Water_1_M_Normal.jpg'))\ntNormalMap1.value = textureLoader.load(require('./textures/Water_2_M_Normal.jpg'))\ntNormalMap0.value.wrapS = tNormalMap0.value.wrapT = RepeatWrapping\ntNormalMap1.value.wrapS = tNormalMap1.value.wrapT = RepeatWrapping\ncomposer.addPass(underwaterPass)\nwindow.upass = underwaterPass\n\n// add an underwater wiggle pass\nconst wigglePass = new ShaderPass(WiggleShader)\nwigglePass.enabled = false\ncomposer.addPass(wigglePass)\n\n// add a motion blur pass\nconst motionPass = new ShaderPass(motionBlurShader, 'tColor')\nmotionPass.renderToScreen = true\nmotionPass.material.uniforms.tDepth.value = waterTarget.depthTexture\nmotionPass.material.uniforms.velocityFactor.value = 1\ncomposer.addPass(motionPass)\n\n// define variables used by the motion blur pass\nlet previousMatrixWorldInverse = new Matrix4()\nlet previousProjectionMatrix = new Matrix4()\nlet previousCameraPosition = new Vector3()\nlet tmpMatrix = new Matrix4()\n\n// add a glitch pass\nconst glitch = new GlitchPass()\nglitch.renderToScreen = true\ncomposer.addPass(glitch)\n// ###################################\n\nlet play = true\nPubSub.subscribe('x.toggle.play', () => { play = !play })\n\nlet lastTimestamp = 0\nvar mainLoop = (timestamp) => {\n  requestAnimationFrame(mainLoop)\n  let delta = timestamp - lastTimestamp\n  lastTimestamp = timestamp\n\n  if (play) {\n    loops.forEach(loop => {\n      loop.loop ? loop.loop(timestamp, delta) : loop(timestamp, delta)\n    })\n\n    // update motion blur shader uniforms\n    motionPass.material.uniforms.delta.value = delta\n    // tricky part to compute the clip-to-world and world-to-clip matrices\n    motionPass.material.uniforms.clipToWorldMatrix.value\n        .getInverse(camera.matrixWorldInverse).multiply(tmpMatrix.getInverse(camera.projectionMatrix))\n    motionPass.material.uniforms.previousWorldToClipMatrix.value\n        .copy(previousProjectionMatrix.multiply(previousMatrixWorldInverse))\n    motionPass.material.uniforms.cameraMove.value.copy(camera.position).sub(previousCameraPosition)\n\n    // render to depth target\n    scene.overrideMaterial = depthMaterial\n    water.visible = false\n    renderer.setRenderTarget(waterTarget)\n    renderer.render(scene, camera)\n    water.visible = true\n    scene.overrideMaterial = null\n\n    // water uniforms\n    water.material.uniforms.clipToWorldMatrix.value = motionPass.material.uniforms.clipToWorldMatrix.value\n    underwaterPass.material.uniforms.clipToWorldMatrix.value = motionPass.material.uniforms.clipToWorldMatrix.value\n    underwaterPass.material.uniforms.worldToClipMatrix.value\n      .copy(camera.projectionMatrix).multiply(camera.matrixWorldInverse)\n\n    // render the postprocessing passes\n    composer.render(delta)\n\n    // save some values for the next render pass\n    previousMatrixWorldInverse.copy(camera.matrixWorldInverse)\n    previousProjectionMatrix.copy(camera.projectionMatrix)\n    previousCameraPosition.copy(camera.position)\n\n    // if (dirLight.shadow && dirLight.shadow.map) {\n    //   shadowMapViewer.render(renderer)\n    // }\n  }\n\n  cleanLoops()\n\n  stats.update()\n}\n\nmainLoop(0)\n\nWindowResize(renderer, camera)\n\nexport {renderer, scene, camera, drone, sunPosition, gui, options, loops}\n","import {\n  Mesh,\n  // SphereBufferGeometry,\n  SphereGeometry,\n  MeshBasicMaterial,\n  BackSide\n} from 'three'\nimport {Sky} from '../modules/Sky'\nimport {dirLight} from '../lights'\n\nfunction initSky (scene, sunPosition, gui) {\n  // Add Sky\n  const sky = new Sky()\n  sky.scale.setScalar(450000)\n  scene.add(sky)\n\n  // Add Sun Helper\n  // const sunSphere = new Mesh(\n  //     new SphereBufferGeometry( 20000, 16, 8 ),\n  //     new MeshBasicMaterial( { color: 0xffffff } )\n  // );\n  // sunSphere.position.y = - 700000;\n  // sunSphere.visible = false;\n  // scene.add( sunSphere );\n\n  var skyGeo = new SphereGeometry(1e5, 8, 8)\n  // flip faces so that overrideMaterial MeshDepthMatrial renders the skydome\n  // cf. https://stackoverflow.com/a/21485105/343834\n  for (let i = 0; i < skyGeo.faces.length; i++) {\n    const face = skyGeo.faces[i]\n    const temp = face.a\n    face.a = face.c\n    face.c = temp\n  }\n  var material = new MeshBasicMaterial({\n    opacity: 0\n  })\n  var skyDome = new Mesh(skyGeo, material)\n  skyDome.material.side = BackSide\n  scene.add(skyDome)\n\n  /// GUI\n\n  var effectController = {\n    turbidity: 10,\n    rayleigh: 2,\n    mieCoefficient: 0.005,\n    mieDirectionalG: 0.8,\n    luminance: 1,\n    inclination: 0.32, // elevation / inclination\n    azimuth: 0.2, // Facing front,\n    sun: !true\n  }\n\n  if (gui) {\n    var distance = 400000\n    function guiChanged () { // eslint-disable-line\n      var uniforms = sky.material.uniforms\n      uniforms.turbidity.value = effectController.turbidity\n      uniforms.rayleigh.value = effectController.rayleigh\n      uniforms.luminance.value = effectController.luminance\n      uniforms.mieCoefficient.value = effectController.mieCoefficient\n      uniforms.mieDirectionalG.value = effectController.mieDirectionalG\n\n      var theta = Math.PI * (effectController.inclination - 0.5)\n      var phi = 2 * Math.PI * (effectController.azimuth - 0.5)\n\n      sunPosition.x = distance * Math.cos(phi)\n      sunPosition.z = distance * Math.sin(phi) * Math.sin(theta)\n      sunPosition.y = distance * Math.sin(phi) * Math.cos(theta)\n\n        // sunSphere.visible = effectController.sun;\n\n      uniforms.sunPosition.value.copy(sunPosition)\n      sunPosition.copy(sunPosition)\n\n      dirLight.position.copy(sunPosition)\n      dirLight.position.normalize()\n      dirLight.position.multiplyScalar(2000.0)\n    }\n\n    const folder = gui.addFolder('Sun, sky and ocean')\n    folder.add(effectController, 'turbidity', 1.0, 20.0, 0.1).onChange(guiChanged)\n    folder.add(effectController, 'rayleigh', 0.0, 4, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'mieCoefficient', 0.0, 0.1, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'mieDirectionalG', 0.0, 1, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'luminance', 0.0, 2).onChange(guiChanged)\n    folder.add(effectController, 'inclination', 0, 1, 0.0001).onChange(guiChanged)\n    folder.add(effectController, 'azimuth', 0, 1, 0.0001).onChange(guiChanged)\n    folder.add(effectController, 'sun').onChange(guiChanged)\n\n    guiChanged()\n  }\n\n  return sky\n}\n\nexport {initSky}\n","import PubSub from '../events'\n\nconst WindowResize = function (renderer, camera, dimension) {\n  dimension = dimension || function () { return { width: window.innerWidth, height: window.innerHeight } }\n  var callback = function () {\n        // fetch target renderer size\n    var rendererSize = dimension()\n        // notify the renderer of the size change\n    renderer.setSize(rendererSize.width, rendererSize.height)\n        // update the camera\n    camera.aspect = rendererSize.width / rendererSize.height\n    camera.updateProjectionMatrix()\n\n    PubSub.publish('x.screen.resized', rendererSize)\n  }\n    // bind the resize event\n  window.addEventListener('resize', callback, false)\n    // return .stop() the function to stop watching window resize\n  return {\n    trigger: function () {\n      callback()\n    },\n        /**\n         * Stop watching window resize\n        */\n    destroy: function () {\n      window.removeEventListener('resize', callback)\n    }\n  }\n}\n\nexport {WindowResize}\n"],"sourceRoot":""}