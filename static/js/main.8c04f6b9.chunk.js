(this.webpackJsonp=this.webpackJsonp||[]).push([[0],Array(38).concat([function(e,n,t){e.exports=t.p+"static/media/Rock_08_UV_H_CM_1.da494a88.jpg"},function(e,n,t){e.exports=t.p+"static/media/Rock_08_UV_H_CM_1_normal.6085c2f7.jpg"},function(e,n,t){e.exports=t.p+"static/media/GrassGreenTexture_1024.3f1df3f0.jpg"},function(e,n,t){e.exports=t.p+"static/media/GrassGreenTexture_1024_normal.ce43156e.jpg"},,,,,,,,,,,,,,,,function(e,n,t){e.exports=t.p+"static/media/Water_1_M_Normal.a33d50da.jpg"},function(e,n,t){e.exports=t.p+"static/media/Water_2_M_Normal.639428cf.jpg"},,,,,function(e,n,t){e.exports=function(){return new Worker(t.p+"terrain.worker.bfcda43c.js")}},function(e,n){e.exports="#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\nvarying vec3 vNormal2;\nvarying float flatness;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t// #include <worldpos_vertex>\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\tvNormal2 = normalize(normal);\n\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\n  vWorldPosition = position;\n}\n"},function(e,n){e.exports="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <envmap_physical_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, sampler2D normalMap) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\n\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\n\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\n\n\t#include <logdepthbuf_fragment>\n\n\t// #include <map_fragment>\n\tvec4 texelColorXY = texture2D( map, vUvXY );\n\tvec4 texelColorXZ = texture2D( map, vUvXZ );\n\tvec4 texelColorYZ = texture2D( map, vUvYZ );\n\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n\tvec4 texelColor = (\n\t\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\n\t\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\n\t\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\n\t);\n\t// texelColor = texelColorXY;\n\n\t// texelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\t// return diffuseColor;\n\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t// #include <normal_fragment_maps>\n\tnormal = perturbNormal2Arb( -vViewPosition, normal, normalMap);\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.6, 0.7, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t#include <fog_fragment>\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// gl_FragColor = vec4(normal, 1.0);\n\n}\n"},function(e,n){e.exports="#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\nvarying vec3 vNormal2;\nvarying float flatness;\nvarying vec3 vWorldPosition;\nvarying vec2 vNoise;\n\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\n\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nvec4 fade(vec4 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\nfloat cnoise(vec4 P){\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t// transformed = floor(transformed);\n\n\t// #include <worldpos_vertex>\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\tvNormal2 = normalize(normal);\n\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\n\tvWorldPosition = position;\n\t// uvnoise = vec2(\n\t// \t// (sin((position.x + position.y + position.z) + / 30.0)) * 0.3333332,\n\n\t// \t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332,\n\t// \t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332\n\n\t// \t// mod((position.x + position.y + position.z), 10.0) / 10.0,\n\t// \t// mod((position.x + position.y + position.z), 10.0) / 10.0\n\n\t// \t// mod(mod(position.x, 1.0) + position.z, 1.0),\n\t// \t// mod(mod(position.y, 1.0) + position.z, 1.0)\n\n\t// \t// mod(position.x + 0.5 * cnoise(vec4(position, 1.0)), 10.0) / 10.0,\n\t// \t// mod(position.y + 0.5 * cnoise(vec4(position.zyx, 1.0)), 10.0) / 10.0\n\n  vNoise = vec2(\n    noise(position / 50.0),\n    noise(position.zyx / 50.0)\n  );\n\n\t// \t// cos(position / 5.0) * 0.5 + 0.5,\n\t// \t// cos(position.zyx / 5.0) * 0.5 + 0.5\n\n\t// \t// noise(position.xyz) * mod(position.z, 10.0) / 10.0,\n\t// \t// noise(position.zyx) * mod(position.z, 10.0) / 10.0\n\t// );\n\t// vUv = uvnoise;\n\n\t// vec2 vUvXY = vec2(mod(position.x, 100.0) / 100.0, mod(position.y, 100.0) / 100.0 );\n\t// vec2 vUvXZ = vec2(mod(position.x, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\n\t// vec2 vUvYZ = vec2(mod(position.y, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\n\n\t// vec3 mixer = clamp(abs(normal), 0.0000001, 1.0);\n\t// vec2 zero2 = vec2(0.0, 0.0);\n\t// vUv = (\n\t// \tmix(zero2, vUvXY, pow(mixer.z, 2.5)) +\n\t// \tmix(zero2, vUvXZ, pow(mixer.y, 2.5)) +\n\t// \tmix(zero2, vUvYZ, pow(mixer.x, 2.5))\n\t// );\n}\n"},function(e,n){e.exports="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec2 vNoise;\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <envmap_physical_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 vUv1, vec2 vUv2, vec2 vUv3) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN1 = texture2D( normalMap, vUv1 ).xyz;\n\t\tvec3 mapN2 = texture2D( normalMap, vUv2 ).xyz;\n\t\tvec3 mapN3 = texture2D( normalMap, vUv3 ).xyz;\n\t\tvec3 black = vec3(0.0, 0.0, 0.0);\n\t\tvec3 mapN = (\n\t\t\tmix(black, mapN1, pow(N.z, 2.5)) +\n\t\t\tmix(black, mapN2, pow(N.y, 2.5)) +\n\t\t\tmix(black, mapN3, pow(N.x, 2.5))\n\t\t);\n\t\t// return mapN;\n\t\tmapN = mapN * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\n\t// return vec4(vUv, 0.0, 1.0);\n\t// return vec4(clamp(vNormal2.z, 0.0, 1.0), 0.0, 0.0, 1.0);\n\t// return vec4(cos(vWorldPosition.xyz / 5.0) * 0.5 + 0.5, 1.0);\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\n\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\n\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\n\n\t#include <logdepthbuf_fragment>\n\n\t// #include <map_fragment>\n\tvec4 texelColorXY = texture2D( map, vUvXY );\n\tvec4 texelColorXZ = texture2D( map, vUvXZ );\n\tvec4 texelColorYZ = texture2D( map, vUvYZ );\n\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n\tvec4 texelColor = (\n\t\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\n\t\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\n\t\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\n\t);\n\t// texelColor = texelColorXY;\n\n\t// texelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\t// return diffuseColor;\n\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t// #include <normal_fragment_maps>\n\t// normal = perturbNormal2Arb( -vViewPosition, normal , vUvXY, vUvXZ, vUvYZ);\n\t// return vec4(normal, 1.0);\n\t// #include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t// #include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.15, 0.3, flatness * vNoise.x + flatness * vNoise.y)\n\t\t// smoothstep(vNoise.x, vNoise.y, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t#include <fog_fragment>\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// gl_FragColor = vec4(flatness, flatness, flatness, 1.0);\n\n}\n"},function(e,n,t){e.exports=function(){return new Worker(t.p+"voxel.worker.3a17e1f3.js")}},,,,,function(e,n){e.exports="#include <common>\n#include <fog_pars_fragment>\n\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nuniform sampler2D tReflectionMap;\nuniform sampler2D tRefractionMap;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\nuniform sampler2D tDepth;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float surface;\nuniform vec4 config;\nuniform mat4 clipToWorldMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvec3 surfaceColor = vec3(0.0078, 0.5176, 0.7);\nvec3 shoreColor = vec3(0.0078, 0.5176, 0.7);\nvec3 depthColor = vec3(0.0039, 0.00196, 0.145);\n// Description : Water color based on water depth and color extinction\n//\n// based on Rendering Water as a Post-process Effect by Wojciech Toman\n//\n\n// waterTransparency - x = , y = water visibility along eye vector,\n// waterDepthValues - x = water depth in world space, y = view/accumulated water depth in world space\nvec3 DepthRefraction(float waterDepth, float viewWaterDepth, vec3 refractionColor)\n{\n  float waterClarity = 0.75;\n  float visibility = 200.;\n  float shoreRange = 50.;\n  float horizontalExtinction = 200.;\n\n  float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\n  float accDepthExp = saturate(accDepth / (2.5 * visibility));\n  accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\n\n  surfaceColor = mix(shoreColor, surfaceColor, saturate(waterDepth / shoreRange));\n  vec3 waterColor = mix(surfaceColor, depthColor, saturate(waterDepth / horizontalExtinction));\n\n  refractionColor = mix(refractionColor, surfaceColor * waterColor, saturate(accDepth / visibility));\n  refractionColor = mix(refractionColor, depthColor, accDepthExp);\n  refractionColor = mix(refractionColor, depthColor * waterColor, saturate(waterDepth / horizontalExtinction));\n  return refractionColor;\n}\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  vec3 toEye = normalize( vToEye );\n  vec3 surfacePosition = cameraPosition - vToEye;\n\n  // determine flow direction\n  vec2 flow;\n  #ifdef USE_FLOWMAP\n  flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n  #else\n  flow = flowDirection;\n  #endif\n  flow.x *= - 1.0;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n  vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n  // linear interpolate to get the final normal color\n  float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  //  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, normalColor.b ));\n\n  // calculate the fresnel term to blend reflection and refraction maps\n  float theta = max( dot( toEye, normal ), 0.0 );\n  float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n  // calculate final uv coords\n  vec3 coord = vCoord.xyz / vCoord.w;\n  vec2 uv = coord.xy + coord.z * normal.xy * 0.1;\n\n  vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n  vec4 refractColor = texture2D( tRefractionMap, uv );\n\n  // water depth\n\n  float zOverW = texture2D(tDepth, uv).x;\n  // clipPosition is the viewport position at this pixel in the range -1 to 1.\n  vec4 clipPosition = vec4(coord.xy * 2. - 1., zOverW * 2. - 1., 1.);\n  vec4 worldPosition = clipToWorldMatrix * clipPosition;\n  worldPosition /= worldPosition.w;\n\n  float waterDepth = surfacePosition.z - worldPosition.z;\n  float viewWaterDepth = length(surfacePosition - worldPosition.xyz);\n\n  float depthDensity = 0.01;\n  float depthFactor = whiteCompliment( exp2( - depthDensity * depthDensity * viewWaterDepth * viewWaterDepth * 1.442695 ) );\n  refractColor.rgb = mix( refractColor.rgb, depthColor, 0.25 + depthFactor );\n  // refractColor.rgb = DepthRefraction(waterDepth, viewWaterDepth, refractColor.rgb);\n\n  // multiply water color with the mix of both textures\n  gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n  // gl_FragColor = refractColor;\n  // gl_FragColor = vec4(vec3(waterDepth/500.), 1.0);\n\n  // #include <tonemapping_fragment>\n  // #include <encodings_fragment>\n  // #include <fog_fragment>\n\n}"},function(e,n){e.exports="#include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\n  vUv = uv;\n  vCoord = textureMatrix * vec4( position, 1.0 );\n\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n  vToEye = cameraPosition - worldPosition.xyz;\n\n  vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n  gl_Position = projectionMatrix * mvPosition;\n\n  #include <fog_vertex>\n\n}"},function(e,n){e.exports="#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform sampler2D tReflectionMap;\nuniform sampler2D tReflectionDepth;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float time;\nuniform float waterLevel;\nuniform vec4 config;\nuniform vec3 sunPosition;\nuniform mat4 clipToWorldMatrix;\nuniform mat4 worldToClipMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\n// vec3 depthColor = vec3(0.0039, 0.00196, 0.145);\nvec3 depthColor = vec3(0.0117, 0.0117, 0.325);\n\n#define LOG2 1.442695\n#define TAU 6.28318530718\n#define MAX_ITER 5\nvec3 caustic(vec2 uv) {\n  vec2 p = mod(uv*TAU, TAU)-250.0;\n\n  vec2 i = vec2(p);\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER; n++) {\n    float t = time * (1.0 - (3.5 / float(n+1)));\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n  }\n\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, 1.4);\n  vec3 color = vec3(pow(abs(c), 8.0));\n  // color = clamp(color + vec3(0.0, 0.35, 0.5), 0.0, 1.0);\n  color = mix(color, vec3(1.0,1.0,1.0),0.5);\n\n  return color;\n}\n\nfloat causticX(float x, float power, float gtime) {\n  float p = mod(x*TAU, TAU)-250.0;\n\n  float i = p;;\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER/2; n++) {\n    float t = gtime * (1.0 - (3.5 / float(n+1)));\n    i = p + cos(t - i) + sin(t + i);\n    c += 1.0/length(p / (sin(i+t)/inten));\n  }\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, power);\n\n  return c;\n}\n\nfloat GodRays(vec2 uv) {\n  float light = 0.0;\n  vec4 uvSun = worldToClipMatrix * vec4(sunPosition, 1.);\n  uvSun /= uvSun.w;\n  uvSun = uvSun / 2. + 0.5;\n  vec2 uv2 = vec2(\n    dot(normalize(uv - uvSun.xy), vec2(1., 0.)),\n    length(uv - uvSun.xy)\n  );\n\n  light += pow(causticX((uv2.x + 0.08 * uv2.y) / 1.7 + 0.5, 1.8, time * 0.65), 10.0) * 0.05;\n  light += pow(causticX(sin(uv2.x), 0.3, time * 0.7), 9.0) * 0.4;\n  light += pow(causticX(cos(uv2.x * 2.3), 0.3, time * 1.3), 4.0) * 0.1;\n\n  light *= smoothstep(0., .3, uv2.y) * smoothstep(0., .3, uv2.y);\n  light = clamp(light, 0.0, 1.0);\n\n  return light;\n}\n\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\nfloat hash11(float p)\n{\n  vec3 p3  = fract(vec3(p) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\nvec3 hash33(vec3 p3)\n{\n  p3 = fract(p3 * HASHSCALE3);\n    p3 += dot(p3, p3.yxz+19.19);\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\n}\n\nconst int   STAR_VOXEL_STEPS = 8;\nconst float STAR_VOXEL_STEP_SIZE = 3.;\n\nfloat distanceRayPoint(vec3 ro, vec3 rd, vec3 p, out float h) {\n    h = dot(p - ro, rd);\n    return length(p - ro - rd * h);\n}\nvec3 getDotColour(float t)\n{\n  return vec3(t*.57,t*.3,t*.05);\n  return vec3(t*.9,t*.9,t*.9);\n  return vec3(t*.3,t*.6,t*.5);\n}\n\n// This code is the starfield stuff from iapafoto\n// https://www.shadertoy.com/view/Xl2BRR\nvec4 detritus(in vec3 ro, in vec3 rd, in float tmax) {\n\n  float d =  0.;\n\n  vec3 ros = ro + rd*d;\n  ros /= STAR_VOXEL_STEP_SIZE;\n  vec3 pos = floor(ros),\n       mm, ri = 1./rd,\n       rs = sign(rd),\n       dis = (pos - ros + 0.5 + rs * 0.5) * ri;\n\n  float dint;\n  vec3 offset, id;\n  vec4 col = vec4(0);\n  vec4 sum = vec4(0);\n\n  for(int i = 0; i < STAR_VOXEL_STEPS; i++) {\n    id = hash33(pos);\n    float size  = hash11(float(i))*.02 + .005;\n    offset = clamp(id + .2 * cos(id + id.x * time), size, 1. - size);\n    d = distanceRayPoint(ros, rd, pos + offset, dint);\n\n    if (dint > 0. && dint * STAR_VOXEL_STEP_SIZE < tmax) {\n      col = vec4(getDotColour(id.x), .8) * smoothstep(size, 0.0, d);\n      col.a *= smoothstep(float(STAR_VOXEL_STEPS), 0., dint);\n      col.rgb *= col.a / dint;\n      sum += (1. - sum.a) * col;\n      if (sum.a>.99) break;\n    }\n\n    mm = step(dis.xyz, dis.yxy) * step(dis.xyz, dis.zzx);\n    dis += mm * rs * ri;\n    pos += mm * rs;\n  }\n\n  return sum * .75;\n}\n\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  float depth = texture2D(tDepth, vUv).x;\n  float w;\n  // float logDepthBufFC = 2.0 / log2( 1000000. + 1.0 );\n  // float w = pow(2.0, (2. * depth / logDepthBufFC)) - 1.0;\n  // depth = viewZToPerspectiveDepth(-w, 1., 1000000.);\n\n  vec4 world = clipToWorldMatrix * vec4(vUv * 2. - 1., depth * 2. - 1., 1.0);\n  world /= world.w;\n  float worldDistance = length(world.xyz - cameraPosition);\n\n  vec3 dir = normalize(world.xyz - cameraPosition);\n  vec3 hitPoint = linePlaneIntersect(cameraPosition, dir, vec3(0., 0., waterLevel), vec3(0., 0., -1.));\n  float hitDirection = dot(hitPoint - cameraPosition, dir);\n  float hitDistance = hitDirection > 0. ? length(hitPoint - cameraPosition) : 1e7;\n\n  float dist = min(hitDistance, worldDistance);\n  float fogDensity = 0.007;\n  float fogFactor;\n  vec3 nearestPoint = dist == hitDistance ? hitPoint : world.xyz;\n  float waterDepth = waterLevel - nearestPoint.z;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec2 nUV = fract(hitPoint.xy / 15.);\n  vec2 flow = vec2(1., 1.);\n  vec4 normalColor0 = texture2D( tNormalMap0, nUV + flow * time / 10.);\n  vec4 normalColor1 = texture2D( tNormalMap1, nUV + flow * time / 10.);\n\n  // linear interpolate to get the final normal color\n  float flowLerp = sin(time) / 2. + 0.5;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, -normalColor.b ));\n  vec3 waterNormal = normalize(normal);\n  vec4 coord = worldToClipMatrix * vec4(hitPoint.xy + waterNormal.xy * waterNormal.z * 3., hitPoint.z, 1.0);\n  coord /= coord.w;\n  coord = coord / 2.0 + 0.5;\n  // coord.xy = vUv;\n\n  if (worldDistance < hitDistance) {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n    gl_FragColor.rgb *= caustic(nearestPoint.xy / 10.);\n  } else {\n\n    // calculate the fresnel term to blend reflection and refraction maps\n    float theta = max( dot( -dir, waterNormal ), 0.0 );\n    float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n    reflectance = (1. - length(refract(dir, waterNormal, 1.33))) * reflectance;\n    reflectance = clamp(reflectance, 0.15, 0.85);\n\n    vec4 reflectColor = texture2D( tReflectionMap, vec2(1. - coord.x, coord.y) );\n    vec4 reflectDepth = texture2D( tReflectionDepth, vec2(1.0 - coord.x, coord.y) );\n    vec4 refractColor = texture2D( tDiffuse, coord.xy );\n\n    // w = pow(2.0, (2. * reflectDepth.x / logDepthBufFC)) - 1.0;\n    // w = -perspectiveDepthToViewZ(reflectDepth.x, 1., 1000000.);\n    // reflectDepth.x = viewZToPerspectiveDepth(-w, 1., 1000000.);\n    w = 500. * reflectDepth.x + dist;\n\n    fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * w * w * LOG2 ) );\n    reflectColor.rgb = mix(reflectColor.rgb, depthColor, fogFactor);\n\n    // multiply water color with the mix of both textures\n    gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n    // gl_FragColor = vec4(vec3(reflectance), 1.0);\n    // gl_FragColor = reflectColor;\n    // gl_FragColor = reflectDepth;\n    // gl_FragColor = vec4(vec3(w/500.), 1.0);\n    // gl_FragColor = vec4(vec3(w/100.), 1.0);\n\n}\n\n// float fogDepth = dist + waterDepth * min(1., waterDepth / 100.);\nfloat fogDepth = dist + clamp(waterLevel - cameraPosition.z, 0., 100.);\nfogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\ngl_FragColor.rgb = mix(gl_FragColor.rgb, depthColor, fogFactor);\n\ngl_FragColor.rgb += GodRays(vUv) * (1. - smoothstep(0., 100., waterLevel - cameraPosition.z));\n\nvec4 star = detritus(cameraPosition, dir,  min(40., dist / STAR_VOXEL_STEP_SIZE));\ngl_FragColor.rgb = gl_FragColor.rgb * (1.0 - star.a)+star.rgb;\n\n\n// gl_FragColor = texture2D(tReflectionMap, vec2(1.0 - vUv.x, vUv.y));\n// gl_FragColor = vec4(dir, 1.);\n// gl_FragColor = vec4( vec3(dist /1000.), 1.0 );\n// gl_FragColor = vec4( vec3(hitDistance/100.), 1.0 );\n// gl_FragColor = vec4( vec3(dist/100.), 1.0 );\n\n}"},function(e,n){e.exports=" #include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\nvUv = uv;\nvCoord = textureMatrix * vec4( position, 1.0 );\n\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvToEye = cameraPosition - worldPosition.xyz;\n\nvec4 mvPosition = viewMatrix * worldPosition; // used in fog_vertex\ngl_Position = projectionMatrix * mvPosition;\n\n#include <fog_vertex>\n\n}"},function(e,n,t){e.exports=t(115)},function(e,n,t){},,,,function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Qzk3MDg1MDY1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Qzk3MDg1MDc1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOTcwODUwNDUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOTcwODUwNTUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Po4pkJAAAA9KSURBVHja7F0JdqMw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"},function(e,n,t){"use strict";t.r(n);var o=t(0);t.d(n,"BufferAttribute",(function(){return o.n})),t.d(n,"REVISION",(function(){return o.Bb})),t.d(n,"ShaderChunk",(function(){return o.Ib})),t.d(n,"Vector2",(function(){return o.Yb})),t.d(n,"Vector3",(function(){return o.Zb})),t.d(n,"Vector4",(function(){return o.ac})),t.d(n,"Color",(function(){return o.s})),t.d(n,"Texture",(function(){return o.Sb})),t.d(n,"Math",(function(){return o.Y})),t.d(n,"AdditiveBlending",(function(){return o.b})),t.d(n,"ShaderMaterial",(function(){return o.Jb})),t.d(n,"BufferGeometry",(function(){return o.o})),t.d(n,"Points",(function(){return o.vb})),t.d(n,"StaticDrawUsage",(function(){return o.Qb})),t.d(n,"DynamicDrawUsage",(function(){return o.x}))},,,,,,,function(e,n,t){e.exports=t.p+"static/media/Explosion_002_Tile_8x8_256x256.d28fc70f.png"},function(e,n,t){e.exports=t.p+"static/media/smokeparticle.4939a8d2.png"},function(e,n){e.exports="data:image/png;base64,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"},function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gIBEhghhPTbNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABF0lEQVQ4y62TsU7DQBBE39opHKS4AuUrkjKlC/qUlPxcSij5A5cuyVdYSZVIGCGZoRlLF8sBJDjpdNZ6Zm92bzaYWJKW/hzOFiAi2jE2JshroAJWwNzhDtgDdUS8XiSQFBEh37oBHnzeAYVx78ABaIBnoBnUzJJkG+ARuAdKIE8UFsACuE2SvgySQ9Ja0k7SUVIv6fPK7o3ZuVRmblRlBWVy67g/cqw0tpLUZv6xcs35teYmsdzYFUBmBXPXNkWcSlSYs8z448psks5PpV9wZGwHtIOCvd+5T0BTRIw5mENmQ9Q2ySkBarSH2MnY+sLakraSnvzOHyM/9I4djdkOvNSJTWLbH638f8P0zTgvgBuH3oDz1Dh/AWVJt7banagAAAAAAElFTkSuQmCC"},,function(e,n){},,function(e,n){},,,,,,,,,,function(e,n,t){e.exports=t.p+"static/media/impact1.db06d2c4.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact2.7d720129.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact3.7a5b4e82.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact4.43348926.ogg"},function(e,n,t){e.exports=t.p+"static/media/gatling.b8ff47f4.ogg"},function(e,n,t){e.exports=t.p+"static/media/missile.f0faf674.ogg"},function(e,n,t){e.exports=t.p+"static/media/explosion1.2f1ab236.ogg"},function(e,n,t){e.exports=t.p+"static/media/explosion2.752472e3.ogg"},function(e,n,t){"use strict";t.r(n),t.d(n,"renderer",(function(){return Et})),t.d(n,"scene",(function(){return _t})),t.d(n,"camera",(function(){return kt})),t.d(n,"drone",(function(){return Nt})),t.d(n,"sunPosition",(function(){return Zt})),t.d(n,"gui",(function(){return Tt})),t.d(n,"options",(function(){return St})),t.d(n,"loops",(function(){return Ht}));t(78);var o=t(0),a=t(60),i=t.n(a),r=t(61),l=t.n(r),s=t(18),c=t.n(s),u=t(62),d=t.n(u).a,v=function e(){var n=e.SkyShader,t=new o.Jb({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o.Xb.clone(n.uniforms),side:o.h});o.cb.call(this,new o.Nb(1,32,15),t)};v.prototype=Object.create(o.cb.prototype),v.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new o.Zb}},vertexShader:"\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.z / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n        // extinction (absorbtion + out scattering)\n        // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n        // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }\n    ",fragmentShader:"\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float luminance;\n        uniform float mieDirectionalG;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at\n                                    // 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        // Filmic ToneMapping http://filmicgames.com/archives/75\n        const float A = 0.15;\n        const float B = 0.50;\n        const float C = 0.10;\n        const float D = 0.20;\n        const float E = 0.02;\n        const float F = 0.30;\n\n        const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\n        vec3 Uncharted2Tonemap( vec3 x ) {\n        return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n        }\n\n\n        void main() {\n        // optical length\n        // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n        // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n        // in scattering\n        float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n        // nightsky\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n        // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n        vec3 color = curr * whiteScale;\n\n        vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n        }"};var p=new o.v(16777215,4);window.dirLight=p;var m=new o.E(16777147,526368,.1);m.position.set(0,0,1),m.up.set(0,0,1),m.needsUpdate=!0;var f=new o.c(4210752,2.5),g=function(){p.position.copy(p.sunPosition),p.position.normalize(),p.position.multiplyScalar(1600),p.position.add(Nt.position)};var h=t(8),w=t(63),y=t.n(w),x=t(3),b=t(64),A=t.n(b),C=t(65),D=t.n(C),P=(new o.Tb).setCrossOrigin("anonymous"),z=P.load(t(38)),M=P.load(t(39)),S=P.load(t(40)),_=P.load(t(41));z.wrapS=z.wrapT=o.Gb,z.offset.set(0,0),z.repeat.set(20,20),M.wrapS=M.wrapT=o.Gb,S.wrapS=S.wrapT=o.Gb,_.wrapS=_.wrapT=o.Gb;var k,E,T=function(e,n){var t=new o.Jb({uniforms:Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)({roughness:{value:.7},metalness:{value:0}},o.Wb.common),o.Wb.lights),o.Wb.envmap),o.Wb.normalmap),o.Wb.fog),{},{rockTexture:{value:z},rockTextureNormal:{value:M}},n),defines:{STANDARD:"",USE_MAP:"",USE_UV:"",USE_NORMALMAP:""},vertexShader:A.a,fragmentShader:D.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return t.uniforms.map.value=S,t.uniforms.normalMap.value=_,t.roughness=.7,t.metalness=0,t.isShaderMaterial=!1,t.isMeshStandardMaterial=!0,t.uniforms.uvTransform.value=(new o.ab).multiplyScalar(20),t.needsUpdate=!0,t}(),U=45.8671,R={x:(k=7.3087,E=10,(k+180)/360*Math.pow(2,E)),y:function(e,n){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n)}(U,10)};window.chamonix=R;for(var N=function(e,n){var t=n.split(",").map((function(e){return parseInt(e,10)})),o=t[0],a=t[1],i=t[2],r=t[5],l=function(e){return{x:R.x/Math.pow(2,10-e),y:R.y/Math.pow(2,10-e)}}(o);e.position.set(a*r-(l.x%1-.5)*r-800*(1-R.x%1),-i*r+(l.y%1-.5)*r+800*(1-R.y%1),0)},F=function(e){if(e.data.stats)return n=e.data,_t.userData.wasm=(_t.userData.wasm||0)+n.wasm,_t.userData.js=(_t.userData.js||0)+n.js,void console.log(n.wasm,n.js,_t.userData);var n,t=new o.o,a=new Float32Array(e.data.positions),i=new Float32Array(e.data.normals),r=new Float32Array(e.data.uvs),l=new(0,{2:Uint16Array,4:Uint32Array}[e.data.bpe.indices])(e.data.indices);t.setAttribute("position",new o.n(a,3)),t.setAttribute("normal",new o.n(i,3)),t.setAttribute("uv",new o.n(r,2)),t.setIndex(new o.n(l,1)),t.computeBoundingSphere(),t.computeBoundingBox();var s=new o.cb(t,T);s.key=e.data.key,s.name="terrainTile",s.castShadow=!0,s.receiveShadow=!0,s.layers.enable(3),N(s,e.data.key),_t.add(s),Et.shadowMap.needsUpdate=!0},Z=[],I=navigator.hardwareConcurrency-1||3,L=0;L<I;L++){var W=new y.a;W.onmessage=F,Z.push(W)}var j=0;Z.postMessage=function(e){Z[j].postMessage(e),j=j===I-1?0:j+1};var O=function(e,n,t,o,a,i){Z.postMessage([e,n,t,o,a,i])},B=new o.Zb(0,0,0),V=[];window.tiles={},window.pngs={};var G=function(e){_t.remove(e),e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null},H=new o.Zb,Y=function(e){var n=kt.position;H=kt.getWorldDirection(H);var t=n.clone();if(t=t.add(H.multiplyScalar(400*Math.max(1,Math.abs(n.z)/400))),Nt.position.set(t.x,t.y,200),p.updatePosition(),n.distanceTo(B)>10){B=n.clone();var a,i=Math.min(7,Math.floor(Math.sqrt(Math.abs(n.z))/28)),r=10-i,l=800*Math.pow(2,i),s=Math.round(t.x/l),c=-Math.round(t.y/l),u=(n.z,127),d=n.z>2e3?31:63,v=3*l,m=new o.Zb,f=new o.Zb,g=new o.Zb,w=[[r,s-2,c-2,15,0,l],[r,s-2,c-1,15,0,l],[r,s-2,c-0,15,0,l],[r,s-2,c+1,15,0,l],[r,s-2,c+2,15,0,l],[r,s-2,c+3,15,0,l],[r,s+3,c-2,15,0,l],[r,s+3,c-1,15,0,l],[r,s+3,c-0,15,0,l],[r,s+3,c+1,15,0,l],[r,s+3,c+2,15,0,l],[r,s+3,c+3,15,0,l],[r,s-1,c-2,15,0,l],[r,s-1,c+3,15,0,l],[r,s,c-2,15,0,l],[r,s,c+3,15,0,l],[r,s+1,c-2,15,0,l],[r,s+1,c+3,15,0,l],[r,s+2,c-2,15,0,l],[r,s+2,c+3,15,0,l],[r,s-1,c-1,d,0,l],[r,s-1,c-0,d,0,l],[r,s-1,c+1,d,0,l],[r,s-1,c+2,d,0,l],[r,s+2,c-1,d,0,l],[r,s+2,c-0,d,0,l],[r,s+2,c+1,d,0,l],[r,s+2,c+2,d,0,l],[r,s,c-1,d,0,l],[r,s,c+2,d,0,l],[r,s+1,c-1,d,0,l],[r,s+1,c+2,d,0,l],[r,s,c,u,0,l],[r,s,c+1,u,0,l],[r,s+1,c,u,0,l],[r,s+1,c+1,u,0,l]],y=w.map((function(e){return e.toString()})),x=V.map((function(e){return e.toString()})),b=y.slice(-5),A=_t.children.filter((function(e){return b.includes(e.key)})),C=function(e){return m.subVectors(e.position,kt.position).length()};A.sort((function(e,n){return C(e)-C(n)})),kt.userData.terrainKeysUnder=b,kt.userData.terrainTileUnder=A[0];var D=y.filter((function(e){return x.indexOf(e)<0})),P=_t.children.filter((function(e){return e.key})).map((function(e){return e.key}));D.forEach((function(e){if(!P.includes(e)){var n=e.split(",").map((function(e){return parseInt(e,10)}));O.apply(void 0,Object(h.a)(n))}}));var z=[];_t.children.filter((function(e){return e.key})).forEach((function(e){a=m.subVectors(g.set(e.position.x,e.position.y,0),f.set(kt.position.x,kt.position.y,0)).length(),e.userData.distanceToCamera=a,a<v&&y.includes(e.key)?e.visible=!0:z.push(e)})),window.setTimeout((function(){z.forEach((function(e){e.visible=!1}))}),750),_t.children.filter((function(e){return e.key})).sort((function(e,n){return e.userData.distanceToCamera-n.userData.distanceToCamera})).slice(128).forEach((function(e){e.markedForDeletion||(window.setTimeout((function(){return G(e)}),750),e.markedForDeletion=!0)})),V=w.slice(0)}};Y.clean=function(){_t.children.filter((function(e){return"terrainTile"===e.name})).forEach((function(e){return G(e)})),V=[],B=new o.Zb(0,0,0)};var Q=t(66),X=t.n(Q),q=t(67),K=t.n(q),J=(new o.Tb).setCrossOrigin("anonymous"),$=J.load(t(38)),ee=J.load(t(39)),ne=J.load(t(40)),te=J.load(t(41));$.wrapS=$.wrapT=o.ib,$.offset.set(0,0),$.repeat.set(20,20),ee.wrapS=ee.wrapT=o.ib,ne.wrapS=ne.wrapT=o.ib,te.wrapS=te.wrapT=o.ib;var oe=0,ae=0,ie=-175,re=t(68),le=t.n(re),se=function(e,n){var t=new o.Jb({uniforms:Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)(Object(x.a)({roughness:{value:.7},metalness:{value:0}},o.Wb.common),o.Wb.lights),o.Wb.envmap),o.Wb.normalmap),o.Wb.fog),{},{rockTexture:{value:$},rockTextureNormal:{value:ee}},n),defines:{STANDARD:"",USE_MAP:"",USE_UV:"",USE_NORMALMAP:""},vertexShader:X.a,fragmentShader:K.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return t.uniforms.map.value=ne,t.uniforms.normalMap.value=te,t.roughness=.7,t.metalness=0,t.normalScale=new o.Yb(1,1),t.isShaderMaterial=!1,t.isMeshStandardMaterial=!0,t.uniforms.uvTransform.value=(new o.ab).multiplyScalar(20),t.needsUpdate=!0,t}(),ce=new Set;window.emptyKeys=ce;for(var ue=function(e){var n=[e.data.i,e.data.j,e.data.k];if(e.data.hasGeometry){var t=new Float32Array(e.data.pos1),a=new Float32Array(e.data.normals1),i=new Uint16Array(e.data.index1),r=new o.o;r.setAttribute("position",new o.n(t,3)),r.setAttribute("normal",new o.n(a,3)),r.setIndex(new o.n(i,1));var l=new o.cb(r,se);l.position.set(500*e.data.i+oe,500*e.data.j+ae,500*e.data.k+ie),l.userData.key=n;var s=new o.m(l,16776960);l.name="terrainVoxel",s.name="terrainVoxelHelper",l.layers.enable(3),s.layers.enable(3),_t.add(s),_t.add(l)}else ce.add(n.toString())},de=[],ve=navigator.hardwareConcurrency-1||3,pe=0;pe<ve;pe++){var me=new le.a;me.onmessage=ue,de.push(me)}var fe=0;de.postMessage=function(e){de[fe].postMessage(e),fe=fe===ve-1?0:fe+1};var ge,he=function(e,n,t){de.postMessage([e,n,t,2])},we=new o.Zb(0,0,0),ye=[];window.currentKeys=ye;var xe=function(e){var n=kt.position;if(n.distanceTo(we)>10){we=n.clone();var t=Math.floor(n.x/500+.5),a=Math.floor(n.y/500+.5);console.log("camera centered on tile ",t,a);var i=[];(new o.C).setFromProjectionMatrix((new o.bb).multiplyMatrices(kt.projectionMatrix,kt.matrixWorldInverse));for(var r=0;r<3;r++)for(var l=0;l<3;l++)for(var s=0;s<2;s++)i.push([r-Math.floor(1)+t,l-Math.floor(1)+a,s]);i.forEach((function(e){ge=e.toString(),ce.has(ge)||ye.includes(ge)||(ye.push(ge),console.log("build",e),he.apply(void 0,Object(h.a)(e)))}));var c,u=new o.Zb,d=new o.Zb,v=new o.Zb;_t.children.filter((function(e){return e.userData.key})).forEach((function(e){c=u.subVectors(d.set(kt.position.x,kt.position.y,0),v.set(e.position.x,e.position.y,0)).length();var n=500*Math.ceil(1.5)*1.1;e.visible=c<n}))}};xe.clean=function(){_t.children.filter((function(e){return["terrainVoxel","terrainVoxelHelper"].includes(e.name)})).forEach((function(e){return function(e){_t.remove(e),e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null}(e)})),ye=[],we=new o.Zb(0,0,0)};var be=t(15),Ae=[Y,xe],Ce=0;be.a.bind("t",(function(e){console.log("switch terrain"),Ae[Ce].clean(),Ce=Ce===Ae.length-1?0:Ce+1,console.log("switch terrain done")}));var De=t(42),Pe=(t(43),t(33)),ze=t(20),Me=(t(21),t(44)),Se=(t(45),t(10),t(46),t(47),t(48)),_e=t(22),ke=t(49),Ee=(t(50),t(59)),Te=t(9),Ue=function(e,n,t){Te.b.call(this,e,n),this.initialMask=null,this.appliedMask=t,this.material=new o.db};(Ue.prototype=Te.b.prototype).constructor=Ue;var Re=Ue.prototype.render;Ue.prototype.render=function(e,n,t){this.initialMask=this.camera.layers.mask,this.camera.layers.mask=this.appliedMask,this.scene.overrideMaterial=this.material,Re.call(this,e,n,t),this.scene.overrideMaterial=null,this.camera.layers.mask=this.initialMask};var Ne=(new o.Tb).load(t(82)),Fe=new Pe.a;Fe.addElement(new Pe.b(Ne,60,.6)),Fe.addElement(new Pe.b(Ne,70,.7)),Fe.addElement(new Pe.b(Ne,120,.9)),Fe.addElement(new Pe.b(Ne,70,1));var Ze=Fe,Ie={uniforms:{tDepth:{type:"t",value:null},tColor:{type:"t",value:null},velocityFactor:{type:"f",value:1},delta:{type:"f",value:16.67},clipToWorldMatrix:{type:"m4",value:new o.bb},worldToClipMatrix:{type:"m4",value:new o.bb},previousWorldToClipMatrix:{type:"m4",value:new o.bb},cameraMove:{type:"v3",value:new o.Zb},cameraPosition:{type:"v3",value:new o.Zb}},vertexShader:"\n  varying vec2 vUv;\n\n  void main() {\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n\n  }",fragmentShader:"\n  varying vec2 vUv;\n\n  uniform sampler2D tDepth;\n  uniform sampler2D tColor;\n\n  uniform mat4 clipToWorldMatrix;\n  uniform mat4 worldToClipMatrix;\n  uniform mat4 previousWorldToClipMatrix;\n\n  uniform vec3 cameraMove;\n\n  uniform float velocityFactor;\n  uniform float delta;\n\n  void main() {\n\n    float zOverW = texture2D(tDepth, vUv).x;\n\n    // clipPosition is the viewport position at this pixel in the range -1 to 1.\n    vec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n    vec4 worldPosition = clipToWorldMatrix * clipPosition;\n    worldPosition /= worldPosition.w;\n\n    vec4 previousWorldPosition = worldPosition;\n    previousWorldPosition.xyz -= cameraMove;\n\n    vec4 previousClipPosition = previousWorldToClipMatrix * worldPosition;\n    previousClipPosition /= previousClipPosition.w;\n    vec4 translatedClipPosition = worldToClipMatrix * previousWorldPosition;\n    translatedClipPosition /= translatedClipPosition.w;\n\n    vec2 velocity = velocityFactor * (clipPosition - previousClipPosition).xy / delta * 16.67;\n    velocity *= clamp(length(worldPosition.xyz - cameraPosition) / 1000., 0., 1.);\n    velocity += velocityFactor * (clipPosition - translatedClipPosition).xy / delta * 16.67;\n\n    vec4 finalColor = vec4(0.);\n    vec2 offset = vec2(0.);\n    float weight = 0.;\n    const int samples = 20;\n    for(int i = 0; i < samples; i++) {\n      offset = velocity * (float(i) / (float(samples) - 1.) - .5);\n      finalColor += texture2D(tColor, vUv + offset);\n    }\n    finalColor /= float(samples);\n    gl_FragColor = vec4(finalColor.rgb, 1.);\n\n    // debug: view velocity values\n    // gl_FragColor = vec4(abs(velocity), 0., 1.);\n\n    // debug: view depth buffer\n    // gl_FragColor = vec4(vec3(clamp(length(worldPosition.xyz - cameraPosition) / 1000., 0., 1.)), 1.);\n  }"},Le=(new o.bb,new o.Zb,new o.Zb,{uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","  vec4 tex = texture2D( tDiffuse, vUv );","  gl_FragColor = tex;","}"].join("\n")}),We=t(31),je=t(4),Oe=t.n(je),Be=t(6),Ve=t(7),Ge=t(13),He=t(14),Ye=t(1),Qe=t.n(Ye),Xe=t(69),qe=t.n(Xe),Ke=t(70),Je=t.n(Ke);var $e,en,nn,tn=function(e){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=e.clone(),o=window.innerWidth/2,a=window.innerHeight/2;return t.project(kt),t.x=t.x*o,t.y=-t.y*a,n||(t.x+=o,t.y+=a),t}(e);return{x:Math.min(Math.max(10,n.x),window.innerWidth-10),y:Math.min(Math.max(10,n.y),window.innerHeight-10),z:n.z}},on=function(e,n,t){return Math.min(Math.max(e,n),t)},an=function(e){Object(Ge.a)(t,e);var n=Object(He.a)(t);function t(){return Object(Be.a)(this,t),n.apply(this,arguments)}return Object(Ve.a)(t,[{key:"render",value:function(){return Qe.a.createElement("svg",{x:this.props.x-this.props.size/2,y:this.props.y-this.props.size/2,viewBox:"-10 -10 415 415",width:this.props.size,height:this.props.size},Qe.a.createElement("g",this.props,Qe.a.createElement("circle",{cx:"202.224",cy:"202.228",r:"26.686"}),Qe.a.createElement("path",{d:"M83.807,49.322L50.87,4.891c-9.519-9.527-30.71-3.78-40.236,5.747S-4.64,41.347,4.887,50.874 l44.431,32.937c9.519,9.519,24.963,9.527,34.49,0C93.334,74.284,93.326,58.84,83.807,49.322z"}),Qe.a.createElement("path",{d:"M393.823,10.638c-9.527-9.527-30.71-15.274-40.236-5.747l-32.937,44.431 c-9.527,9.527-9.527,24.963,0,34.49c9.527,9.527,24.963,9.519,34.49,0l44.431-32.937 C409.096,41.347,403.349,20.164,393.823,10.638z"}),Qe.a.createElement("path",{d:"M355.139,320.645c-9.527-9.527-24.963-9.527-34.49,0c-9.527,9.527-9.527,24.963,0,34.49 l32.937,44.431c9.527,9.519,30.71,3.78,40.236-5.747s15.274-30.71,5.747-40.236L355.139,320.645z"}),Qe.a.createElement("path",{d:"M49.318,320.645L4.887,353.582c-9.527,9.527-3.78,30.71,5.747,40.236s30.71,15.274,40.236,5.747 l32.937-44.431c9.527-9.519,9.527-24.963,0-34.49C74.28,311.127,58.844,311.127,49.318,320.645z"})))}}]),t}(Ye.PureComponent),rn=new o.Yb(window.innerWidth/2,window.innerHeight/2);d.subscribe("x.screen.resized",(function(e,n){rn=new o.Yb(n.width/2,n.height/2)}));var ln={targets:new Set,targetsInSight:new Set,targetsInFront:new Set,gunTarget:null},sn=function(e){Object(Ge.a)(t,e);var n=Object(He.a)(t);function t(e){var o;return Object(Be.a)(this,t),(o=n.call(this,e)).state={gunHeat:0,lockLevel:0},o}return Object(Ve.a)(t,[{key:"componentDidMount",value:function(){d.publish("x.hud.mounted")}},{key:"gunHeat",value:function(){if(!$e||!$e.gunClock.running)return Math.max(0,this.state.gunHeat-.01);var e=$e.gunClock.getDelta(),n=this.state.gunHeat+e/1.5;return n>=1&&(d.publish("x.drones.gun.stop",$e),d.publish("x.camera.shake.stop"),$e.gunClock.stop()),Math.min(n,1)}},{key:"lockLevel",value:function(){var e=this;if(0===ln.targetsInSight.size)return Math.max(0,this.state.lockLevel-.02);var n=[];return ln.targetsInSight.forEach((function(t){var o=t.lockClock.getDelta();n.push(e.state.lockLevel+o/2)})),Math.min(Math.max.apply(Math,n),1)}},{key:"update",value:function(e){var n=this.gunHeat(),t=this.lockLevel();this.setState(Object(x.a)(Object(x.a)({},e),{},{gunHeat:n,lockLevel:t,lock:1===t}))}},{key:"render",value:function(){var e=this,n=Array.from(ln.targets),t=n.map((function(e){return Object.assign(Je()(e.userData),{id:e.id})}));return Qe.a.createElement("div",null,Qe.a.createElement("div",{id:"limiter"}),Qe.a.createElement("div",{id:"pointer"}),Qe.a.createElement("div",{id:"focal",style:this.state.focalStyle}),Qe.a.createElement("div",{id:"horizon",style:this.state.horizonStyle}),$e?Qe.a.createElement("div",{id:"messages"},Qe.a.createElement("div",null,$e.userData.altitude.toFixed(0)," m"),Qe.a.createElement("div",null,$e.userData.speed.toFixed(0)," m/s")):null,Qe.a.createElement("svg",{className:"vector"},Qe.a.createElement(an,{size:"30",x:rn.x,y:rn.y,fill:"transparent",stroke:"#0f0",strokeWidth:"17",opacity:"0.8"}),Qe.a.createElement("circle",{cx:rn.x,cy:rn.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",transform:"rotate(155 ".concat(rn.x," ").concat(rn.y,")"),strokeLinecap:"round"}),this.state.lockLevel?Qe.a.createElement("circle",{cx:rn.x,cy:rn.y,r:160,stroke:"#0f0",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.lockLevel," 1000"),transform:"rotate(155 ".concat(rn.x," ").concat(rn.y,")"),strokeLinecap:"round"}):null,Qe.a.createElement("circle",{cx:rn.x,cy:rn.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",strokeLinecap:"round",transform:"rotate(205 ".concat(rn.x," ").concat(rn.y,") translate(").concat(2*rn.x,", 0) scale(-1, 1)")}),this.state.gunHeat?Qe.a.createElement("circle",{cx:rn.x,cy:rn.y,r:160,stroke:"orange",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.gunHeat," 1000"),strokeLinecap:"round",transform:"rotate(205 ".concat(rn.x," ").concat(rn.y,") translate(").concat(2*rn.x,", 0) scale(-1, 1)")}):null,n.map((function(n){return n.gunHud?Qe.a.createElement("g",{key:n.id},Qe.a.createElement("path",{d:"M ".concat(n.hudPosition.x," ").concat(n.hudPosition.y,"\n                    l ").concat(n.direction.x," ").concat(n.direction.y),strokeWidth:"1",stroke:n===e.state.gunTarget?"#0f0":"orange",fill:"transparent"}),n===e.state.gunTarget?Qe.a.createElement(an,{size:"30",x:n.hudPosition.x+n.direction.x,y:n.hudPosition.y+n.direction.y,fill:"#0f0",fillOpacity:"0.6",stroke:"#0f0",strokeWidth:"17",strokeOpacity:"1"}):null):null}))),Qe.a.createElement("div",{id:"targets"},t.map((function(e){return Qe.a.createElement("div",{className:"target",key:e.id,id:"target-"+e.id,style:e.hud.element.style},Qe.a.createElement("div",{className:"life",style:{width:e.life/100*20}}),Qe.a.createElement("div",{className:"arrow",style:e.hud.arrow.style}),Qe.a.createElement("div",{className:"distance"},e.hud.distance.innerHTML),Qe.a.createElement("div",{className:"name"},"drone-",e.id))}))))}}]),t}(Ye.Component);d.subscribe("x.hud.register.target",(function(e,n){var t,a,i,r,l,s;ln.targets.add(n),n.userData.hud={element:{style:{}},arrow:{style:{}},distance:{style:{}}};var c=function(e,c){hn.mounted&&((t=tn(n.position)).z>1?(t.x=window.innerWidth-t.x,t.y=window.innerHeight-10,n.userData.hud.element.style.borderColor="red",n.userData.hud.arrow.style.borderBottomColor="red"):(n.userData.hud.element.style.borderColor="orange",n.userData.hud.arrow.style.borderBottomColor="orange"),n.hudPosition=t,r=new o.Yb(t.x,t.y).sub(rn),n.userData.hudPositionCentered=r,r.length()>400&&r.normalize().multiplyScalar(400),n.userData.hud.arrow.style.opacity=.8*(1-(400-r.length())/50),l=kt.position.clone().sub(n.position),i=l.length(),n.userData.distance=i,n.userData.hud.distance.innerHTML=i.toFixed(0),n.userData.hud.distance.style.color=i<500?"#0f0":"orange",n.userData.hud.element.style.transform="\n      translateX(".concat(r.x+rn.x,"px)\n      translateY(").concat(r.y+rn.y,"px)\n      scale(").concat(1.1-Math.min(.2,i/2e3),")\n    "),n.userData.hud.arrow.style.transform="\n      translateY(2px)\n      rotate(".concat(r.angle()/Math.PI*180+90,"deg)\n    "),a=r.length(),!n.destroyed&&"orange"===n.userData.hud.element.style.borderColor&&a<150?(n.userData.hud.arrow.style.borderBottomColor="#0f0",ln.targetsInSight.add(n),n.lockClock.running||n.lockClock.start()):(ln.targetsInSight.delete(n),n.lockClock.stop()),!n.destroyed&&a<390?ln.targetsInFront.add(n):ln.targetsInFront.delete(n),t.z<=1&&a<320?(s=tn(n.position.clone().add(n.velocity.clone().multiplyScalar(Math.min(1,(i+l.clone().add(n.velocity).length())/2/500)))),n.gunHud=!0,n.direction={x:s.x-(r.x+rn.x),y:s.y-(r.y+rn.y)}):n.gunHud=!1,n.ready=!0)};c.id=n.id;d.subscribe("x.drones.destroy",(function(e,t){t.id===n.id&&(_t.remove(t),d.publish("x.loops.remove",c),ln.targets.delete(t),ln.targetsInSight.delete(n),hn.forceUpdate())})),d.publish("x.loops.push",c)}));var cn,un,dn,vn,pn,mn=new o.Zb,fn=function(e){cn=new o.Zb(1,0,0).applyQuaternion(kt.quaternion),un=new o.Zb(0,1,0).applyQuaternion(kt.quaternion),dn=Math.PI/2-kt.up.angleTo(cn)*Math.sign(kt.up.dot(un)),kt.rollAngle=dn,vn=kt.up.dot(kt.getWorldDirection(mn)),kt.pitch=vn,pn=dn/Math.PI*180,en={transform:"translateX(-50%) translateY(".concat(vn*window.innerHeight/2,"px) rotate(").concat(pn,"deg)")},nn=hn.state.lock?{boxShadow:"0 0 75px #0f0"}:{boxShadow:""},ln.gunTarget=gn(),hn.update({horizonStyle:en,focalStyle:nn,gunTarget:ln.gunTarget})};d.subscribe("x.hud.mounted",(function(){d.publish("x.loops.push",fn),hn.mounted=!0})),d.subscribe("x.drones.pilotDrone.loaded",(function(e,n){$e=n.pilotDrone})),d.subscribe("x.drones.missile.start",(function(e,n){hn.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{lockLevel:0,lock:!1})}))}));var gn=function(){if(0===ln.targetsInSight.size)return null;var e=[];return ln.targetsInSight.forEach((function(n){return e.push([new o.Yb(n.hudPosition.x,n.hudPosition.y).sub(rn).add(new o.Yb(n.direction.x,n.direction.y)).length(),n])})),e.sort((function(e,n){return e[0]>n[0]})),e[0][1]},hn=qe.a.render(Qe.a.createElement(sn,null),document.getElementById("hud")),wn=new o.Tb,yn={texture:{value:wn.load(t(90)),frames:new o.Yb(8,8),loop:1},depthTest:!0,depthWrite:!1,blending:o.b,scale:600,maxParticleCount:25e3},xn={texture:{value:wn.load(t(91))},depthTest:!0,depthWrite:!1,blending:o.mb,maxParticleCount:25e3},bn={texture:{value:wn.load(t(92))},depthTest:!0,depthWrite:!1,blending:o.mb,maxParticleCount:25e3},An={texture:{value:wn.load(t(93))},depthTest:!0,depthWrite:!1,blending:o.mb,maxParticleCount:25e3},Cn={particleCount:200,type:Oe.a.distributions.DISC,position:{radius:5,spread:new o.Zb(5)},maxAge:{value:2,spread:0},duration:1,activeMultiplier:2e3,velocity:{value:new o.Zb(40)},rotation:{axis:new o.Zb(0,0,1),angle:.5*Math.PI,static:!0},size:{value:2},color:{value:[new o.s(.4,.2,.1),new o.s(.2,.2,.2)]},opacity:{value:[.5,.2,0]}},Dn={particleCount:100,type:Oe.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:2},duration:1,activeMultiplier:40,velocity:{value:new o.Zb(100)},acceleration:{value:new o.Zb(0,0,-20),distribution:Oe.a.distributions.BOX},wiggle:3,size:{value:2,spread:5},angle:{spread:2*Math.PI},drag:{value:1},color:{value:[new o.s(1,1,1),new o.s(1,1,0),new o.s(1,0,0),new o.s(.4,.2,.1)]},opacity:{value:[1,1,0]}},Pn={particleCount:20,type:Oe.a.distributions.SPHERE,position:{radius:5},maxAge:{value:2},duration:1,activeMultiplier:20,velocity:{value:new o.Zb(10)},size:{value:[20,100]},color:{value:[new o.s(.5,.1,.05),new o.s(.2,.2,.2)]},opacity:{value:[.5,.35,.1,0]}},zn={particleCount:100,position:{spread:new o.Zb(15,15,15),distribution:Oe.a.distributions.SPHERE},maxAge:{value:2},duration:1,activeMultiplier:2e3,velocity:{value:new o.Zb(8,3,10),distribution:Oe.a.distributions.SPHERE},size:{value:40},color:{value:new o.s(.2,.2,.2)},opacity:{value:[0,0,.4,0]}},Mn={duration:1,particleCount:50,position:{spread:new o.Zb(5,5,5)},velocity:{spread:new o.Zb(30),distribution:Oe.a.distributions.SPHERE},size:{value:[40,20,20,20]},maxAge:{value:2},activeMultiplier:2e3,opacity:{value:[1,1,0,0]}},Sn={particleCount:1e3,position:{spread:new o.Zb(1,1,1)},maxAge:{value:10},velocity:{value:new o.Zb(4,2,5),distribution:Oe.a.distributions.SPHERE},size:{value:[20,60]},color:{value:new o.s(.9,.9,.9)},opacity:{value:[.4,.4,.4,0]}},_n={particleCount:1e3,position:{spread:new o.Zb(1,1,1)},maxAge:{value:5},velocity:{value:new o.Zb(4,2,5),distribution:Oe.a.distributions.SPHERE},size:{value:[5,10]},color:{value:new o.s(1,1,1)},opacity:{value:[.4,.4,.4,0]}},kn={particleCount:35,type:Oe.a.distributions.BOX,position:{radius:.1},maxAge:{value:1},duration:null,activeMultiplier:1,velocity:{value:new o.Zb(100),spread:new o.Zb(20,20,20)},acceleration:{value:0},size:{value:1},color:{value:[new o.s(1,1,1),new o.s(1,1,0)]},opacity:{value:1}},En={particleCount:10,type:Oe.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:.3},duration:.3,activeMultiplier:1e3,velocity:{value:new o.Zb(100)},acceleration:{value:0},wiggle:30,size:{value:[3,1,.5]},color:{value:[new o.s(1,1,1),new o.s(1,1,0)]},opacity:{value:1}},Tn=new Oe.a.Group(yn),Un=new Oe.a.Group(yn),Rn=new Oe.a.Group(bn),Nn=new Oe.a.Group(xn),Fn=new Oe.a.Group(xn),Zn=new Oe.a.Group(xn),In=new Oe.a.Group(xn),Ln=new Oe.a.Group(An),Wn=new Oe.a.Group(bn);Tn.addPool(25,Mn,!1),Un.addPool(25,Pn,!1),Rn.addPool(25,Dn,!1),Nn.addPool(25,Cn,!1),Fn.addPool(25,zn,!1),Zn.addPool(25,Sn,!1),In.addPool(25,_n,!1),Ln.addPool(25,kn,!1),Wn.addPool(25,En,!1);var jn=[Tn,Un,Rn,Nn,Fn,Zn,In,Ln,Wn];jn.forEach((function(e){e.mesh.renderOrder=2})),Zn.mesh.renderOrder=1,jn.forEach((function(e){e.mesh.frustumCulled=!1})),window.smokeGroup=Zn;var On=new o.Zb,Bn=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.getFromPool();if(null!==r){var l,s,c,u,v,p;r.position.value=i?n.position.clone().add(kt.getWorldDirection(On).multiplyScalar(5)):n.position.clone(),a&&(r.velocity.value=a());var m=new o.Zb,f=function(e){return function(n,t,o){var a=Math.floor(o/e);return n[a]||(n[a]=[]),n[a].push(t),n}},g={loop:function(e,t){r.position.value=i?n.position.clone().add(kt.getWorldDirection(On).multiplyScalar(5)):n.position.clone(),a&&(r.velocity.value=a(),l=r.attributes.position.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(f(3),[]),c=r.attributes.velocity.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(f(3),[]),s=r.paramsArray.slice(4*r.attributeOffset,4*r.activationEnd).reduce(f(4),[]),u=s.map((function(e,n){return e[0]?Object(We.a)(o.Zb,Object(h.a)(l[n])).add(Object(We.a)(o.Zb,Object(h.a)(c[n])).multiplyScalar(e[1])):null})),v=[],u.forEach((function(e,n){null!==e&&ln.targetsInFront.forEach((function(a){p=new o.N(e,e.clone().add(Object(We.a)(o.Zb,Object(h.a)(c[n])).multiplyScalar(t/1e3))),p.closestPointToPoint(a.position,!0,m).sub(a.position).length()<10&&v.push([a,e])}))})),v.length&&v.forEach((function(e){d.publish("x.sound.impact",e[0]),Gn({position:e[1]}),e[0].userData.life-=5})))},alive:!0,id:n.id};return t&&!n.destroyed&&(d.publish("x.loops.push",g),d.subscribe("x.drones.destroy",(function(t,o){o.id===n.id&&(g.alive=!1,r.disable(),e.releaseIntoPool(r))}))),r.loop=g,r.enable(),r.duration&&setTimeout((function(){r.disable(),t&&(g.alive=!1),e.releaseIntoPool(r)}),1e3*(r.duration+r.maxAge.value+r.maxAge.spread)),r}console.log("SPE.Group pool ran out.")},Vn=function(e){Bn(Tn,e),Bn(Un,e),Bn(Rn,e),Bn(Fn,e)};d.subscribe("x.drones.explode",(function(e,n){return Vn(n)}));d.subscribe("x.drones.smoke.start",(function(e,n){var t;(t=n).smoking||(t.smoking=!0,Bn(Zn,t,!0))}));d.subscribe("x.drones.missile.start",(function(e,n){return function(e){if(!e.smoking){e.smoking=!0;var n=Bn(In,e,!0);d.subscribe("x.drones.missile.stop",(function(e,t){n.loop.alive=!1,n.disable(),In.releaseIntoPool(n)}))}}(n)}));var Gn=function(e){Bn(Wn,e)},Hn=new o.Zb,Yn=new o.Zb;d.subscribe("x.drones.gun.start",(function(e,n){var t=gn();n.gunEmitter=Bn(Ln,n,!0,(function(){if(null!==t&&t.gunHud)Hn.copy(t.position).sub(n.position),Hn.add(t.velocity.clone().multiplyScalar(Hn.length()/500)),Hn.normalize().multiplyScalar(500),Yn.copy(Hn);else{Yn=kt.getWorldDirection(On).multiplyScalar(500);var e=new o.Zb(0,1,0).applyQuaternion(kt.quaternion);Yn=Yn.add(e.multiplyScalar(24))}return Yn}),!0)})),d.subscribe("x.drones.gun.stop",(function(e,n){n.gunEmitter&&(n.gunEmitter.loop.alive=!1,n.gunEmitter.disable(),Ln.releaseIntoPool(n.gunEmitter))}));var Qn,Xn=new De.a,qn=function(){Xn.load("./assets/drone/scene.gltf",(function(e){for(Qn=e.scene.children[0];Qn.children&&"Mesh"!==Qn.type;)Qn=Qn.children[0];d.publish("x.assets.drone.loaded",{mesh:Qn})}))},Kn={ready:!1},Jn=function(e,n){(Kn=function(){var e=n.mesh.clone();return e.up.set(0,0,1),e.rotation.x=0,e.scale.set(.1,.1,.1),e.name="drone-".concat(e.id),e}).ready=!0,d.publish("x.drones.factory.ready")};d.subscribe("x.assets.drone.loaded",Jn);d.subscribe("x.drones.factory.ready",(function(){var e,n,t,a=Kn();a.gunClock=new o.r(!1),a.userData.altitude=NaN,a.userData.speed=0,a.userData.lastPosition=a.position.clone(),a.layers.enable(1),_t.add(a),window.pilotDrone=a;var i,r=new o.Zb,l=new o.Fb,s=new o.Zb(0,0,-1),c=new o.Zb(0,0,100),u=0;Ht.push((function(v,p){r=kt.getWorldDirection(r),n=kt.position.clone().add(r.multiplyScalar(20)),e=new o.Zb(0,1,0).applyQuaternion(kt.quaternion),t=n.sub(e.multiplyScalar(8)),a.position.copy(t),a.lookAt(n.add(r).add({x:0,y:0,z:60})),a.userData.velocity=a.position.clone().sub(a.userData.lastPosition).multiplyScalar(1e3/p),a.userData.speed=a.userData.velocity.length(),a.userData.lastPosition.copy(a.position),v-u>200&&(u=v,l.set(a.position.clone().add(c),s),(i=l.intersectObjects(kt.userData.terrainTileUnder&&kt.userData.terrainTileUnder.geometry?[kt.userData.terrainTileUnder]:[])).length>0?(a.userData.altitude=i[0].distance-c.length(),a.userData.groundNormal=i[0].face.normal):a.userData.altitude=NaN,a.userData.altitude<5&&(d.publish("x.drones.explode.pilotDrone",a),d.publish("x.drones.collision.terrain.pilotDrone",a.userData.groundNormal)))})),d.publish("x.drones.pilotDrone.loaded",{pilotDrone:a})}));var $n=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Kn();t.lockClock=new o.r(!1),t.userData.life=100,_t.add(t),t.lastPosition=t.position.clone();var a=new o.Zb,i=function(o,i){if(t){e?t.position.set(300*Math.cos(o/1e3/3+n),300*Math.sin(o/1e3/3+n),300+50*Math.cos(o/1e3+n)):t.position.copy(kt.position.clone().add(kt.getWorldDirection(a).multiplyScalar(100))),t.velocity=t.position.clone().sub(t.lastPosition).multiplyScalar(1e3/i),t.lastPosition=t.position.clone(),!t.destroyed&&t.userData.life<=50&&!t.smoking&&d.publish("x.drones.smoke.start",t),!t.destroyed&&t.userData.life<=0&&(d.publish("x.drones.destroy",t),t.destroyed=!0,Vn(t))}};d.subscribe("x.drones.destroy",(function(e,n){n.id===t.id&&d.publish("x.loops.remove",i)})),d.publish("x.hud.register.target",t),Ht.push(i)};d.subscribe("x.drones.factory.ready",(function(){$n(!0),$n(!0,Math.PI/8),$n(!0,Math.PI/4),$n(!0,Math.PI/2),$n(!0,Math.PI)})),d.subscribe("x.drones.destroy",(function(){return $n(!0,2*Math.random()*Math.PI)}));var et=qn,nt=t(71),tt=t.n(nt),ot=t(72),at=t.n(ot);function it(e,n,t,a){var i=this;if(this.object=e,this.domElement=void 0!==n?n:document,n&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=.1,this.rollSpeed=.001,this.dragToLook=!1,this.autoForward=!1,this.nipple=t,this.nipple&&(this.nipple.on("move",(function(e,n){return i.nipplemove(e,n)})),this.nipple.on("end",(function(e,n){i.autoForward=!1,i.updateMovementVector()}))),this.acceleration=100,this.velocity=new o.Zb(0,0,0),this.zone=400,this.pointer=a,this.pointer){var r=document.getElementById("pointer");this.pointer.on("attain",(function(e){var n=i.getContainerDimensions().size;r.style.left=n[0]/2+"px",r.style.top=n[1]/2+"px";var t=new o.Yb(0,0);e.on("data",(function(e){t.add(new o.Yb(e.dx,e.dy)),t.length()>i.zone&&t.normalize().multiplyScalar(i.zone),r.style.transform="\n          translateX(".concat(t.x-16,"px)\n          translateY(").concat(t.y-16,"px)\n        "),i.mousemove({pageX:t.x/1.5,pageY:t.y/1.5})})),e.on("close",(function(){}))}))}function l(e,n){return function(){n.apply(e,arguments)}}function s(e){e.preventDefault()}this.nipplemove=function(e,n){var t={pageX:n.distance*Math.cos(n.angle.radian)*1.5,pageY:-n.distance*Math.sin(n.angle.radian)*1.5};this.mousemove(t),this.autoForward=!0,this.updateMovementVector()},this.tmpQuaternion=new o.zb,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new o.Zb(0,0,0),this.rotationVector=new o.Zb(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.yawLeft=1;break;case 68:this.moveState.yawRight=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.yawLeft=0;break;case 68:this.moveState.yawRight=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousemove=function(e){this.moveState.yawLeft=-e.pageX/this.zone,this.moveState.rollLeft=this.moveState.yawLeft/2-this.object.rollAngle/5,this.moveState.pitchDown=e.pageY/this.zone},this.deltaVelocity=null,this.deltaPosition=null,this.update=function(e){var n=e*i.rollSpeed;i.deltaVelocity=i.moveVector.clone().multiplyScalar(e/1e3*i.acceleration),i.velocity.sub(i.velocity.clone().multiplyScalar(.01*Math.max(1,i.deltaVelocity.length()?1:100/(i.velocity.length()+1))*e/16.67)).add(i.deltaVelocity),i.deltaPosition=i.velocity.clone().multiplyScalar(e/1e3),i.object.position.add(i.deltaPosition.applyQuaternion(i.object.quaternion)),i.tmpQuaternion.set(i.rotationVector.x*n,i.rotationVector.y*n,i.rotationVector.z*n,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),i.object.rotation.setFromQuaternion(i.object.quaternion,i.object.rotation.order),i.updateRotationVector(),i.updateMovementVector()},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",s,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",u,!1)};var c=l(this,this.keydown),u=l(this,this.keyup);this.domElement.addEventListener("contextmenu",s,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",u,!1),this.updateMovementVector(),this.updateRotationVector()}var rt=function(){function e(n,t,o){Object(Be.a)(this,e),this.ship=n,this.controls=t,this.active=o,this.target=null,this.pointerElement=document.getElementById("pointer")}return Object(Ve.a)(e,[{key:"toggle",value:function(){this.active=!this.active}},{key:"update",value:function(e){if(this.active){if(this.state=Object(x.a)(Object(x.a)({},hn.state),ln),(null===this.target||this.target.destroyed)&&(this.target=Array.from(this.state.targets).filter((function(e){return e.ready&&!e.destroyed})).reduce((function(e,n){return e.userData.distance<n.userData.distance?e:n})),console.log("Acquired target "+this.target.name)),!this.target)return console.log("No target acquired"),this.controls.moveState.forward=0,void this.controls.mousemove({pageX:0,pageY:0});var n={x:0,y:0};if(this.target.hudPosition.z>1){var t=150*Math.sign(this.target.userData.hudPositionCentered.x);n.x+=t,n.y+=t*Math.abs(Math.sin(this.ship.rollAngle)),n.y+=250*this.ship.pitch}else n.x+=on(-150,this.target.userData.hudPositionCentered.x,150),n.y+=on(-150,this.target.userData.hudPositionCentered.y,150);this.controls.mousemove({pageX:n.x,pageY:n.y}),this.pointerElement.style.transform="\n      translateX(".concat(n.x-16,"px)\n      translateY(").concat(n.y-16,"px)\n    "),this.target.userData.distance>150?this.controls.moveState.forward=1:this.controls.moveState.forward=0}}}]),e}(),lt={module:null,setAcceleration:function(e){this.module&&e!==this.module.acceleration&&(this.module.acceleration=e,console.log("acceleration set to ",e))}},st=function(){var e,n=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(n=!0),n}();d.subscribe("x.drones.pilotDrone.loaded",(function(e,n){if(st){document.getElementById("touchPane").style.display="block";var t=window.document.getElementsByClassName("touchPaneLeft")[0],a=tt.a.create({zone:t,mode:"static",position:{left:"30%",top:"90%"},color:"white"});Array.from(document.getElementsByClassName("touchButton")).forEach((function(e){e.style.display="block"})),document.getElementById("verbosePane").style.display="none";var i=document.getElementById("buttonX"),r=function(e){e.target.style.opacity=.5,v({button:2}),setTimeout((function(){e.target.style.opacity=.3}),250)};i.addEventListener("click",r,!1),i.addEventListener("touchstart",r,!1),lt.module=new it(kt,t,a)}else{var l=at()(Et.domElement);lt.module=new it(kt,Et.domElement,void 0,l)}lt.module.update(0);var s=new rt(kt,lt.module,!1);be.a.bind("p",(function(e){return s.toggle()})),d.publishSync("x.loops.unshift",(function(e,n){s.update(e,n),lt.module.update(n)}));var c=n.pilotDrone;be.a.bind("c",(function(e){console.log(kt.position)})),be.a.bind("r",(function(e){"OrbitControls"===lt.module.constructor.name&&(lt.module.autoRotate=!lt.module.autoRotate)})),be.a.bind("space",(function(e){d.publishSync("x.toggle.play")}));var u=new o.cb(new o.Nb(1,5,5),new o.fb({color:1118481})),v=function(e){if(c)if(0===e.button)d.publishSync("x.drones.gun.start",c),d.publishSync("x.camera.shake.start",5),c.gunClock.start();else if(2===e.button){var n=function(){if(0===ln.targetsInSight.size||!hn.state.lock)return null;var e=[];return ln.targetsInSight.forEach((function(n){return e.push([kt.position.distanceTo(n.position),n])})),e.sort((function(e,n){return e[0]>n[0]})),e[0][1]}();if(null===n||n.destroyed)return;var t=u.clone();t.position.copy(c.position),_t.add(t),d.publishSync("x.drones.missile.start",t);var o=new function(){var e=this;this.alive=!0,this.object=t,this.loop=function(o,a){if(e.alive){var i=n.position.clone().sub(t.position);i.length()<10&&(e.alive=!1,Vn(n),d.publishSync("x.drones.missile.stop",t),d.publishSync("x.drones.explosion",n),n.userData.life-=25,hn.forceUpdate());var r=i.normalize().multiplyScalar(10*a/16.66);t.position.add(r)}}};d.publishSync("x.loops.push",o)}};Et.domElement.addEventListener("mousedown",v,!1),Et.domElement.addEventListener("mouseup",(function(e){0===e.button&&(d.publishSync("x.drones.gun.stop",c),d.publishSync("x.camera.shake.stop"),c.gunClock.stop())}),!1)}));var ct=new o.Zb;d.subscribe("x.drones.collision.terrain.pilotDrone",(function(e,n){lt.setAcceleration(0),ct.copy(lt.module.velocity).applyQuaternion(kt.quaternion),ct.reflect(n),ct.add(kt.position),lt.module.velocity=kt.worldToLocal(ct),setTimeout((function(){lt.setAcceleration(60)}),1e3)}));var ut=lt,dt=new o.g,vt=[{url:t(107)},{url:t(108)},{url:t(109)},{url:t(110)}],pt=[{url:t(111)},{url:t(112)}],mt=[{url:t(113)},{url:t(114)}],ft=function(e){dt.load(e.url,(function(n){e.buffer=n}))},gt=function(){kt.listener=new o.f,kt.add(kt.listener),vt.map(ft),pt.map(ft),mt.map(ft),d.subscribe("x.sound.impact",(function(e,n){var t=Math.floor(Math.random()*vt.length);if(vt[t].buffer){var a=new o.xb(kt.listener);a.setBuffer(vt[t].buffer),a.setRefDistance(100),n.add(a),a.play()}}));var e=function(e,n){var t=Math.floor(Math.random()*mt.length);if(mt[t].buffer){var a=new o.xb(kt.listener);a.setBuffer(mt[t].buffer),a.setRefDistance(500),n.add(a),a.play()}};d.subscribe("x.drones.destroy",e),d.subscribe("x.drones.explosion",e);var n=new o.e(kt.listener);d.subscribe("x.drones.gun.start",(function(e,t){pt[0].buffer&&(n.setBuffer(pt[0].buffer),n.setLoop(!0),n.play())})),d.subscribe("x.drones.gun.stop",(function(e,t){n.stop()}));var t=new o.e(kt.listener);d.subscribe("x.drones.missile.start",(function(e,n){pt[1].buffer&&(t.setBuffer(pt[1].buffer),t.play())})),d.subscribe("x.drones.missile.stop",(function(e,n){t.stop()}))},ht=t(73),wt=t.n(ht),yt=t(74),xt=t.n(yt),bt=t(75),At=t.n(bt),Ct=t(76),Dt=t.n(Ct),Pt={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},surface:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},tDepth:{type:"t",value:null},textureMatrix:{type:"m4",value:null},clipToWorldMatrix:{type:"m4",value:null},config:{type:"v4",value:new o.ac}},vertexShader:xt.a,fragmentShader:wt.a},zt={uniforms:{color:{type:"c",value:new o.s(16777215)},reflectivity:{type:"f",value:.75},waterLevel:{type:"f",value:0},tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tReflectionMap:{type:"t",value:null},tReflectionDepth:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},clipToWorldMatrix:{type:"m4",value:null},worldToClipMatrix:{type:"m4",value:new o.bb},cameraPosition:{type:"v3",value:null},sunPosition:{type:"v3",value:null},time:{type:"f",value:0}},vertexShader:Dt.a,fragmentShader:At.a},Mt=c.a.parse(window.location.search),St={PBR:"true"===Mt.PBR,shadows:"true"===Mt.shadows,postprocessing:"true"===Mt.postprocessing};St.PBR&&(St.postprocessing=!0);var _t=new o.Hb,kt=new o.rb(75,window.innerWidth/window.innerHeight,1,1e6);kt.up=new o.Zb(0,0,1),kt.position.set(-70,175,345),kt.lookAt(0,-400,0),kt.rollAngle=0,kt.userData={terrainKeysUnder:[]},kt.updateMatrixWorld(),kt.updateProjectionMatrix(),gt();var Et=new o.dc({antialias:!0,alpha:!0,logarithmicDepthBuffer:!1});Et.outputEncoding=o.R,Et.shadowMap.enabled=St.shadows,Et.shadowMap.bias=.001,Et.shadowMap.type=o.qb,Et.shadowMap.autoUpdate=!0,Et.physicallyCorrectLights=!0,Et.toneMapping=o.a,Et.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(Et.domElement),window.scene=_t,window.renderer=Et,window.camera=kt,window.controls=ut;var Tt=new i.a.GUI({autoPlace:!1});Tt.closed=!0,window.document.getElementsByClassName("guiPane")[0].appendChild(Tt.domElement),window.gui=Tt,d.publish("x.gui.init",{gui:Tt});var Ut=Tt.addFolder("Level of detail"),Rt=new function(){this.low=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!1,postprocessing:!1})},this.lowShadow=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!1})},this.lowShadowDoF=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!0})},this.high=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!0,shadows:!0,postprocessing:!0})}};Ut.add(Rt,"low").name("low (default)"),_t.background=new o.s(9546677),_t.fog=new o.A(9546677,5e-4);var Nt=new o.cb(new o.Nb(5,5,5),new o.db({color:16777215}));Nt.visible=!1,_t.add(Nt);var Ft=null;d.subscribe("x.drones.pilotDrone.loaded",(function(e,n){Ft=n.pilotDrone}));var Zt=new o.Zb;window.sunPosition=Zt,function(e,n,t){var a=new v;a.scale.setScalar(45e4),e.add(a);for(var i=new o.Ob(1e5,8,8),r=0;r<i.faces.length;r++){var l=i.faces[r],s=l.a;l.a=l.c,l.c=s}var c=new o.db({opacity:0}),u=new o.cb(i,c);u.material.side=o.h,e.add(u);var d={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.32,azimuth:.2,sun:!1};if(t){function m(){var e=a.material.uniforms;e.turbidity.value=d.turbidity,e.rayleigh.value=d.rayleigh,e.luminance.value=d.luminance,e.mieCoefficient.value=d.mieCoefficient,e.mieDirectionalG.value=d.mieDirectionalG;var t=Math.PI*(d.inclination-.5),o=2*Math.PI*(d.azimuth-.5);n.x=4e5*Math.cos(o),n.z=4e5*Math.sin(o)*Math.sin(t),n.y=4e5*Math.sin(o)*Math.cos(t),e.sunPosition.value.copy(n),n.copy(n),p.position.copy(n),p.position.normalize(),p.position.multiplyScalar(2e3)}var f=t.addFolder("Sun, sky and ocean");f.add(d,"turbidity",1,20,.1).onChange(m),f.add(d,"rayleigh",0,4,.001).onChange(m),f.add(d,"mieCoefficient",0,.1,.001).onChange(m),f.add(d,"mieDirectionalG",0,1,.001).onChange(m),f.add(d,"luminance",0,2).onChange(m),f.add(d,"inclination",0,1,1e-4).onChange(m),f.add(d,"azimuth",0,1,1e-4).onChange(m),f.add(d,"sun").onChange(m),m()}}(_t,Zt,Tt),function(e,n){p.sunPosition=n,p.updatePosition=g,p.updatePosition(),p.up.set(0,0,1),p.name="sunlight",p.castShadow=!0,p.shadow.mapSize.width=p.shadow.mapSize.height=1024;var t=1024;p.shadow.camera.left=-t,p.shadow.camera.right=t,p.shadow.camera.top=t,p.shadow.camera.bottom=-t,p.shadow.camera.far=3200,p.shadow.bias=-1e-4,p.needsUpdate=!0,e.add(p),e.add(m),e.add(f)}(_t,Zt),p.target=Nt,_t.add(Ze);var It=2e4,Lt=new o.tb(5*It,5*It,10,10),Wt=(new o.Tb).setCrossOrigin("anonymous"),jt=new Me.a(Lt,{textureWidth:512,textureHeight:512,color:16777215,flowDirection:new o.Yb(1,1),scale:2e4/15,normalMap0:Wt.load(t(57)),normalMap1:Wt.load(t(58)),clipBias:1e-5,reflectivity:.2,shader:Pt,flowSpeed:.1,encoding:o.R});window.water=jt;var Ot=new o.cc(window.innerWidth,window.innerHeight),Bt=new o.eb;Ot.depthBuffer=!0,Ot.depthTexture=new o.u,jt.material.uniforms.tDepth.value=Ot.depthTexture,jt.up.set(0,0,1),jt.position.z=75,jt.material.uniforms.surface.value=jt.position.z,Tt.__folders["Sun, sky and ocean"].add(jt.position,"z",0,200,1),jt.receiveShadow=!0,jt.userData.isWater=!0,window.water=jt,_t.add(jt);var Vt=new ze.a(Lt,{textureWidth:512,textureHeight:512,clipBias:1e-5,encoding:o.R});Vt.rotation.y=Math.PI,Vt.up.set(0,0,-1),Vt.position.copy(jt.position),Vt.getRenderTarget().depthBuffer=!0,Vt.getRenderTarget().depthTexture=new o.u,window.ref=Vt,Vt.updateMatrixWorld(),et(),jn.forEach((function(e){return _t.add(e.mesh)}));var Gt=!1;d.subscribe("x.camera.shake.start",(function(e){so.enabled=!0,Gt=!0})),d.subscribe("x.camera.shake.stop",(function(){so.enabled=!1,Gt=!1}));var Ht=[function(){return Ze.position.copy(Zt)},function(e){return Ae[Ce](e)},function(e,n){jn.forEach((function(e){return e.tick(n/1e3)}))},function(){Gt&&kt.position.add({x:1*(Math.random()-.5),y:1*(Math.random()-.5),z:1*(Math.random()-.5)})},function(){return _t.children.forEach((function(e){e instanceof o.L&&e.update(kt)}))},function(e,n){kt.position.z<jt.position.z?(Kt.enabled=!0,eo.enabled=!0,jt.visible=!1,Ft&&Ft.layers.enable(3),Vt.onBeforeRender(Et,_t,kt),Kt.material.uniforms.time.value=e/1e3,eo.material.uniforms.time.value=e/1e3,ut.setAcceleration(30)):(Kt.enabled=!1,eo.enabled=!1,jt.visible=!0,Ft&&kt.layers.disable(3),ut.setAcceleration(100))}];d.subscribe("x.loops.remove",(function(e,n){return function(e){Ht=Ht.filter((function(n){return n!==e}))}(n)})),d.subscribe("x.loops.push",(function(e,n){return Ht.push(n)})),d.subscribe("x.loops.unshift",(function(e,n){return Ht.unshift(n)})),window.loops=Ht,d.publish("x.loops.loaded");Et.setPixelRatio(1);var Yt=new l.a;document.body.appendChild(Yt.dom);var Qt=new o.cc(window.innerWidth,window.innerHeight);Qt.texture.encoding=o.R;var Xt=new Se.a(Et,Qt),qt=new ke.a(_t,kt);Xt.addPass(qt);var Kt=new _e.a(zt);Kt.enabled=!1,Kt.material.uniforms.waterLevel.value=jt.position.z,Kt.material.uniforms.tDepth.value=Ot.depthTexture,Kt.material.uniforms.cameraPosition.value=kt.position,Kt.material.uniforms.sunPosition.value=Zt,Kt.material.uniforms.tReflectionMap.value=Vt.getRenderTarget().texture,Kt.material.uniforms.tReflectionDepth.value=Vt.getRenderTarget().depthTexture;var Jt=Kt.material.uniforms.tNormalMap0,$t=Kt.material.uniforms.tNormalMap1;Jt.value=Wt.load(t(57)),$t.value=Wt.load(t(58)),Jt.value.wrapS=Jt.value.wrapT=o.Gb,$t.value.wrapS=$t.value.wrapT=o.Gb,Xt.addPass(Kt),window.upass=Kt;var eo=new _e.a({uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n\n    float frequency = 10.;\n    float amplitude = 0.005;\n\n    void main() {\n      vec2 uv = vUv;\n      float X = vUv.x * frequency + time;\n      float Y = vUv.y * frequency + time;\n      uv.y += cos(X + Y) * amplitude * cos(Y);\n      uv.x += sin(X - Y) * amplitude * sin(Y);\n      gl_FragColor = texture2D(tDiffuse, uv);\n    }\n  "});eo.enabled=!1,Xt.addPass(eo),Et.autoClear=!1;var no=new Ue(_t,kt,2);no.inverse=!0,Xt.addPass(no);var to=new _e.a(Ie,"tColor");to.material.uniforms.tDepth.value=Ot.depthTexture,to.material.uniforms.cameraPosition.value=kt.position,to.material.uniforms.velocityFactor.value=1,Xt.addPass(to);var oo=new Te.a;Xt.addPass(oo);var ao=new o.bb,io=new o.bb,ro=new o.Zb,lo=new o.bb,so=new Ee.a;so.enabled=!1,Xt.addPass(so);var co=new _e.a(Le);Xt.addPass(co);var uo=!0;d.subscribe("x.toggle.play",(function(){uo=!uo}));var vo=0;!function e(n){requestAnimationFrame(e);var t=n-vo;vo=n,uo&&(Ht.forEach((function(e){e.loop?e.loop(n,t):e(n,t)})),to.material.uniforms.delta.value=t,to.material.uniforms.clipToWorldMatrix.value.getInverse(kt.matrixWorldInverse).multiply(lo.getInverse(kt.projectionMatrix)),to.material.uniforms.worldToClipMatrix.value.copy(kt.projectionMatrix).multiply(kt.matrixWorldInverse),to.material.uniforms.previousWorldToClipMatrix.value.copy(io.multiply(ao)),to.material.uniforms.cameraMove.value.copy(kt.position).sub(ro),_t.overrideMaterial=Bt,kt.layers.set(3),Et.setRenderTarget(Ot),Et.render(_t,kt),kt.layers.set(0),_t.overrideMaterial=null,jt.material.uniforms.clipToWorldMatrix.value=to.material.uniforms.clipToWorldMatrix.value,Kt.material.uniforms.clipToWorldMatrix.value=to.material.uniforms.clipToWorldMatrix.value,Kt.material.uniforms.worldToClipMatrix.value.copy(kt.projectionMatrix).multiply(kt.matrixWorldInverse),Xt.render(t),ao.copy(kt.matrixWorldInverse),io.copy(kt.projectionMatrix),ro.copy(kt.position)),Ht.forEach((function(e){void 0!==e.alive&&!1===e.alive&&e.object&&_t.remove(e.object)})),Ht=Ht.filter((function(e){return void 0===e.alive||!0===e.alive})),Yt.update()}(0),function(e,n,t){t=t||function(){return{width:window.innerWidth,height:window.innerHeight}};var o=function(){var o=t();e.setSize(o.width,o.height),n.aspect=o.width/o.height,n.updateProjectionMatrix(),d.publish("x.screen.resized",o)};window.addEventListener("resize",o,!1)}(Et,kt)}]),[[77,1,2]]]);
//# sourceMappingURL=main.8c04f6b9.chunk.js.map