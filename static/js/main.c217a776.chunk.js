(this.webpackJsonp=this.webpackJsonp||[]).push([[0],Array(34).concat([function(e,n,t){"use strict";t.r(n);var o=t(0);t.d(n,"BufferAttribute",function(){return o.l}),t.d(n,"REVISION",function(){return o.ub}),t.d(n,"ShaderChunk",function(){return o.Bb}),t.d(n,"Vector2",function(){return o.Qb}),t.d(n,"Vector3",function(){return o.Rb}),t.d(n,"Vector4",function(){return o.Sb}),t.d(n,"Color",function(){return o.p}),t.d(n,"Texture",function(){return o.Jb}),t.d(n,"Math",function(){return o.T}),t.d(n,"AdditiveBlending",function(){return o.a}),t.d(n,"ShaderMaterial",function(){return o.Db}),t.d(n,"BufferGeometry",function(){return o.m}),t.d(n,"Points",function(){return o.ob})},function(e,n,t){e.exports=t.p+"static/media/Rock_08_UV_H_CM_1.da494a88.jpg"},function(e,n,t){e.exports=t.p+"static/media/Rock_08_UV_H_CM_1_normal.6085c2f7.jpg"},function(e,n,t){e.exports=t.p+"static/media/GrassGreenTexture_1024.3f1df3f0.jpg"},function(e,n,t){e.exports=t.p+"static/media/GrassGreenTexture_1024_normal.ce43156e.jpg"},,,,,,,,,,,,,,,,,function(e,n,t){e.exports=t.p+"static/media/Water_1_M_Normal.a33d50da.jpg"},function(e,n,t){e.exports=t.p+"static/media/Water_2_M_Normal.639428cf.jpg"},,,,,function(e,n,t){e.exports=function(){return new Worker(t.p+"terrain.worker.8d81d42e.js")}},function(e,n){e.exports="#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\nvarying vec3 vNormal2;\nvarying float flatness;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t// #include <worldpos_vertex>\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\tvNormal2 = normalize(normal);\n\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\n  vWorldPosition = position;\n}\n"},function(e,n){e.exports="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <envmap_physical_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, sampler2D normalMap) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\n\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\n\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\n\n\t#include <logdepthbuf_fragment>\n\n\t// #include <map_fragment>\n\tvec4 texelColorXY = texture2D( map, vUvXY );\n\tvec4 texelColorXZ = texture2D( map, vUvXZ );\n\tvec4 texelColorYZ = texture2D( map, vUvYZ );\n\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n\tvec4 texelColor = (\n\t\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\n\t\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\n\t\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\n\t);\n\t// texelColor = texelColorXY;\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\t// return diffuseColor;\n\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t// #include <normal_fragment_maps>\n\tnormal = perturbNormal2Arb( -vViewPosition, normal, normalMap);\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.6, 0.7, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t#include <fog_fragment>\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// gl_FragColor = vec4(normal, 1.0);\n\n}\n"},function(e,n){e.exports="#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\nvarying vec3 vNormal2;\nvarying float flatness;\nvarying vec3 vWorldPosition;\nvarying vec2 vNoise;\n\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\n\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nvec4 fade(vec4 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\nfloat cnoise(vec4 P){\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t// transformed = floor(transformed);\n\n\t// #include <worldpos_vertex>\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\tvNormal2 = normalize(normal);\n\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\n\tvWorldPosition = position;\n\t// uvnoise = vec2(\n\t// \t// (sin((position.x + position.y + position.z) + / 30.0)) * 0.3333332,\n\n\t// \t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332,\n\t// \t// (sin(position.x / 10.0) + sin(position.y / 10.0) + sin(1.5 + position.z / 10.0)) * 0.3333332\n\n\t// \t// mod((position.x + position.y + position.z), 10.0) / 10.0,\n\t// \t// mod((position.x + position.y + position.z), 10.0) / 10.0\n\n\t// \t// mod(mod(position.x, 1.0) + position.z, 1.0),\n\t// \t// mod(mod(position.y, 1.0) + position.z, 1.0)\n\n\t// \t// mod(position.x + 0.5 * cnoise(vec4(position, 1.0)), 10.0) / 10.0,\n\t// \t// mod(position.y + 0.5 * cnoise(vec4(position.zyx, 1.0)), 10.0) / 10.0\n\n  vNoise = vec2(\n    noise(position / 50.0),\n    noise(position.zyx / 50.0)\n  );\n\n\t// \t// cos(position / 5.0) * 0.5 + 0.5,\n\t// \t// cos(position.zyx / 5.0) * 0.5 + 0.5\n\n\t// \t// noise(position.xyz) * mod(position.z, 10.0) / 10.0,\n\t// \t// noise(position.zyx) * mod(position.z, 10.0) / 10.0\n\t// );\n\t// vUv = uvnoise;\n\n\t// vec2 vUvXY = vec2(mod(position.x, 100.0) / 100.0, mod(position.y, 100.0) / 100.0 );\n\t// vec2 vUvXZ = vec2(mod(position.x, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\n\t// vec2 vUvYZ = vec2(mod(position.y, 100.0) / 100.0 , mod(position.z, 100.0) / 100.0 );\n\n\t// vec3 mixer = clamp(abs(normal), 0.0000001, 1.0);\n\t// vec2 zero2 = vec2(0.0, 0.0);\n\t// vUv = (\n\t// \tmix(zero2, vUvXY, pow(mixer.z, 2.5)) +\n\t// \tmix(zero2, vUvXZ, pow(mixer.y, 2.5)) +\n\t// \tmix(zero2, vUvYZ, pow(mixer.x, 2.5))\n\t// );\n}\n"},function(e,n){e.exports="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec2 vNoise;\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <envmap_physical_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 vUv1, vec2 vUv2, vec2 vUv3) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN1 = texture2D( normalMap, vUv1 ).xyz;\n\t\tvec3 mapN2 = texture2D( normalMap, vUv2 ).xyz;\n\t\tvec3 mapN3 = texture2D( normalMap, vUv3 ).xyz;\n\t\tvec3 black = vec3(0.0, 0.0, 0.0);\n\t\tvec3 mapN = (\n\t\t\tmix(black, mapN1, pow(N.z, 2.5)) +\n\t\t\tmix(black, mapN2, pow(N.y, 2.5)) +\n\t\t\tmix(black, mapN3, pow(N.x, 2.5))\n\t\t);\n\t\t// return mapN;\n\t\tmapN = mapN * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\n\t// return vec4(vUv, 0.0, 1.0);\n\t// return vec4(clamp(vNormal2.z, 0.0, 1.0), 0.0, 0.0, 1.0);\n\t// return vec4(cos(vWorldPosition.xyz / 5.0) * 0.5 + 0.5, 1.0);\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\tvec2 vUvXY = vec2(mod(vWorldPosition.x, 100.0) / 100.0, mod(vWorldPosition.y, 100.0) / 100.0 );\n\tvec2 vUvXZ = vec2(mod(vWorldPosition.x, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\tvec2 vUvYZ = vec2(mod(vWorldPosition.y, 100.0) / 100.0 , mod(vWorldPosition.z, 100.0) / 100.0 );\n\n\tvec3 mixer = clamp(abs(vNormal2), 0.0, 1.0);\n\n\t#include <logdepthbuf_fragment>\n\n\t// #include <map_fragment>\n\tvec4 texelColorXY = texture2D( map, vUvXY );\n\tvec4 texelColorXZ = texture2D( map, vUvXZ );\n\tvec4 texelColorYZ = texture2D( map, vUvYZ );\n\tvec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n\tvec4 texelColor = (\n\t\tmix(black, texelColorXY, pow(mixer.z, 2.5)) +\n\t\tmix(black, texelColorXZ, pow(mixer.y, 2.5)) +\n\t\tmix(black, texelColorYZ, pow(mixer.x, 2.5))\n\t);\n\t// texelColor = texelColorXY;\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\t// return diffuseColor;\n\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t// #include <normal_fragment_maps>\n\t// normal = perturbNormal2Arb( -vViewPosition, normal , vUvXY, vUvXZ, vUvYZ);\n\t// return vec4(normal, 1.0);\n\t// #include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t// #include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.15, 0.3, flatness * vNoise.x + flatness * vNoise.y)\n\t\t// smoothstep(vNoise.x, vNoise.y, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t#include <fog_fragment>\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// gl_FragColor = vec4(flatness, flatness, flatness, 1.0);\n\n}\n"},function(e,n,t){e.exports=function(){return new Worker(t.p+"voxel.worker.a2ea31ea.js")}},,,,,function(e,n){e.exports="#include <common>\n#include <fog_pars_fragment>\n\nuniform sampler2D tReflectionMap;\nuniform sampler2D tRefractionMap;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\nuniform sampler2D tDepth;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float surface;\nuniform vec4 config;\nuniform mat4 clipToWorldMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvec3 surfaceColor = vec3(0.0078, 0.5176, 0.7);\nvec3 shoreColor = vec3(0.0078, 0.5176, 0.7);\nvec3 depthColor = vec3(0.0039, 0.00196, 0.145);\n// Description : Water color based on water depth and color extinction\n//\n// based on Rendering Water as a Post-process Effect by Wojciech Toman\n//\n\n// waterTransparency - x = , y = water visibility along eye vector,\n// waterDepthValues - x = water depth in world space, y = view/accumulated water depth in world space\nvec3 DepthRefraction(float waterDepth, float viewWaterDepth, vec3 refractionColor)\n{\n  float waterClarity = 0.75;\n  float visibility = 200.;\n  float shoreRange = 50.;\n  float horizontalExtinction = 200.;\n\n  float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\n  float accDepthExp = saturate(accDepth / (2.5 * visibility));\n  accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\n\n  surfaceColor = mix(shoreColor, surfaceColor, saturate(waterDepth / shoreRange));\n  vec3 waterColor = mix(surfaceColor, depthColor, saturate(waterDepth / horizontalExtinction));\n\n  refractionColor = mix(refractionColor, surfaceColor * waterColor, saturate(accDepth / visibility));\n  refractionColor = mix(refractionColor, depthColor, accDepthExp);\n  refractionColor = mix(refractionColor, depthColor * waterColor, saturate(waterDepth / horizontalExtinction));\n  return refractionColor;\n}\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  vec3 toEye = normalize( vToEye );\n  vec3 surfacePosition = cameraPosition - vToEye;\n\n  // determine flow direction\n  vec2 flow;\n  #ifdef USE_FLOWMAP\n  flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n  #else\n  flow = flowDirection;\n  #endif\n  flow.x *= - 1.0;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n  vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n  // linear interpolate to get the final normal color\n  float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  //  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, normalColor.b ));\n\n  // calculate the fresnel term to blend reflection and refraction maps\n  float theta = max( dot( toEye, normal ), 0.0 );\n  float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n  // calculate final uv coords\n  vec3 coord = vCoord.xyz / vCoord.w;\n  vec2 uv = coord.xy + coord.z * normal.xy * 0.1;\n\n  vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n  vec4 refractColor = texture2D( tRefractionMap, uv );\n\n  // water depth\n\n  float zOverW = texture2D(tDepth, coord.xy).x;\n  // clipPosition is the viewport position at this pixel in the range -1 to 1.\n  vec4 clipPosition = vec4(coord.xy * 2. - 1., zOverW * 2. - 1., 1.);\n  vec4 worldPosition = clipToWorldMatrix * clipPosition;\n  worldPosition /= worldPosition.w;\n\n  float waterDepth = surfacePosition.z - worldPosition.z;\n  float viewWaterDepth = length(surfacePosition - worldPosition.xyz);\n\n  float depthDensity = 0.01;\n  float depthFactor = whiteCompliment( exp2( - depthDensity * depthDensity * viewWaterDepth * viewWaterDepth * LOG2 ) );\n  refractColor.rgb = mix( refractColor.rgb, depthColor, depthFactor );\n  // refractColor.rgb = DepthRefraction(waterDepth, viewWaterDepth, refractColor.rgb);\n\n  // multiply water color with the mix of both textures\n  gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n  // gl_FragColor = refractColor;\n  // gl_FragColor = vec4(vec3(waterDepth/500.), 1.0);\n\n  // #include <tonemapping_fragment>\n  // #include <encodings_fragment>\n  // #include <fog_fragment>\n\n}"},function(e,n){e.exports="#include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\n  vUv = uv;\n  vCoord = textureMatrix * vec4( position, 1.0 );\n\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n  vToEye = cameraPosition - worldPosition.xyz;\n\n  vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n  gl_Position = projectionMatrix * mvPosition;\n\n  #include <fog_vertex>\n\n}"},function(e,n){e.exports="#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform sampler2D tReflectionMap;\nuniform sampler2D tReflectionDepth;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float time;\nuniform float waterLevel;\nuniform vec4 config;\nuniform vec3 sunPosition;\nuniform mat4 clipToWorldMatrix;\nuniform mat4 worldToClipMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\n// vec3 depthColor = vec3(0.0039, 0.00196, 0.145);\nvec3 depthColor = vec3(0.0117, 0.0117, 0.325);\n\n#define TAU 6.28318530718\n#define MAX_ITER 5\nvec3 caustic(vec2 uv) {\n  vec2 p = mod(uv*TAU, TAU)-250.0;\n\n  vec2 i = vec2(p);\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER; n++) {\n    float t = time * (1.0 - (3.5 / float(n+1)));\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n  }\n\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, 1.4);\n  vec3 color = vec3(pow(abs(c), 8.0));\n  // color = clamp(color + vec3(0.0, 0.35, 0.5), 0.0, 1.0);\n  color = mix(color, vec3(1.0,1.0,1.0),0.5);\n\n  return color;\n}\n\nfloat causticX(float x, float power, float gtime) {\n  float p = mod(x*TAU, TAU)-250.0;\n\n  float i = p;;\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER/2; n++) {\n    float t = gtime * (1.0 - (3.5 / float(n+1)));\n    i = p + cos(t - i) + sin(t + i);\n    c += 1.0/length(p / (sin(i+t)/inten));\n  }\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, power);\n\n  return c;\n}\n\nfloat GodRays(vec2 uv) {\n  float light = 0.0;\n  vec4 uvSun = worldToClipMatrix * vec4(sunPosition, 1.);\n  uvSun /= uvSun.w;\n  uvSun = uvSun / 2. + 0.5;\n  vec2 uv2 = vec2(\n    dot(normalize(uv - uvSun.xy), vec2(1., 0.)),\n    length(uv - uvSun.xy)\n  );\n\n  light += pow(causticX((uv2.x + 0.08 * uv2.y) / 1.7 + 0.5, 1.8, time * 0.65), 10.0) * 0.05;\n  light += pow(causticX(sin(uv2.x), 0.3, time * 0.7), 9.0) * 0.4;\n  light += pow(causticX(cos(uv2.x * 2.3), 0.3, time * 1.3), 4.0) * 0.1;\n\n  light *= smoothstep(0., .3, uv2.y) * smoothstep(0., .3, uv2.y);\n  light = clamp(light, 0.0, 1.0);\n\n  return light;\n}\n\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\nfloat hash11(float p)\n{\n  vec3 p3  = fract(vec3(p) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\nvec3 hash33(vec3 p3)\n{\n  p3 = fract(p3 * HASHSCALE3);\n    p3 += dot(p3, p3.yxz+19.19);\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\n}\n\nconst int   STAR_VOXEL_STEPS = 8;\nconst float STAR_VOXEL_STEP_SIZE = 3.;\n\nfloat distanceRayPoint(vec3 ro, vec3 rd, vec3 p, out float h) {\n    h = dot(p - ro, rd);\n    return length(p - ro - rd * h);\n}\nvec3 getDotColour(float t)\n{\n  return vec3(t*.57,t*.3,t*.05);\n  return vec3(t*.9,t*.9,t*.9);\n  return vec3(t*.3,t*.6,t*.5);\n}\n\n// This code is the starfield stuff from iapafoto\n// https://www.shadertoy.com/view/Xl2BRR\nvec4 detritus(in vec3 ro, in vec3 rd, in float tmax) {\n\n  float d =  0.;\n\n  vec3 ros = ro + rd*d;\n  ros /= STAR_VOXEL_STEP_SIZE;\n  vec3 pos = floor(ros),\n       mm, ri = 1./rd,\n       rs = sign(rd),\n       dis = (pos - ros + 0.5 + rs * 0.5) * ri;\n\n  float dint;\n  vec3 offset, id;\n  vec4 col = vec4(0);\n  vec4 sum = vec4(0);\n\n  for(int i = 0; i < STAR_VOXEL_STEPS; i++) {\n    id = hash33(pos);\n    float size  = hash11(float(i))*.02 + .005;\n    offset = clamp(id + .2 * cos(id + id.x * time), size, 1. - size);\n    d = distanceRayPoint(ros, rd, pos + offset, dint);\n\n    if (dint > 0. && dint * STAR_VOXEL_STEP_SIZE < tmax) {\n      col = vec4(getDotColour(id.x), .8) * smoothstep(size, 0.0, d);\n      col.a *= smoothstep(float(STAR_VOXEL_STEPS), 0., dint);\n      col.rgb *= col.a / dint;\n      sum += (1. - sum.a) * col;\n      if (sum.a>.99) break;\n    }\n\n    mm = step(dis.xyz, dis.yxy) * step(dis.xyz, dis.zzx);\n    dis += mm * rs * ri;\n    pos += mm * rs;\n  }\n\n  return sum * .75;\n}\n\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  float depth = texture2D(tDepth, vUv).x;\n  float w;\n  // float logDepthBufFC = 2.0 / log2( 1000000. + 1.0 );\n  // float w = pow(2.0, (2. * depth / logDepthBufFC)) - 1.0;\n  // depth = viewZToPerspectiveDepth(-w, 1., 1000000.);\n\n  vec4 world = clipToWorldMatrix * vec4(vUv * 2. - 1., depth * 2. - 1., 1.0);\n  world /= world.w;\n  float worldDistance = length(world.xyz - cameraPosition);\n\n  vec3 dir = normalize(world.xyz - cameraPosition);\n  vec3 hitPoint = linePlaneIntersect(cameraPosition, dir, vec3(0., 0., waterLevel), vec3(0., 0., -1.));\n  float hitDirection = dot(hitPoint - cameraPosition, dir);\n  float hitDistance = hitDirection > 0. ? length(hitPoint - cameraPosition) : 1e7;\n\n  float dist = min(hitDistance, worldDistance);\n  float fogDensity = 0.007;\n  float fogFactor;\n  vec3 nearestPoint = dist == hitDistance ? hitPoint : world.xyz;\n  float waterDepth = waterLevel - nearestPoint.z;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec2 nUV = fract(hitPoint.xy / 15.);\n  vec2 flow = vec2(1., 1.);\n  vec4 normalColor0 = texture2D( tNormalMap0, nUV + flow * time / 10.);\n  vec4 normalColor1 = texture2D( tNormalMap1, nUV + flow * time / 10.);\n\n  // linear interpolate to get the final normal color\n  float flowLerp = sin(time) / 2. + 0.5;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, -normalColor.b ));\n  vec3 waterNormal = normalize(normal);\n  vec4 coord = worldToClipMatrix * vec4(hitPoint.xy + waterNormal.xy * waterNormal.z * 3., hitPoint.z, 1.0);\n  coord /= coord.w;\n  coord = coord / 2.0 + 0.5;\n  // coord.xy = vUv;\n\n  if (worldDistance < hitDistance) {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n    gl_FragColor.rgb *= caustic(nearestPoint.xy / 10.);\n  } else {\n\n    // calculate the fresnel term to blend reflection and refraction maps\n    float theta = max( dot( -dir, waterNormal ), 0.0 );\n    float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n    reflectance = (1. - length(refract(dir, waterNormal, 1.33))) * reflectance;\n    reflectance = clamp(reflectance, 0.15, 0.85);\n\n    vec4 reflectColor = texture2D( tReflectionMap, vec2(1. - coord.x, coord.y) );\n    vec4 reflectDepth = texture2D( tReflectionDepth, vec2(1.0 - coord.x, coord.y) );\n    vec4 refractColor = texture2D( tDiffuse, coord.xy );\n\n    // w = pow(2.0, (2. * reflectDepth.x / logDepthBufFC)) - 1.0;\n    // w = -perspectiveDepthToViewZ(reflectDepth.x, 1., 1000000.);\n    // reflectDepth.x = viewZToPerspectiveDepth(-w, 1., 1000000.);\n    w = 500. * reflectDepth.x + dist;\n\n    fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * w * w * LOG2 ) );\n    reflectColor.rgb = mix(reflectColor.rgb, depthColor, fogFactor);\n\n    // multiply water color with the mix of both textures\n    gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n    // gl_FragColor = vec4(vec3(reflectance), 1.0);\n    // gl_FragColor = reflectColor;\n    // gl_FragColor = reflectDepth;\n    // gl_FragColor = vec4(vec3(w/500.), 1.0);\n    // gl_FragColor = vec4(vec3(w/100.), 1.0);\n\n}\n\n// float fogDepth = dist + waterDepth * min(1., waterDepth / 100.);\nfloat fogDepth = dist + clamp(waterLevel - cameraPosition.z, 0., 100.);\nfogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\ngl_FragColor.rgb = mix(gl_FragColor.rgb, depthColor, fogFactor);\n\ngl_FragColor.rgb += GodRays(vUv) * (1. - smoothstep(0., 100., waterLevel - cameraPosition.z));\n\nvec4 star = detritus(cameraPosition, dir,  min(40., dist / STAR_VOXEL_STEP_SIZE));\ngl_FragColor.rgb = gl_FragColor.rgb * (1.0 - star.a)+star.rgb;\n\n\n// gl_FragColor = texture2D(tReflectionMap, vec2(1.0 - vUv.x, vUv.y));\n// gl_FragColor = vec4(dir, 1.);\n// gl_FragColor = vec4( vec3(dist /1000.), 1.0 );\n// gl_FragColor = vec4( vec3(hitDistance/100.), 1.0 );\n// gl_FragColor = vec4( vec3(dist/100.), 1.0 );\n\n}"},function(e,n){e.exports=" #include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\nvUv = uv;\nvCoord = textureMatrix * vec4( position, 1.0 );\n\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvToEye = cameraPosition - worldPosition.xyz;\n\nvec4 mvPosition = viewMatrix * worldPosition; // used in fog_vertex\ngl_Position = projectionMatrix * mvPosition;\n\n#include <fog_vertex>\n\n}"},function(e,n,t){e.exports=t(114)},function(e,n,t){},,,,,,function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Qzk3MDg1MDY1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Qzk3MDg1MDc1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOTcwODUwNDUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOTcwODUwNTUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Po4pkJAAAA9KSURBVHja7F0JdqMw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"},,,,,,,function(e,n,t){e.exports=t.p+"static/media/Explosion_002_Tile_8x8_256x256.d28fc70f.png"},function(e,n,t){e.exports=t.p+"static/media/smokeparticle.4939a8d2.png"},function(e,n){e.exports="data:image/png;base64,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"},function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gIBEhghhPTbNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABF0lEQVQ4y62TsU7DQBBE39opHKS4AuUrkjKlC/qUlPxcSij5A5cuyVdYSZVIGCGZoRlLF8sBJDjpdNZ6Zm92bzaYWJKW/hzOFiAi2jE2JshroAJWwNzhDtgDdUS8XiSQFBEh37oBHnzeAYVx78ABaIBnoBnUzJJkG+ARuAdKIE8UFsACuE2SvgySQ9Ja0k7SUVIv6fPK7o3ZuVRmblRlBWVy67g/cqw0tpLUZv6xcs35teYmsdzYFUBmBXPXNkWcSlSYs8z448psks5PpV9wZGwHtIOCvd+5T0BTRIw5mENmQ9Q2ySkBarSH2MnY+sLakraSnvzOHyM/9I4djdkOvNSJTWLbH638f8P0zTgvgBuH3oDz1Dh/AWVJt7banagAAAAAAElFTkSuQmCC"},,function(e,n){},,function(e,n){},,,,,,,,,,function(e,n,t){e.exports=t.p+"static/media/impact1.db06d2c4.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact2.7d720129.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact3.7a5b4e82.ogg"},function(e,n,t){e.exports=t.p+"static/media/impact4.43348926.ogg"},function(e,n,t){e.exports=t.p+"static/media/gatling.b8ff47f4.ogg"},function(e,n,t){e.exports=t.p+"static/media/missile.f0faf674.ogg"},function(e,n,t){e.exports=t.p+"static/media/explosion1.2f1ab236.ogg"},function(e,n,t){e.exports=t.p+"static/media/explosion2.752472e3.ogg"},function(e,n,t){"use strict";t.r(n);t(76);var o=t(0),a=t(58),i=t.n(a),r=t(59),l=t.n(r),s=t(14),c=t.n(s),u=t(60),d=t.n(u).a,p=function e(){var n=e.SkyShader,t=new o.Db({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o.Pb.clone(n.uniforms),side:o.g});o.W.call(this,new o.Gb(1,32,15),t)};p.prototype=Object.create(o.W.prototype),p.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new o.Rb}},vertexShader:"\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.z / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n        // extinction (absorbtion + out scattering)\n        // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n        // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }\n    ",fragmentShader:"\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float luminance;\n        uniform float mieDirectionalG;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at\n                                    // 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        // Filmic ToneMapping http://filmicgames.com/archives/75\n        const float A = 0.15;\n        const float B = 0.50;\n        const float C = 0.10;\n        const float D = 0.20;\n        const float E = 0.02;\n        const float F = 0.30;\n\n        const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\n        vec3 Uncharted2Tonemap( vec3 x ) {\n        return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n        }\n\n\n        void main() {\n        // optical length\n        // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n        // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n        // in scattering\n        float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n        // nightsky\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n        // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n        vec3 color = curr * whiteScale;\n\n        vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n        }"};var v=new o.t(16777215,4);window.dirLight=v;var m=new o.B(16777147,526368,.1);m.position.set(0,0,1),m.up.set(0,0,1),m.needsUpdate=!0;var f=new o.b(4210752,.1),g=function(){v.position.copy(v.sunPosition),v.position.normalize(),v.position.multiplyScalar(1600),v.position.add(Tt.position)};var h=t(8),w=t(61),x=t.n(w),y=t(4),b=t(62),A=t.n(b),C=t(63),D=t.n(C),z=(new o.Kb).setCrossOrigin("anonymous"),P=z.load(t(35)),M=z.load(t(36)),_=z.load(t(37)),S=z.load(t(38));P.wrapS=P.wrapT=o.zb,P.offset.set(0,0),P.repeat.set(20,20),M.wrapS=M.wrapT=o.zb,_.wrapS=_.wrapT=o.zb,S.wrapS=S.wrapT=o.zb;var k,E,R=function(e,n){var t=new o.Db({uniforms:Object(y.a)({roughness:{value:.7},metalness:{value:0}},o.Ob.common,o.Ob.lights,o.Ob.envmap,o.Ob.normalmap,o.Ob.fog,{rockTexture:{value:P},rockTextureNormal:{value:M}},n),defines:{STANDARD:"",USE_MAP:"",USE_NORMALMAP:""},vertexShader:A.a,fragmentShader:D.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return t.uniforms.map.value=_,t.uniforms.normalMap.value=S,t.roughness=.7,t.metalness=0,t.isShaderMaterial=!1,t.isMeshStandardMaterial=!0,t.uniforms.uvTransform.value=(new o.U).multiplyScalar(20),t.needsUpdate=!0,t}(),T=45.8671,U={x:(k=7.3087,E=10,(k+180)/360*Math.pow(2,E)),y:function(e,n){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n)}(T,10)};window.chamonix=U;for(var F=function(e,n){var t=n.split(",").map(function(e){return parseInt(e,10)}),o=t[0],a=t[1],i=t[2],r=t[5],l=function(e){return{x:U.x/Math.pow(2,10-e),y:U.y/Math.pow(2,10-e)}}(o);e.position.set(a*r-(l.x%1-.5)*r-800*(1-U.x%1),-i*r+(l.y%1-.5)*r+800*(1-U.y%1),0)},N=function(e){if(e.data.stats)return n=e.data,Mt.userData.wasm=(Mt.userData.wasm||0)+n.wasm,Mt.userData.js=(Mt.userData.js||0)+n.js,void console.log(n.wasm,n.js,Mt.userData);var n,t=new o.m,a=new Float32Array(e.data.positions),i=new Float32Array(e.data.normals),r=new Float32Array(e.data.uvs),l=new(0,{2:Uint16Array,4:Uint32Array}[e.data.bpe.indices])(e.data.indices);t.addAttribute("position",new o.l(a,3)),t.addAttribute("normal",new o.l(i,3)),t.addAttribute("uv",new o.l(r,2)),t.setIndex(new o.l(l,1)),t.computeBoundingSphere(),t.computeBoundingBox();var s=new o.W(t,R);s.key=e.data.key,s.name="terrainTile",s.castShadow=!0,s.receiveShadow=!0,F(s,e.data.key),Mt.add(s),St.shadowMap.needsUpdate=!0},I=[],L=navigator.hardwareConcurrency-1||3,W=0;W<L;W++){var O=new x.a;O.onmessage=N,I.push(O)}var B=0;I.postMessage=function(e){I[B].postMessage(e),B=B===L-1?0:B+1};var V=new o.Rb(0,0,0),j=[];window.tiles={},window.pngs={};var G=function(e){Mt.remove(e),e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null},H=new o.Rb,Z=function(e){var n=_t.position;H=_t.getWorldDirection(H);var t=n.clone();if(t=t.add(H.multiplyScalar(400*Math.max(1,Math.abs(n.z)/400))),Tt.position.set(t.x,t.y,200),v.updatePosition(),n.distanceTo(V)>10){V=n.clone();var a,i=Math.min(7,Math.floor(Math.sqrt(Math.abs(n.z))/28)),r=10-i,l=800*Math.pow(2,i),s=Math.round(t.x/l),c=-Math.round(t.y/l),u=n.z>2e3?127:255,d=n.z>2e3?31:63,p=3*l,m=new o.Rb,f=new o.Rb,g=new o.Rb,w=[[r,s-2,c-2,15,0,l],[r,s-2,c-1,15,0,l],[r,s-2,c-0,15,0,l],[r,s-2,c+1,15,0,l],[r,s-2,c+2,15,0,l],[r,s-2,c+3,15,0,l],[r,s+3,c-2,15,0,l],[r,s+3,c-1,15,0,l],[r,s+3,c-0,15,0,l],[r,s+3,c+1,15,0,l],[r,s+3,c+2,15,0,l],[r,s+3,c+3,15,0,l],[r,s-1,c-2,15,0,l],[r,s-1,c+3,15,0,l],[r,s,c-2,15,0,l],[r,s,c+3,15,0,l],[r,s+1,c-2,15,0,l],[r,s+1,c+3,15,0,l],[r,s+2,c-2,15,0,l],[r,s+2,c+3,15,0,l],[r,s-1,c-1,d,0,l],[r,s-1,c-0,d,0,l],[r,s-1,c+1,d,0,l],[r,s-1,c+2,d,0,l],[r,s+2,c-1,d,0,l],[r,s+2,c-0,d,0,l],[r,s+2,c+1,d,0,l],[r,s+2,c+2,d,0,l],[r,s,c-1,d,0,l],[r,s,c+2,d,0,l],[r,s+1,c-1,d,0,l],[r,s+1,c+2,d,0,l],[r,s,c,u,0,l],[r,s,c+1,u,0,l],[r,s+1,c,u,0,l],[r,s+1,c+1,u,0,l]],x=w.map(function(e){return e.toString()}),y=j.map(function(e){return e.toString()}),b=x.slice(-5),A=Mt.children.filter(function(e){return b.includes(e.key)}),C=function(e){return m.subVectors(e.position,_t.position).length()};A.sort(function(e,n){return C(e)-C(n)}),_t.userData.terrainKeysUnder=b,_t.userData.terrainTileUnder=A[0];var D=x.filter(function(e){return y.indexOf(e)<0}),z=Mt.children.filter(function(e){return e.key}).map(function(e){return e.key});D.forEach(function(e){if(!z.includes(e)){var n=e.split(",").map(function(e){return parseInt(e,10)});(function(e,n,t,o,a,i){I.postMessage([e,n,t,o,a,i])}).apply(void 0,Object(h.a)(n))}}),Mt.children.filter(function(e){return e.key}).forEach(function(e){a=m.subVectors(g.set(e.position.x,e.position.y,0),f.set(_t.position.x,_t.position.y,0)).length(),e.userData.distanceToCamera=a,a<p&&x.includes(e.key)?e.visible=!0:window.setTimeout(function(){e.visible=!1},750)}),Mt.children.filter(function(e){return e.key}).sort(function(e,n){return e.userData.distanceToCamera-n.userData.distanceToCamera}).slice(128).forEach(function(e){e.markedForDeletion||(window.setTimeout(function(){return G(e)},750),e.markedForDeletion=!0)}),j=w.slice(0)}};Z.clean=function(){Mt.children.filter(function(e){return"terrainTile"===e.name}).forEach(function(e){return G(e)}),j=[],V=new o.Rb(0,0,0)};var Q=t(64),Y=t.n(Q),X=t(65),K=t.n(X),q=(new o.Kb).setCrossOrigin("anonymous"),J=q.load(t(35)),$=q.load(t(36)),ee=q.load(t(37)),ne=q.load(t(38));J.wrapS=J.wrapT=o.bb,J.offset.set(0,0),J.repeat.set(20,20),$.wrapS=$.wrapT=o.bb,ee.wrapS=ee.wrapT=o.bb,ne.wrapS=ne.wrapT=o.bb;var te=0,oe=0,ae=-175,ie=t(66),re=t.n(ie),le=function(e,n){var t=new o.Db({uniforms:Object(y.a)({roughness:{value:.7},metalness:{value:0}},o.Ob.common,o.Ob.lights,o.Ob.envmap,o.Ob.normalmap,o.Ob.fog,{rockTexture:{value:J},rockTextureNormal:{value:$}},n),defines:{STANDARD:"",USE_MAP:"",USE_NORMALMAP:""},vertexShader:Y.a,fragmentShader:K.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return t.uniforms.map.value=ee,t.uniforms.normalMap.value=ne,t.roughness=.7,t.metalness=0,t.normalScale=new o.Qb(1,1),t.isShaderMaterial=!1,t.isMeshStandardMaterial=!0,t.uniforms.uvTransform.value=(new o.U).multiplyScalar(20),t.needsUpdate=!0,t}(),se=new Set;window.emptyKeys=se;for(var ce=function(e){var n=[e.data.i,e.data.j,e.data.k];if(e.data.hasGeometry){var t=new Float32Array(e.data.pos1),a=new Float32Array(e.data.normals1),i=new Uint16Array(e.data.index1),r=new o.m;r.addAttribute("position",new o.l(t,3)),r.addAttribute("normal",new o.l(a,3)),r.setIndex(new o.l(i,1));var l=new o.W(r,le);l.position.set(500*e.data.i+te,500*e.data.j+oe,500*e.data.k+ae),l.userData.key=n;var s=new o.k(l,16776960);l.name="terrainVoxel",s.name="terrainVoxelHelper",Mt.add(s),Mt.add(l)}else se.add(n.toString())},ue=[],de=navigator.hardwareConcurrency-1||3,pe=0;pe<de;pe++){var ve=new re.a;ve.onmessage=ce,ue.push(ve)}var me=0;ue.postMessage=function(e){ue[me].postMessage(e),me=me===de-1?0:me+1};var fe,ge=new o.Rb(0,0,0),he=[];window.currentKeys=he;var we=function(e){var n=_t.position;if(n.distanceTo(ge)>10){ge=n.clone();var t=Math.floor(n.x/500+.5),a=Math.floor(n.y/500+.5);console.log("camera centered on tile ",t,a);var i=[];(new o.z).setFromMatrix((new o.V).multiplyMatrices(_t.projectionMatrix,_t.matrixWorldInverse));for(var r=0;r<3;r++)for(var l=0;l<3;l++)for(var s=0;s<2;s++)i.push([r-Math.floor(1)+t,l-Math.floor(1)+a,s]);i.forEach(function(e){fe=e.toString(),se.has(fe)||he.includes(fe)||(he.push(fe),console.log("build",e),function(e,n,t){ue.postMessage([e,n,t,2])}.apply(void 0,Object(h.a)(e)))});var c,u=new o.Rb,d=new o.Rb,p=new o.Rb;Mt.children.filter(function(e){return e.userData.key}).forEach(function(e){c=u.subVectors(d.set(_t.position.x,_t.position.y,0),p.set(e.position.x,e.position.y,0)).length();var n=500*Math.ceil(1.5)*1.1;e.visible=c<n})}};we.clean=function(){Mt.children.filter(function(e){return["terrainVoxel","terrainVoxelHelper"].includes(e.name)}).forEach(function(e){return function(e){Mt.remove(e),e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null}(e)}),he=[],ge=new o.Rb(0,0,0)};var xe=t(10),ye=t.n(xe),be=[Z,we],Ae=0;ye.a.bind("t",function(e){console.log("switch terrain"),be[Ae].clean(),Ae=Ae===be.length-1?0:Ae+1,console.log("switch terrain done")});var Ce=t(40),De=(t(41),t(30)),ze=t(16),Pe=(t(17),t(42)),Me=(t(43),t(7)),_e=(t(44),t(45),t(46)),Se=t(18),ke=t(47),Ee=(t(48),t(57)),Re=t(6),Te=(new o.Kb).load(t(82)),Ue=new De.a;Ue.addElement(new De.b(Te,60,.6)),Ue.addElement(new De.b(Te,70,.7)),Ue.addElement(new De.b(Te,120,.9)),Ue.addElement(new De.b(Te,70,1));var Fe=Ue,Ne={uniforms:{tDepth:{type:"t",value:null},tColor:{type:"t",value:null},velocityFactor:{type:"f",value:1},delta:{type:"f",value:16.67},clipToWorldMatrix:{type:"m4",value:new o.V},worldToClipMatrix:{type:"m4",value:new o.V},previousWorldToClipMatrix:{type:"m4",value:new o.V},cameraMove:{type:"v3",value:new o.Rb},cameraPosition:{type:"v3",value:new o.Rb}},vertexShader:"\n  varying vec2 vUv;\n\n  void main() {\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n\n  }",fragmentShader:"\n  varying vec2 vUv;\n\n  uniform sampler2D tDepth;\n  uniform sampler2D tColor;\n\n  uniform mat4 clipToWorldMatrix;\n  uniform mat4 worldToClipMatrix;\n  uniform mat4 previousWorldToClipMatrix;\n\n  uniform vec3 cameraMove;\n\n  uniform float velocityFactor;\n  uniform float delta;\n\n  void main() {\n\n    float zOverW = texture2D(tDepth, vUv).x;\n\n    // clipPosition is the viewport position at this pixel in the range -1 to 1.\n    vec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n    vec4 worldPosition = clipToWorldMatrix * clipPosition;\n    worldPosition /= worldPosition.w;\n\n    vec4 previousWorldPosition = worldPosition;\n    previousWorldPosition.xyz -= cameraMove;\n\n    vec4 previousClipPosition = previousWorldToClipMatrix * worldPosition;\n    previousClipPosition /= previousClipPosition.w;\n    vec4 translatedClipPosition = worldToClipMatrix * previousWorldPosition;\n    translatedClipPosition /= translatedClipPosition.w;\n\n    vec2 velocity = velocityFactor * (clipPosition - previousClipPosition).xy / delta * 16.67;\n    velocity *= clamp(length(worldPosition.xyz - cameraPosition) / 1000., 0., 1.);\n    velocity += velocityFactor * (clipPosition - translatedClipPosition).xy / delta * 16.67;\n\n    vec4 finalColor = vec4(0.);\n    vec2 offset = vec2(0.);\n    float weight = 0.;\n    const int samples = 20;\n    for(int i = 0; i < samples; i++) {\n      offset = velocity * (float(i) / (float(samples) - 1.) - .5);\n      finalColor += texture2D(tColor, vUv + offset);\n    }\n    finalColor /= float(samples);\n    gl_FragColor = vec4(finalColor.rgb, 1.);\n\n    // debug: view velocity values\n    // gl_FragColor = vec4(abs(velocity), 0., 1.);\n\n    // debug: view depth buffer\n    // gl_FragColor = vec4(vec3(clamp(length(worldPosition.xyz - cameraPosition) / 1000., 0., 1.)), 1.);\n  }"},Ie=(new o.V,new o.Rb,new o.Rb,t(27)),Le=t(2),We=t.n(Le),Oe=t(12),Be=t(13),Ve=t(26),je=t(24),Ge=t(25),He=t(1),Ze=t.n(He),Qe=t(67),Ye=t.n(Qe),Xe=t(68),Ke=t.n(Xe);var qe,Je,$e,en=function(e){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=e.clone(),o=window.innerWidth/2,a=window.innerHeight/2;return t.project(_t),t.x=t.x*o,t.y=-t.y*a,n||(t.x+=o,t.y+=a),t}(e);return{x:Math.min(Math.max(10,n.x),window.innerWidth-10),y:Math.min(Math.max(10,n.y),window.innerHeight-10),z:n.z}},nn=function(e,n,t){return Math.min(Math.max(e,n),t)},tn=function(e){function n(){return Object(Oe.a)(this,n),Object(Ve.a)(this,Object(je.a)(n).apply(this,arguments))}return Object(Ge.a)(n,e),Object(Be.a)(n,[{key:"render",value:function(){return Ze.a.createElement("svg",{x:this.props.x-this.props.size/2,y:this.props.y-this.props.size/2,viewBox:"-10 -10 415 415",width:this.props.size,height:this.props.size},Ze.a.createElement("g",this.props,Ze.a.createElement("circle",{cx:"202.224",cy:"202.228",r:"26.686"}),Ze.a.createElement("path",{d:"M83.807,49.322L50.87,4.891c-9.519-9.527-30.71-3.78-40.236,5.747S-4.64,41.347,4.887,50.874 l44.431,32.937c9.519,9.519,24.963,9.527,34.49,0C93.334,74.284,93.326,58.84,83.807,49.322z"}),Ze.a.createElement("path",{d:"M393.823,10.638c-9.527-9.527-30.71-15.274-40.236-5.747l-32.937,44.431 c-9.527,9.527-9.527,24.963,0,34.49c9.527,9.527,24.963,9.519,34.49,0l44.431-32.937 C409.096,41.347,403.349,20.164,393.823,10.638z"}),Ze.a.createElement("path",{d:"M355.139,320.645c-9.527-9.527-24.963-9.527-34.49,0c-9.527,9.527-9.527,24.963,0,34.49 l32.937,44.431c9.527,9.519,30.71,3.78,40.236-5.747s15.274-30.71,5.747-40.236L355.139,320.645z"}),Ze.a.createElement("path",{d:"M49.318,320.645L4.887,353.582c-9.527,9.527-3.78,30.71,5.747,40.236s30.71,15.274,40.236,5.747 l32.937-44.431c9.527-9.519,9.527-24.963,0-34.49C74.28,311.127,58.844,311.127,49.318,320.645z"})))}}]),n}(He.PureComponent),on=new o.Qb(window.innerWidth/2,window.innerHeight/2);d.subscribe("x.screen.resized",function(e,n){on=new o.Qb(n.width/2,n.height/2)});var an={targets:new Set,targetsInSight:new Set,targetsInFront:new Set,gunTarget:null},rn=function(e){function n(e){var t;return Object(Oe.a)(this,n),(t=Object(Ve.a)(this,Object(je.a)(n).call(this,e))).state={gunHeat:0,lockLevel:0,pilot:null},t}return Object(Ge.a)(n,e),Object(Be.a)(n,[{key:"componentDidMount",value:function(){d.publish("x.hud.mounted")}},{key:"gunHeat",value:function(){if(!qe||!qe.gunClock.running)return Math.max(0,this.state.gunHeat-.01);var e=qe.gunClock.getDelta(),n=this.state.gunHeat+e/1.5;return n>=1&&(d.publish("x.drones.gun.stop",qe),d.publish("x.camera.shake.stop"),qe.gunClock.stop()),Math.min(n,1)}},{key:"lockLevel",value:function(){var e=this;if(0===an.targetsInSight.size)return Math.max(0,this.state.lockLevel-.02);var n=[];return an.targetsInSight.forEach(function(t){var o=t.lockClock.getDelta();n.push(e.state.lockLevel+o/2)}),Math.min(Math.max.apply(Math,n),1)}},{key:"update",value:function(e){var n=this.gunHeat(),t=this.lockLevel();this.setState(Object(y.a)({},e,{gunHeat:n,lockLevel:t,lock:1===t,pilot:qe?qe.userData:null}))}},{key:"render",value:function(){var e=this,n=Array.from(an.targets),t=n.map(function(e){return Object.assign(Ke()(e.userData),{id:e.id})});return Ze.a.createElement("div",null,Ze.a.createElement("div",{id:"limiter"}),Ze.a.createElement("div",{id:"pointer"}),Ze.a.createElement("div",{id:"focal",style:this.state.focalStyle}),Ze.a.createElement("div",{id:"horizon",style:this.state.horizonStyle}),this.state.pilot?Ze.a.createElement("div",{id:"messages"},Ze.a.createElement("div",null,this.state.pilot.altitude.toFixed(0)," m"),Ze.a.createElement("div",null,this.state.pilot.speed.toFixed(0)," m/s")):null,Ze.a.createElement("svg",{className:"vector"},Ze.a.createElement(tn,{size:"30",x:on.x,y:on.y,fill:"transparent",stroke:"#0f0",strokeWidth:"17",opacity:"0.8"}),Ze.a.createElement("circle",{cx:on.x,cy:on.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",transform:"rotate(155 ".concat(on.x," ").concat(on.y,")"),strokeLinecap:"round"}),this.state.lockLevel?Ze.a.createElement("circle",{cx:on.x,cy:on.y,r:160,stroke:"#0f0",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.lockLevel," 1000"),transform:"rotate(155 ".concat(on.x," ").concat(on.y,")"),strokeLinecap:"round"}):null,Ze.a.createElement("circle",{cx:on.x,cy:on.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",strokeLinecap:"round",transform:"rotate(205 ".concat(on.x," ").concat(on.y,") translate(").concat(2*on.x,", 0) scale(-1, 1)")}),this.state.gunHeat?Ze.a.createElement("circle",{cx:on.x,cy:on.y,r:160,stroke:"orange",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.gunHeat," 1000"),strokeLinecap:"round",transform:"rotate(205 ".concat(on.x," ").concat(on.y,") translate(").concat(2*on.x,", 0) scale(-1, 1)")}):null,n.map(function(n){return n.gunHud?Ze.a.createElement("g",{key:n.id},Ze.a.createElement("path",{d:"M ".concat(n.hudPosition.x," ").concat(n.hudPosition.y,"\n                    l ").concat(n.direction.x," ").concat(n.direction.y),strokeWidth:"1",stroke:n===e.state.gunTarget?"#0f0":"orange",fill:"transparent"}),n===e.state.gunTarget?Ze.a.createElement(tn,{size:"30",x:n.hudPosition.x+n.direction.x,y:n.hudPosition.y+n.direction.y,fill:"#0f0",fillOpacity:"0.6",stroke:"#0f0",strokeWidth:"17",strokeOpacity:"1"}):null):null})),Ze.a.createElement("div",{id:"targets"},t.map(function(e){return Ze.a.createElement("div",{className:"target",key:e.id,id:"target-"+e.id,style:e.hud.element.style},Ze.a.createElement("div",{className:"life",style:{width:e.life/100*20}}),Ze.a.createElement("div",{className:"arrow",style:e.hud.arrow.style}),Ze.a.createElement("div",{className:"distance"},e.hud.distance.innerHTML),Ze.a.createElement("div",{className:"name"},"drone-",e.id))})))}}]),n}(He.Component);d.subscribe("x.hud.register.target",function(e,n){var t,a,i,r,l,s;an.targets.add(n),n.userData.hud={element:{style:{}},arrow:{style:{}},distance:{style:{}}};var c=function(e,c){fn.mounted&&((t=en(n.position)).z>1?(t.x=window.innerWidth-t.x,t.y=window.innerHeight-10,n.userData.hud.element.style.borderColor="red",n.userData.hud.arrow.style.borderBottomColor="red"):(n.userData.hud.element.style.borderColor="orange",n.userData.hud.arrow.style.borderBottomColor="orange"),n.hudPosition=t,r=new o.Qb(t.x,t.y).sub(on),n.userData.hudPositionCentered=r,r.length()>400&&r.normalize().multiplyScalar(400),n.userData.hud.arrow.style.opacity=.8*(1-(400-r.length())/50),l=_t.position.clone().sub(n.position),i=l.length(),n.userData.distance=i,n.userData.hud.distance.innerHTML=i.toFixed(0),n.userData.hud.distance.style.color=i<500?"#0f0":"orange",n.userData.hud.element.style.transform="\n      translateX(".concat(r.x+on.x,"px)\n      translateY(").concat(r.y+on.y,"px)\n      scale(").concat(1.1-Math.min(.2,i/2e3),")\n    "),n.userData.hud.arrow.style.transform="\n      translateY(2px)\n      rotate(".concat(r.angle()/Math.PI*180+90,"deg)\n    "),a=r.length(),!n.destroyed&&"orange"===n.userData.hud.element.style.borderColor&&a<150?(n.userData.hud.arrow.style.borderBottomColor="#0f0",an.targetsInSight.add(n),n.lockClock.running||n.lockClock.start()):(an.targetsInSight.delete(n),n.lockClock.stop()),!n.destroyed&&a<390?an.targetsInFront.add(n):an.targetsInFront.delete(n),t.z<=1&&a<320?(s=en(n.position.clone().add(n.velocity.clone().multiplyScalar(Math.min(1,(i+l.clone().add(n.velocity).length())/2/500)))),n.gunHud=!0,n.direction={x:s.x-(r.x+on.x),y:s.y-(r.y+on.y)}):n.gunHud=!1,n.ready=!0)};c.id=n.id;d.subscribe("x.drones.destroy",function(e,t){t.id===n.id&&(Mt.remove(t),d.publish("x.loops.remove",c),an.targets.delete(t),an.targetsInSight.delete(n),fn.forceUpdate())}),d.publish("x.loops.push",c)});var ln,sn,cn,un,dn,pn=new o.Rb,vn=function(e){ln=new o.Rb(1,0,0).applyQuaternion(_t.quaternion),sn=new o.Rb(0,1,0).applyQuaternion(_t.quaternion),cn=Math.PI/2-_t.up.angleTo(ln)*Math.sign(_t.up.dot(sn)),_t.rollAngle=cn,un=_t.up.dot(_t.getWorldDirection(pn)),dn=cn/Math.PI*180,Je={transform:"translateX(-50%) translateY(".concat(un*window.innerHeight/2,"px) rotate(").concat(dn,"deg)")},$e=fn.state.lock?{boxShadow:"0 0 75px #0f0"}:{boxShadow:""},an.gunTarget=mn(),fn.update({horizonStyle:Je,focalStyle:$e,gunTarget:an.gunTarget})};d.subscribe("x.hud.mounted",function(){d.publish("x.loops.push",vn),fn.mounted=!0}),d.subscribe("x.drones.pilotDrone.loaded",function(e,n){qe=n.pilotDrone}),d.subscribe("x.drones.missile.start",function(e,n){fn.setState(function(e){return Object(y.a)({},e,{lockLevel:0,lock:!1})})});var mn=function(){if(0===an.targetsInSight.size)return null;var e=[];return an.targetsInSight.forEach(function(n){return e.push([new o.Qb(n.hudPosition.x,n.hudPosition.y).sub(on).add(new o.Qb(n.direction.x,n.direction.y)).length(),n])}),e.sort(function(e,n){return e[0]>n[0]}),e[0][1]},fn=Ye.a.render(Ze.a.createElement(rn,null),document.getElementById("hud")),gn=new o.Kb,hn={texture:{value:gn.load(t(89)),frames:new o.Qb(8,8),loop:1},depthTest:!0,depthWrite:!1,blending:o.a,scale:600,maxParticleCount:25e3},wn={texture:{value:gn.load(t(90))},depthTest:!0,depthWrite:!1,blending:o.fb,maxParticleCount:25e3},xn={texture:{value:gn.load(t(91))},depthTest:!0,depthWrite:!1,blending:o.fb,maxParticleCount:25e3},yn={texture:{value:gn.load(t(92))},depthTest:!0,depthWrite:!1,blending:o.fb,maxParticleCount:25e3},bn={particleCount:200,type:We.a.distributions.DISC,position:{radius:5,spread:new o.Rb(5)},maxAge:{value:2,spread:0},duration:1,activeMultiplier:2e3,velocity:{value:new o.Rb(40)},rotation:{axis:new o.Rb(0,0,1),angle:.5*Math.PI,static:!0},size:{value:2},color:{value:[new o.p(.4,.2,.1),new o.p(.2,.2,.2)]},opacity:{value:[.5,.2,0]}},An={particleCount:100,type:We.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:2},duration:1,activeMultiplier:40,velocity:{value:new o.Rb(100)},acceleration:{value:new o.Rb(0,0,-20),distribution:We.a.distributions.BOX},wiggle:3,size:{value:2,spread:5},angle:{spread:2*Math.PI},drag:{value:1},color:{value:[new o.p(1,1,1),new o.p(1,1,0),new o.p(1,0,0),new o.p(.4,.2,.1)]},opacity:{value:[1,1,0]}},Cn={particleCount:20,type:We.a.distributions.SPHERE,position:{radius:5},maxAge:{value:2},duration:1,activeMultiplier:20,velocity:{value:new o.Rb(10)},size:{value:[20,100]},color:{value:[new o.p(.5,.1,.05),new o.p(.2,.2,.2)]},opacity:{value:[.5,.35,.1,0]}},Dn={particleCount:100,position:{spread:new o.Rb(15,15,15),distribution:We.a.distributions.SPHERE},maxAge:{value:2},duration:1,activeMultiplier:2e3,velocity:{value:new o.Rb(8,3,10),distribution:We.a.distributions.SPHERE},size:{value:40},color:{value:new o.p(.2,.2,.2)},opacity:{value:[0,0,.4,0]}},zn={duration:1,particleCount:50,position:{spread:new o.Rb(5,5,5)},velocity:{spread:new o.Rb(30),distribution:We.a.distributions.SPHERE},size:{value:[40,20,20,20]},maxAge:{value:2},activeMultiplier:2e3,opacity:{value:[1,1,0,0]}},Pn={particleCount:1e3,position:{spread:new o.Rb(1,1,1)},maxAge:{value:10},velocity:{value:new o.Rb(4,2,5),distribution:We.a.distributions.SPHERE},size:{value:[20,60]},color:{value:new o.p(.9,.9,.9)},opacity:{value:[.4,.4,.4,0]}},Mn={particleCount:1e3,position:{spread:new o.Rb(1,1,1)},maxAge:{value:5},velocity:{value:new o.Rb(4,2,5),distribution:We.a.distributions.SPHERE},size:{value:[5,10]},color:{value:new o.p(1,1,1)},opacity:{value:[.4,.4,.4,0]}},_n={particleCount:35,type:We.a.distributions.BOX,position:{radius:.1},maxAge:{value:1},duration:null,activeMultiplier:1,velocity:{value:new o.Rb(100),spread:new o.Rb(20,20,20)},acceleration:{value:0},size:{value:1},color:{value:[new o.p(1,1,1),new o.p(1,1,0)]},opacity:{value:1}},Sn={particleCount:10,type:We.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:.3},duration:.3,activeMultiplier:1e3,velocity:{value:new o.Rb(100)},acceleration:{value:0},wiggle:30,size:{value:[3,1,.5]},color:{value:[new o.p(1,1,1),new o.p(1,1,0)]},opacity:{value:1}},kn=new We.a.Group(hn),En=new We.a.Group(hn),Rn=new We.a.Group(xn),Tn=new We.a.Group(wn),Un=new We.a.Group(wn),Fn=new We.a.Group(wn),Nn=new We.a.Group(wn),In=new We.a.Group(yn),Ln=new We.a.Group(xn);kn.addPool(25,zn,!1),En.addPool(25,Cn,!1),Rn.addPool(25,An,!1),Tn.addPool(25,bn,!1),Un.addPool(25,Dn,!1),Fn.addPool(25,Pn,!1),Nn.addPool(25,Mn,!1),In.addPool(25,_n,!1),Ln.addPool(25,Sn,!1);var Wn=[kn,En,Rn,Tn,Un,Fn,Nn,In,Ln];Wn.forEach(function(e){e.mesh.renderOrder=2}),Fn.mesh.renderOrder=1,Wn.forEach(function(e){e.mesh.frustumCulled=!1}),window.smokeGroup=Fn;var On=new o.Rb,Bn=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.getFromPool();if(null!==r){var l,s,c,u,p,v;r.position.value=i?n.position.clone().add(_t.getWorldDirection(On).multiplyScalar(5)):n.position.clone(),a&&(r.velocity.value=a());var m=new o.Rb,f=function(e){return function(n,t,o){var a=Math.floor(o/e);return n[a]||(n[a]=[]),n[a].push(t),n}},g={loop:function(e,t){r.position.value=i?n.position.clone().add(_t.getWorldDirection(On).multiplyScalar(5)):n.position.clone(),a&&(r.velocity.value=a(),l=r.attributes.position.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(f(3),[]),c=r.attributes.velocity.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(f(3),[]),s=r.paramsArray.slice(4*r.attributeOffset,4*r.activationEnd).reduce(f(4),[]),u=s.map(function(e,n){return e[0]?Object(Ie.a)(o.Rb,Object(h.a)(l[n])).add(Object(Ie.a)(o.Rb,Object(h.a)(c[n])).multiplyScalar(e[1])):null}),p=[],u.forEach(function(e,n){null!==e&&an.targetsInFront.forEach(function(a){v=new o.J(e,e.clone().add(Object(Ie.a)(o.Rb,Object(h.a)(c[n])).multiplyScalar(t/1e3))),v.closestPointToPoint(a.position,!0,m).sub(a.position).length()<10&&p.push([a,e])})}),p.length&&p.forEach(function(e){d.publish("x.sound.impact",e[0]),jn({position:e[1]}),e[0].userData.life-=5}))},alive:!0,id:n.id};return t&&!n.destroyed&&(d.publish("x.loops.push",g),d.subscribe("x.drones.destroy",function(t,o){o.id===n.id&&(g.alive=!1,r.disable(),e.releaseIntoPool(r))})),r.loop=g,r.enable(),r.duration&&setTimeout(function(){r.disable(),t&&(g.alive=!1),e.releaseIntoPool(r)},1e3*(r.duration+r.maxAge.value+r.maxAge.spread)),r}console.log("SPE.Group pool ran out.")},Vn=function(e){Bn(kn,e),Bn(En,e),Bn(Rn,e),Bn(Un,e)};d.subscribe("x.drones.explode",function(e,n){return Vn(n)});d.subscribe("x.drones.smoke.start",function(e,n){var t;(t=n).smoking||(t.smoking=!0,Bn(Fn,t,!0))});d.subscribe("x.drones.missile.start",function(e,n){return function(e){if(!e.smoking){e.smoking=!0;var n=Bn(Nn,e,!0);d.subscribe("x.drones.missile.stop",function(e,t){n.loop.alive=!1,n.disable(),Nn.releaseIntoPool(n)})}}(n)});var jn=function(e){Bn(Ln,e)},Gn=new o.Rb,Hn=new o.Rb;d.subscribe("x.drones.gun.start",function(e,n){var t=mn();n.gunEmitter=Bn(In,n,!0,function(){if(null!==t&&t.gunHud)Gn.copy(t.position).sub(n.position),Gn.add(t.velocity.clone().multiplyScalar(Gn.length()/500)),Gn.normalize().multiplyScalar(500),Hn.copy(Gn);else{Hn=_t.getWorldDirection(On).multiplyScalar(500);var e=new o.Rb(0,1,0).applyQuaternion(_t.quaternion);Hn=Hn.add(e.multiplyScalar(24))}return Hn},!0)}),d.subscribe("x.drones.gun.stop",function(e,n){n.gunEmitter&&(n.gunEmitter.loop.alive=!1,n.gunEmitter.disable(),In.releaseIntoPool(n.gunEmitter))});var Zn,Qn=new Ce.a,Yn=function(){Qn.load("./assets/drone/scene.gltf",function(e){for(Zn=e.scene.children[0];Zn.children&&"Mesh"!==Zn.type;)Zn=Zn.children[0];d.publish("x.assets.drone.loaded",{mesh:Zn})})},Xn={ready:!1},Kn=function(e,n){(Xn=function(){var e=n.mesh.clone();return e.up.set(0,0,1),e.rotation.x=0,e.scale.set(.1,.1,.1),e.name="drone-".concat(e.id),e}).ready=!0,d.publish("x.drones.factory.ready")};d.subscribe("x.assets.drone.loaded",Kn);d.subscribe("x.drones.factory.ready",function(){var e,n,t,a=Xn();a.gunClock=new o.o(!1),a.userData.altitude=NaN,a.userData.speed=0,a.userData.lastPosition=a.position.clone(),a.layers.enable(1),Mt.add(a),window.pilotDrone=a;var i,r=new o.Rb,l=new o.yb,s=new o.Rb(0,0,-1),c=new o.Rb(0,0,100),u=0;jt.push(function(p,v){r=_t.getWorldDirection(r),n=_t.position.clone().add(r.multiplyScalar(20)),e=new o.Rb(0,1,0).applyQuaternion(_t.quaternion),t=n.sub(e.multiplyScalar(8)),a.position.copy(t),a.lookAt(n.add(r).add({x:0,y:0,z:60})),a.userData.velocity=a.position.clone().sub(a.userData.lastPosition).multiplyScalar(1e3/v),a.userData.speed=a.userData.velocity.length(),a.userData.lastPosition.copy(a.position),p-u>200&&(u=p,l.set(a.position.clone().add(c),s),(i=l.intersectObjects(_t.userData.terrainTileUnder?[_t.userData.terrainTileUnder]:[])).length>0&&(a.userData.altitude=i[0].distance-c.length(),a.userData.groundNormal=i[0].face.normal),a.userData.altitude<5&&(d.publish("x.drones.explode.pilotDrone",a),d.publish("x.drones.collision.terrain.pilotDrone",a.userData.groundNormal)))}),d.publish("x.drones.pilotDrone.loaded",{pilotDrone:a})});var qn=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Xn();t.lockClock=new o.o(!1),t.userData.life=100,Mt.add(t),t.lastPosition=t.position.clone();var a=new o.Rb,i=function(o,i){if(t){e?t.position.set(300*Math.cos(o/1e3/3+n),300*Math.sin(o/1e3/3+n),300+50*Math.cos(o/1e3+n)):t.position.copy(_t.position.clone().add(_t.getWorldDirection(a).multiplyScalar(100))),t.velocity=t.position.clone().sub(t.lastPosition).multiplyScalar(1e3/i),t.lastPosition=t.position.clone(),!t.destroyed&&t.userData.life<=50&&d.publish("x.drones.smoke.start",t),!t.destroyed&&t.userData.life<=0&&(d.publish("x.drones.destroy",t),t.destroyed=!0,Vn(t))}};d.subscribe("x.drones.destroy",function(e,n){n.id===t.id&&d.publish("x.loops.remove",i)}),d.publish("x.hud.register.target",t),jt.push(i)};d.subscribe("x.drones.factory.ready",function(){qn(!0),qn(!0,Math.PI/8),qn(!0,Math.PI/4),qn(!0,Math.PI/2),qn(!0,Math.PI)}),d.subscribe("x.drones.destroy",function(){return qn(!0,2*Math.random()*Math.PI)});var Jn=Yn,$n=t(69),et=t.n($n),nt=t(70),tt=t.n(nt);function ot(e,n,t,a){var i=this;if(this.object=e,this.domElement=void 0!==n?n:document,n&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=.1,this.rollSpeed=.001,this.dragToLook=!1,this.autoForward=!1,this.nipple=t,this.nipple&&(this.nipple.on("move",function(e,n){return i.nipplemove(e,n)}),this.nipple.on("end",function(e,n){i.autoForward=!1,i.updateMovementVector()})),this.acceleration=100,this.velocity=new o.Rb(0,0,0),this.pointer=a,this.pointer){var r=document.getElementById("pointer");this.zone=400,this.pointer.on("attain",function(e){var n=i.getContainerDimensions().size;r.style.left=n[0]/2+"px",r.style.top=n[1]/2+"px";var t=new o.Qb(0,0);e.on("data",function(e){t.add(new o.Qb(e.dx,e.dy)),t.length()>i.zone&&t.normalize().multiplyScalar(i.zone),r.style.transform="\n          translateX(".concat(t.x-16,"px)\n          translateY(").concat(t.y-16,"px)\n        "),i.mousemove({pageX:t.x/1.5,pageY:t.y/1.5})}),e.on("close",function(){})})}function l(e,n){return function(){n.apply(e,arguments)}}function s(e){e.preventDefault()}this.nipplemove=function(e,n){var t={pageX:n.distance*Math.cos(n.angle.radian)*1.5,pageY:-n.distance*Math.sin(n.angle.radian)*1.5};this.mousemove(t),this.autoForward=!0,this.updateMovementVector()},this.tmpQuaternion=new o.sb,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new o.Rb(0,0,0),this.rotationVector=new o.Rb(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.yawLeft=1;break;case 68:this.moveState.yawRight=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.yawLeft=0;break;case 68:this.moveState.yawRight=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousemove=function(e){var n=this.getContainerDimensions(),t=n.size[0]/2,o=n.size[1]/2;this.moveState.yawLeft=-e.pageX/t,this.moveState.rollLeft=this.moveState.yawLeft/2-this.object.rollAngle/5,this.moveState.pitchDown=e.pageY/o},this.deltaVelocity=null,this.deltaPosition=null,this.update=function(e){var n=e*i.rollSpeed;i.deltaVelocity=i.moveVector.clone().multiplyScalar(e/1e3*i.acceleration),i.velocity.sub(i.velocity.clone().multiplyScalar(.01*Math.max(1,i.deltaVelocity.length()?1:100/(i.velocity.length()+1))*e/16.67)).add(i.deltaVelocity),i.deltaPosition=i.velocity.clone().multiplyScalar(e/1e3),i.object.position.add(i.deltaPosition.applyQuaternion(i.object.quaternion)),i.tmpQuaternion.set(i.rotationVector.x*n,i.rotationVector.y*n,i.rotationVector.z*n,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),i.object.rotation.setFromQuaternion(i.object.quaternion,i.object.rotation.order),i.updateRotationVector(),i.updateMovementVector()},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",s,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",u,!1)};var c=l(this,this.keydown),u=l(this,this.keyup);this.domElement.addEventListener("contextmenu",s,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",u,!1),this.updateMovementVector(),this.updateRotationVector()}var at=function(){function e(n,t,o){Object(Oe.a)(this,e),this.ship=n,this.controls=t,this.active=o,this.target=null,this.pointerElement=document.getElementById("pointer")}return Object(Be.a)(e,[{key:"toggle",value:function(){this.active=!this.active}},{key:"update",value:function(e){if(this.active&&(this.state=Object(y.a)({},fn.state,an),(null===this.target||this.target.destroyed)&&(this.target=Array.from(this.state.targets).filter(function(e){return e.ready&&!e.destroyed}).reduce(function(e,n){return e.userData.distance<n.userData.distance?e:n})),this.target)){var n={x:0,y:0};if(this.target.hudPosition.z>1){var t=100*Math.sign(this.target.userData.hudPositionCentered.x);n.x+=t,n.y+=t*Math.abs(Math.sin(this.ship.rollAngle))}else n.x+=nn(-100,this.target.userData.hudPositionCentered.x,100),n.y+=nn(-100,this.target.userData.hudPositionCentered.y,100);this.controls.mousemove({pageX:n.x,pageY:n.y}),this.pointerElement.style.transform="\n      translateX(".concat(n.x-16,"px)\n      translateY(").concat(n.y-16,"px)\n    "),this.target.userData.distance>150?this.controls.moveState.forward=1:this.controls.moveState.forward=0}}}]),e}(),it={module:null,setAcceleration:function(e){this.module&&e!==this.module.acceleration&&(this.module.acceleration=e,console.log("acceleration set to ",e))}},rt=function(){var e,n=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(n=!0),n}();d.subscribe("x.drones.pilotDrone.loaded",function(e,n){if(rt){document.getElementById("touchPane").style.display="block";var t=window.document.getElementsByClassName("touchPaneLeft")[0],a=et.a.create({zone:t,mode:"static",position:{left:"30%",top:"90%"},color:"white"});Array.from(document.getElementsByClassName("touchButton")).forEach(function(e){e.style.display="block"}),document.getElementById("verbosePane").style.display="none";var i=document.getElementById("buttonX"),r=function(e){e.target.style.opacity=.5,p({button:2}),setTimeout(function(){e.target.style.opacity=.3},250)};i.addEventListener("click",r,!1),i.addEventListener("touchstart",r,!1),it.module=new ot(_t,t,a)}else{var l=tt()(St.domElement);it.module=new ot(_t,St.domElement,void 0,l)}it.module.update(0);var s=new at(_t,it.module,!1);ye.a.bind("p",function(e){return s.toggle()}),d.publish("x.loops.unshift",function(e,n){s.update(e,n),it.module.update(n)});var c=n.pilotDrone;ye.a.bind("c",function(e){console.log(_t.position)}),ye.a.bind("r",function(e){"OrbitControls"===it.module.constructor.name&&(it.module.autoRotate=!it.module.autoRotate)}),ye.a.bind("space",function(e){return d.publish("x.toggle.play")});var u=new o.W(new o.Gb(1,5,5),new o.Z({color:1118481})),p=function(e){if(c)if(0===e.button)d.publish("x.drones.gun.start",c),d.publish("x.camera.shake.start",5),c.gunClock.start();else if(2===e.button){var n=function(){if(0===an.targetsInSight.size||!fn.state.lock)return null;var e=[];return an.targetsInSight.forEach(function(n){return e.push([_t.position.distanceTo(n.position),n])}),e.sort(function(e,n){return e[0]>n[0]}),e[0][1]}();if(null===n||n.destroyed)return;var t=u.clone();t.position.copy(c.position),Mt.add(t),d.publish("x.drones.missile.start",t);var o=new function(){var e=this;this.alive=!0,this.object=t,this.loop=function(o,a){if(e.alive){var i=n.position.clone().sub(t.position);i.length()<10&&(e.alive=!1,Vn(n),d.publish("x.drones.missile.stop",t),d.publish("x.drones.explosion",n),n.userData.life-=25,fn.forceUpdate());var r=i.normalize().multiplyScalar(10*a/16.66);t.position.add(r)}}};d.publish("x.loops.push",o)}};St.domElement.addEventListener("mousedown",p,!1),St.domElement.addEventListener("mouseup",function(e){0===e.button&&(d.publish("x.drones.gun.stop",c),d.publish("x.camera.shake.stop"),c.gunClock.stop())},!1)});var lt=new o.Rb;d.subscribe("x.drones.collision.terrain.pilotDrone",function(e,n){it.setAcceleration(0),lt.copy(it.module.velocity).applyQuaternion(_t.quaternion),lt.reflect(n),lt.add(_t.position),it.module.velocity=_t.worldToLocal(lt),setTimeout(function(){it.setAcceleration(60)},1e3)});var st=it,ct=new o.f,ut=[{url:t(106)},{url:t(107)},{url:t(108)},{url:t(109)}],dt=[{url:t(110)},{url:t(111)}],pt=[{url:t(112)},{url:t(113)}],vt=function(e){ct.load(e.url,function(n){e.buffer=n})},mt=function(){_t.listener=new o.e,_t.add(_t.listener),ut.map(vt),dt.map(vt),pt.map(vt),d.subscribe("x.sound.impact",function(e,n){var t=Math.floor(Math.random()*ut.length);if(ut[t].buffer){var a=new o.qb(_t.listener);a.setBuffer(ut[t].buffer),a.setRefDistance(100),n.add(a),a.play()}});var e=function(e,n){var t=Math.floor(Math.random()*pt.length);if(pt[t].buffer){var a=new o.qb(_t.listener);a.setBuffer(pt[t].buffer),a.setRefDistance(500),n.add(a),a.play()}};d.subscribe("x.drones.destroy",e),d.subscribe("x.drones.explosion",e);var n=new o.d(_t.listener);d.subscribe("x.drones.gun.start",function(e,t){dt[0].buffer&&(n.setBuffer(dt[0].buffer),n.setLoop(!0),n.play())}),d.subscribe("x.drones.gun.stop",function(e,t){n.stop()});var t=new o.d(_t.listener);d.subscribe("x.drones.missile.start",function(e,n){dt[1].buffer&&(t.setBuffer(dt[1].buffer),t.play())}),d.subscribe("x.drones.missile.stop",function(e,n){t.stop()})},ft=t(71),gt=t.n(ft),ht=t(72),wt=t.n(ht),xt=t(73),yt=t.n(xt),bt=t(74),At=t.n(bt),Ct={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},surface:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},tDepth:{type:"t",value:null},textureMatrix:{type:"m4",value:null},clipToWorldMatrix:{type:"m4",value:null},config:{type:"v4",value:new o.Sb}},vertexShader:wt.a,fragmentShader:gt.a},Dt={uniforms:{color:{type:"c",value:new o.p(16777215)},reflectivity:{type:"f",value:.75},waterLevel:{type:"f",value:0},tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tReflectionMap:{type:"t",value:null},tReflectionDepth:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},clipToWorldMatrix:{type:"m4",value:null},worldToClipMatrix:{type:"m4",value:new o.V},cameraPosition:{type:"v3",value:null},sunPosition:{type:"v3",value:null},time:{type:"f",value:0}},vertexShader:At.a,fragmentShader:yt.a};t.d(n,"renderer",function(){return St}),t.d(n,"scene",function(){return Mt}),t.d(n,"camera",function(){return _t}),t.d(n,"drone",function(){return Tt}),t.d(n,"sunPosition",function(){return Ut}),t.d(n,"gui",function(){return kt}),t.d(n,"options",function(){return Pt}),t.d(n,"loops",function(){return jt});var zt=c.a.parse(window.location.search),Pt={PBR:"true"===zt.PBR,shadows:"true"===zt.shadows,postprocessing:"true"===zt.postprocessing};Pt.PBR&&(Pt.postprocessing=!0);var Mt=new o.Ab,_t=new o.kb(75,window.innerWidth/window.innerHeight,1,1e6);_t.up=new o.Rb(0,0,1),_t.position.set(-70,175,345),_t.lookAt(0,-400,0),_t.rollAngle=0,_t.userData={terrainKeysUnder:[]},_t.updateMatrixWorld(),_t.updateProjectionMatrix(),mt();var St=new o.Wb({antialias:!0,alpha:!0,logarithmicDepthBuffer:!1});St.gammaInput=!0,St.gammaOutput=!0,St.shadowMap.enabled=Pt.shadows,St.shadowMap.bias=.001,St.shadowMap.type=o.jb,St.shadowMap.autoUpdate=!0,St.physicallyCorrectLights=!0,St.toneMapping=o.Nb,St.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(St.domElement),window.scene=Mt,window.renderer=St,window.camera=_t,window.controls=st;var kt=new i.a.GUI({autoPlace:!1});kt.closed=!0,window.document.getElementsByClassName("guiPane")[0].appendChild(kt.domElement),window.gui=kt,d.publish("x.gui.init",{gui:kt});var Et=kt.addFolder("Level of detail"),Rt=new function(){this.low=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!1,postprocessing:!1})},this.lowShadow=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!1})},this.lowShadowDoF=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!0})},this.high=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!0,shadows:!0,postprocessing:!0})}};Et.add(Rt,"low").name("low (default)"),Mt.background=new o.p(9546677),Mt.fog=new o.x(9546677,5e-4);var Tt=new o.W(new o.Gb(5,5,5),new o.X({color:16777215}));Tt.visible=!1,Mt.add(Tt);var Ut=new o.Rb;window.sunPosition=Ut,function(e,n,t){var a=new p;a.scale.setScalar(45e4),e.add(a);for(var i=new o.Hb(1e5,8,8),r=0;r<i.faces.length;r++){var l=i.faces[r],s=l.a;l.a=l.c,l.c=s}var c=new o.X({opacity:0}),u=new o.W(i,c);u.material.side=o.g,e.add(u);var d={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.32,azimuth:.2,sun:!1};if(t){var m=function(){var e=a.material.uniforms;e.turbidity.value=d.turbidity,e.rayleigh.value=d.rayleigh,e.luminance.value=d.luminance,e.mieCoefficient.value=d.mieCoefficient,e.mieDirectionalG.value=d.mieDirectionalG;var t=Math.PI*(d.inclination-.5),o=2*Math.PI*(d.azimuth-.5);n.x=f*Math.cos(o),n.z=f*Math.sin(o)*Math.sin(t),n.y=f*Math.sin(o)*Math.cos(t),e.sunPosition.value.copy(n),n.copy(n),v.position.copy(n),v.position.normalize(),v.position.multiplyScalar(2e3)},f=4e5,g=t.addFolder("Sun, sky and ocean");g.add(d,"turbidity",1,20,.1).onChange(m),g.add(d,"rayleigh",0,4,.001).onChange(m),g.add(d,"mieCoefficient",0,.1,.001).onChange(m),g.add(d,"mieDirectionalG",0,1,.001).onChange(m),g.add(d,"luminance",0,2).onChange(m),g.add(d,"inclination",0,1,1e-4).onChange(m),g.add(d,"azimuth",0,1,1e-4).onChange(m),g.add(d,"sun").onChange(m),m()}}(Mt,Ut,kt),function(e,n){v.sunPosition=n,v.updatePosition=g,v.updatePosition(),v.up.set(0,0,1),v.name="sunlight",v.castShadow=!0,v.shadow.mapSize.width=v.shadow.mapSize.height=1024;var t=1024;v.shadow.camera.left=-t,v.shadow.camera.right=t,v.shadow.camera.top=t,v.shadow.camera.bottom=-t,v.shadow.camera.far=3200,v.shadow.bias=-1e-4,v.needsUpdate=!0,e.add(v),e.add(m),e.add(f)}(Mt,Ut),v.target=Tt,Mt.add(Fe);var Ft=2e4,Nt=new o.mb(5*Ft,5*Ft,10,10),It=(new o.Kb).setCrossOrigin("anonymous"),Lt=new Pe.a(Nt,{textureWidth:512,textureHeight:512,color:16777215,flowDirection:new o.Qb(1,1),scale:2e4/15,normalMap0:It.load(t(55)),normalMap1:It.load(t(56)),clipBias:1e-5,reflectivity:.2,shader:Ct,flowSpeed:.1});window.water=Lt;var Wt=new o.Vb(window.innerWidth,window.innerHeight),Ot=new o.Y;Wt.depthBuffer=!0,Wt.depthTexture=new o.s,Lt.material.uniforms.tDepth.value=Wt.depthTexture,Lt.up.set(0,0,1),Lt.position.z=75,Lt.material.uniforms.surface.value=Lt.position.z,kt.__folders["Sun, sky and ocean"].add(Lt.position,"z",0,200,1),Lt.receiveShadow=!0,Lt.userData.isWater=!0,window.water=Lt,Mt.add(Lt);var Bt=new ze.a(Nt,{textureWidth:512,textureHeight:512,clipBias:1e-5});Bt.rotation.y=Math.PI,Bt.up.set(0,0,-1),Bt.position.copy(Lt.position),Bt.getRenderTarget().depthBuffer=!0,Bt.getRenderTarget().depthTexture=new o.s,window.ref=Bt,Bt.updateMatrixWorld(),Jn(),Wn.forEach(function(e){return Mt.add(e.mesh)});var Vt=!1;d.subscribe("x.camera.shake.start",function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];io.enabled=!0,Vt=!0}),d.subscribe("x.camera.shake.stop",function(){io.enabled=!1,Vt=!1});var jt=[function(){return Fe.position.copy(Ut)},function(e){return be[Ae](e)},function(e,n){Wn.forEach(function(e){return e.tick(n/1e3)})},function(){Vt&&_t.position.add({x:1*(Math.random()-.5),y:1*(Math.random()-.5),z:1*(Math.random()-.5)})},function(){return Mt.children.forEach(function(e){e instanceof o.H&&e.update(_t)})},function(e,n){_t.position.z<Lt.position.z?(Yt.enabled=!0,qt.enabled=!0,Lt.visible=!1,Bt.onBeforeRender(St,Mt,_t),Yt.material.uniforms.time.value=e/1e3,qt.material.uniforms.time.value=e/1e3,st.setAcceleration(30)):(Yt.enabled=!1,qt.enabled=!1,Lt.visible=!0,st.setAcceleration(100))}];d.subscribe("x.loops.remove",function(e,n){return function(e){jt=jt.filter(function(n){return n!==e})}(n)}),d.subscribe("x.loops.push",function(e,n){return jt.push(n)}),d.subscribe("x.loops.unshift",function(e,n){return jt.unshift(n)}),window.loops=jt,d.publish("x.loops.loaded");St.setPixelRatio(1);var Gt=new l.a;document.body.appendChild(Gt.dom);var Ht=new o.Vb(window.innerWidth,window.innerHeight),Zt=new _e.a(St,Ht),Qt=new ke.a(Mt,_t);Zt.addPass(Qt);var Yt=new Se.a(Dt);Yt.enabled=!1,Yt.material.uniforms.waterLevel.value=Lt.position.z,Yt.material.uniforms.tDepth.value=Wt.depthTexture,Yt.material.uniforms.cameraPosition.value=_t.position,Yt.material.uniforms.sunPosition.value=Ut,Yt.material.uniforms.tReflectionMap.value=Bt.getRenderTarget().texture,Yt.material.uniforms.tReflectionDepth.value=Bt.getRenderTarget().depthTexture;var Xt=Yt.material.uniforms.tNormalMap0,Kt=Yt.material.uniforms.tNormalMap1;Xt.value=It.load(t(55)),Kt.value=It.load(t(56)),Xt.value.wrapS=Xt.value.wrapT=o.zb,Kt.value.wrapS=Kt.value.wrapT=o.zb,Zt.addPass(Yt),window.upass=Yt;var qt=new Se.a({uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n\n    float frequency = 10.;\n    float amplitude = 0.005;\n\n    void main() {\n      vec2 uv = vUv;\n      float X = vUv.x * frequency + time;\n      float Y = vUv.y * frequency + time;\n      uv.y += cos(X + Y) * amplitude * cos(Y);\n      uv.x += sin(X - Y) * amplitude * sin(Y);\n      gl_FragColor = texture2D(tDiffuse, uv);\n    }\n  "});qt.enabled=!1,Zt.addPass(qt),St.autoClear=!1;var Jt=new Re.b(Mt,_t,2);Jt.inverse=!0,Zt.addPass(Jt);var $t=new Se.a(Ne,"tColor");$t.material.uniforms.tDepth.value=Wt.depthTexture,$t.material.uniforms.cameraPosition.value=_t.position,$t.material.uniforms.velocityFactor.value=1,Zt.addPass($t);var eo=new Re.a;Zt.addPass(eo);var no=new o.V,to=new o.V,oo=new o.Rb,ao=new o.V,io=new Ee.a;io.enabled=!1,Zt.addPass(io);var ro=new Se.a(Me.a);Zt.addPass(ro);var lo=!0;d.subscribe("x.toggle.play",function(){lo=!lo});var so=0;!function e(n){requestAnimationFrame(e);var t=n-so;so=n,lo&&(jt.forEach(function(e){e.loop?e.loop(n,t):e(n,t)}),$t.material.uniforms.delta.value=t,$t.material.uniforms.clipToWorldMatrix.value.getInverse(_t.matrixWorldInverse).multiply(ao.getInverse(_t.projectionMatrix)),$t.material.uniforms.worldToClipMatrix.value.copy(_t.projectionMatrix).multiply(_t.matrixWorldInverse),$t.material.uniforms.previousWorldToClipMatrix.value.copy(to.multiply(no)),$t.material.uniforms.cameraMove.value.copy(_t.position).sub(oo),Mt.overrideMaterial=Ot,Lt.visible=!1,St.setRenderTarget(Wt),St.render(Mt,_t),Lt.visible=!0,Mt.overrideMaterial=null,Lt.material.uniforms.clipToWorldMatrix.value=$t.material.uniforms.clipToWorldMatrix.value,Yt.material.uniforms.clipToWorldMatrix.value=$t.material.uniforms.clipToWorldMatrix.value,Yt.material.uniforms.worldToClipMatrix.value.copy(_t.projectionMatrix).multiply(_t.matrixWorldInverse),Zt.render(t),no.copy(_t.matrixWorldInverse),to.copy(_t.projectionMatrix),oo.copy(_t.position)),jt.forEach(function(e){void 0!==e.alive&&!1===e.alive&&e.object&&Mt.remove(e.object)}),jt=jt.filter(function(e){return void 0===e.alive||!0===e.alive}),Gt.update()}(0),function(e,n,t){t=t||function(){return{width:window.innerWidth,height:window.innerHeight}};var o=function(){var o=t();e.setSize(o.width,o.height),n.aspect=o.width/o.height,n.updateProjectionMatrix(),d.publish("x.screen.resized",o)};window.addEventListener("resize",o,!1)}(St,_t)}]),[[75,1,2]]]);
//# sourceMappingURL=main.c217a776.chunk.js.map